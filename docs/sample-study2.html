<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Thomas E. Love">
<meta name="dcterms.date" content="2024-11-18">

<title>431 Project B Sample Study 2 Report – 431 Project B</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">431 Project B</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-the-data" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">The Data</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-the-data">    
        <li>
    <a class="dropdown-item" href="./data1.html">
 <span class="dropdown-text">Data Development</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./data2.html">
 <span class="dropdown-text">Using NHANES data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./data3.html">
 <span class="dropdown-text">Using Something Else</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="./register.html"> 
<span class="menu-text">Registration</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-study-1" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Study 1</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-study-1">    
        <li>
    <a class="dropdown-item" href="./study1a.html">
 <span class="dropdown-text">Required Study 1 Analyses</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./study1b.html">
 <span class="dropdown-text">Study 1 Report Specifications</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./study1c.html">
 <span class="dropdown-text">Study 1 Sample Report</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-study-2" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Study 2</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-study-2">    
        <li>
    <a class="dropdown-item" href="./study2a.html">
 <span class="dropdown-text">Required Study 2 Analyses</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./study2b.html">
 <span class="dropdown-text">Study 2 Report Specifications</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./study2c.html">
 <span class="dropdown-text">Study 2 Sample Report</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="./self_eval.html"> 
<span class="menu-text">Self-Evaluation</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./checklist.html"> 
<span class="menu-text">Checklist</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./tipsheet.html"> 
<span class="menu-text">Tip Sheet</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="https://thomaselove.github.io/431-2024/contact.html"> 
<span class="menu-text">Contact Us</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://thomaselove.github.io/431-2024"> 
<span class="menu-text">431 Homepage</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#setup-and-data-ingest" id="toc-setup-and-data-ingest" class="nav-link active" data-scroll-target="#setup-and-data-ingest"><span class="header-section-number">1</span> Setup and Data Ingest</a>
  <ul class="collapse">
  <li><a href="#initial-setup-and-package-loads-in-r" id="toc-initial-setup-and-package-loads-in-r" class="nav-link" data-scroll-target="#initial-setup-and-package-loads-in-r"><span class="header-section-number">1.1</span> Initial Setup and Package Loads in R</a></li>
  <li><a href="#loading-the-raw-data-into-r" id="toc-loading-the-raw-data-into-r" class="nav-link" data-scroll-target="#loading-the-raw-data-into-r"><span class="header-section-number">1.2</span> Loading the Raw Data into R</a></li>
  </ul></li>
  <li><a href="#cleaning-the-data" id="toc-cleaning-the-data" class="nav-link" data-scroll-target="#cleaning-the-data"><span class="header-section-number">2</span> Cleaning the Data</a>
  <ul class="collapse">
  <li><a href="#merging-the-data" id="toc-merging-the-data" class="nav-link" data-scroll-target="#merging-the-data"><span class="header-section-number">2.1</span> Merging the Data</a></li>
  <li><a href="#the-raw-data" id="toc-the-raw-data" class="nav-link" data-scroll-target="#the-raw-data"><span class="header-section-number">2.2</span> The Raw Data</a></li>
  <li><a href="#which-variables-should-be-included-in-the-tidy-data-set" id="toc-which-variables-should-be-included-in-the-tidy-data-set" class="nav-link" data-scroll-target="#which-variables-should-be-included-in-the-tidy-data-set"><span class="header-section-number">2.3</span> Which variables should be included in the tidy data set?</a></li>
  <li><a href="#checking-our-outcome-and-key-predictor" id="toc-checking-our-outcome-and-key-predictor" class="nav-link" data-scroll-target="#checking-our-outcome-and-key-predictor"><span class="header-section-number">2.4</span> Checking our Outcome and Key Predictor</a></li>
  <li><a href="#checking-the-quantitative-predictors" id="toc-checking-the-quantitative-predictors" class="nav-link" data-scroll-target="#checking-the-quantitative-predictors"><span class="header-section-number">2.5</span> Checking the Quantitative Predictors</a></li>
  <li><a href="#checking-the-categorical-variables" id="toc-checking-the-categorical-variables" class="nav-link" data-scroll-target="#checking-the-categorical-variables"><span class="header-section-number">2.6</span> Checking the Categorical Variables</a>
  <ul class="collapse">
  <li><a href="#nses-home-neighborhoods-socio-economic-status" id="toc-nses-home-neighborhoods-socio-economic-status" class="nav-link" data-scroll-target="#nses-home-neighborhoods-socio-economic-status"><span class="header-section-number">2.6.1</span> <code>nses</code>: home neighborhood’s socio-economic status</a></li>
  <li><a href="#tobacco-tobacco-use-history" id="toc-tobacco-tobacco-use-history" class="nav-link" data-scroll-target="#tobacco-tobacco-use-history"><span class="header-section-number">2.6.2</span> <code>tobacco</code>: tobacco use history</a></li>
  <li><a href="#insurance-primary-insurance-type" id="toc-insurance-primary-insurance-type" class="nav-link" data-scroll-target="#insurance-primary-insurance-type"><span class="header-section-number">2.6.3</span> <code>insurance</code>: primary insurance type</a></li>
  <li><a href="#what-about-the-subjects" id="toc-what-about-the-subjects" class="nav-link" data-scroll-target="#what-about-the-subjects"><span class="header-section-number">2.6.4</span> What about the subjects?</a></li>
  </ul></li>
  <li><a href="#dealing-with-missingness" id="toc-dealing-with-missingness" class="nav-link" data-scroll-target="#dealing-with-missingness"><span class="header-section-number">2.7</span> Dealing with Missingness</a></li>
  <li><a href="#steps-1-and-2-missing-values-in-our-outcome-or-key-predictor" id="toc-steps-1-and-2-missing-values-in-our-outcome-or-key-predictor" class="nav-link" data-scroll-target="#steps-1-and-2-missing-values-in-our-outcome-or-key-predictor"><span class="header-section-number">2.8</span> Steps 1 and 2: Missing values in our outcome or key predictor?</a></li>
  </ul></li>
  <li><a href="#codebook-and-data-description" id="toc-codebook-and-data-description" class="nav-link" data-scroll-target="#codebook-and-data-description"><span class="header-section-number">3</span> Codebook and Data Description</a>
  <ul class="collapse">
  <li><a href="#the-codebook" id="toc-the-codebook" class="nav-link" data-scroll-target="#the-codebook"><span class="header-section-number">3.1</span> The Codebook</a></li>
  <li><a href="#print-the-tibble" id="toc-print-the-tibble" class="nav-link" data-scroll-target="#print-the-tibble"><span class="header-section-number">3.2</span> Print the Tibble</a></li>
  <li><a href="#data_codebook-results" id="toc-data_codebook-results" class="nav-link" data-scroll-target="#data_codebook-results"><span class="header-section-number">3.3</span> <code>data_codebook()</code> results</a></li>
  <li><a href="#our-single-imputation" id="toc-our-single-imputation" class="nav-link" data-scroll-target="#our-single-imputation"><span class="header-section-number">3.4</span> Our Single Imputation</a></li>
  <li><a href="#partition-the-data" id="toc-partition-the-data" class="nav-link" data-scroll-target="#partition-the-data"><span class="header-section-number">3.5</span> Partition the Data</a></li>
  </ul></li>
  <li><a href="#my-research-question" id="toc-my-research-question" class="nav-link" data-scroll-target="#my-research-question"><span class="header-section-number">4</span> My Research Question</a></li>
  <li><a href="#transforming-the-outcome" id="toc-transforming-the-outcome" class="nav-link" data-scroll-target="#transforming-the-outcome"><span class="header-section-number">5</span> Transforming the Outcome</a>
  <ul class="collapse">
  <li><a href="#visualizing-the-outcome-distribution" id="toc-visualizing-the-outcome-distribution" class="nav-link" data-scroll-target="#visualizing-the-outcome-distribution"><span class="header-section-number">5.1</span> Visualizing the Outcome Distribution</a></li>
  <li><a href="#numerical-summary-of-the-outcome" id="toc-numerical-summary-of-the-outcome" class="nav-link" data-scroll-target="#numerical-summary-of-the-outcome"><span class="header-section-number">5.2</span> Numerical Summary of the Outcome</a></li>
  <li><a href="#numerical-summaries-of-the-predictors" id="toc-numerical-summaries-of-the-predictors" class="nav-link" data-scroll-target="#numerical-summaries-of-the-predictors"><span class="header-section-number">5.3</span> Numerical Summaries of the Predictors</a></li>
  <li><a href="#scatterplot-matrix" id="toc-scatterplot-matrix" class="nav-link" data-scroll-target="#scatterplot-matrix"><span class="header-section-number">5.4</span> Scatterplot Matrix</a></li>
  <li><a href="#collinearity-checking" id="toc-collinearity-checking" class="nav-link" data-scroll-target="#collinearity-checking"><span class="header-section-number">5.5</span> Collinearity Checking</a></li>
  <li><a href="#boxcox-function-to-assess-need-for-transformation-of-our-outcome" id="toc-boxcox-function-to-assess-need-for-transformation-of-our-outcome" class="nav-link" data-scroll-target="#boxcox-function-to-assess-need-for-transformation-of-our-outcome"><span class="header-section-number">5.6</span> <code>boxCox</code> function to assess need for transformation of our outcome</a></li>
  </ul></li>
  <li><a href="#the-big-model" id="toc-the-big-model" class="nav-link" data-scroll-target="#the-big-model"><span class="header-section-number">6</span> The Big Model</a>
  <ul class="collapse">
  <li><a href="#fittingsummarizing-the-kitchen-sink-model" id="toc-fittingsummarizing-the-kitchen-sink-model" class="nav-link" data-scroll-target="#fittingsummarizing-the-kitchen-sink-model"><span class="header-section-number">6.1</span> Fitting/Summarizing the Kitchen Sink model</a></li>
  <li><a href="#effect-sizes-coefficient-estimates" id="toc-effect-sizes-coefficient-estimates" class="nav-link" data-scroll-target="#effect-sizes-coefficient-estimates"><span class="header-section-number">6.2</span> Effect Sizes: Coefficient Estimates</a></li>
  <li><a href="#describing-the-equation" id="toc-describing-the-equation" class="nav-link" data-scroll-target="#describing-the-equation"><span class="header-section-number">6.3</span> Describing the Equation</a></li>
  </ul></li>
  <li><a href="#the-smaller-model" id="toc-the-smaller-model" class="nav-link" data-scroll-target="#the-smaller-model"><span class="header-section-number">7</span> The Smaller Model</a>
  <ul class="collapse">
  <li><a href="#backwards-stepwise-elimination" id="toc-backwards-stepwise-elimination" class="nav-link" data-scroll-target="#backwards-stepwise-elimination"><span class="header-section-number">7.1</span> Backwards Stepwise Elimination</a></li>
  <li><a href="#fitting-the-small-model" id="toc-fitting-the-small-model" class="nav-link" data-scroll-target="#fitting-the-small-model"><span class="header-section-number">7.2</span> Fitting the “small” model</a></li>
  <li><a href="#effect-sizes-coefficient-estimates-1" id="toc-effect-sizes-coefficient-estimates-1" class="nav-link" data-scroll-target="#effect-sizes-coefficient-estimates-1"><span class="header-section-number">7.3</span> Effect Sizes: Coefficient Estimates</a></li>
  <li><a href="#interpreting-the-small-model-regression-equation" id="toc-interpreting-the-small-model-regression-equation" class="nav-link" data-scroll-target="#interpreting-the-small-model-regression-equation"><span class="header-section-number">7.4</span> Interpreting the Small Model Regression Equation</a></li>
  </ul></li>
  <li><a href="#in-sample-comparison" id="toc-in-sample-comparison" class="nav-link" data-scroll-target="#in-sample-comparison"><span class="header-section-number">8</span> In-Sample Comparison</a>
  <ul class="collapse">
  <li><a href="#compare-performance" id="toc-compare-performance" class="nav-link" data-scroll-target="#compare-performance"><span class="header-section-number">8.1</span> Compare Performance</a></li>
  <li><a href="#assessing-assumptions" id="toc-assessing-assumptions" class="nav-link" data-scroll-target="#assessing-assumptions"><span class="header-section-number">8.2</span> Assessing Assumptions</a>
  <ul class="collapse">
  <li><a href="#checking-model_big" id="toc-checking-model_big" class="nav-link" data-scroll-target="#checking-model_big"><span class="header-section-number">8.2.1</span> Checking <code>model_big</code></a></li>
  <li><a href="#does-collinearity-have-a-meaningful-impact" id="toc-does-collinearity-have-a-meaningful-impact" class="nav-link" data-scroll-target="#does-collinearity-have-a-meaningful-impact"><span class="header-section-number">8.2.2</span> Does collinearity have a meaningful impact?</a></li>
  </ul></li>
  <li><a href="#comparing-the-models" id="toc-comparing-the-models" class="nav-link" data-scroll-target="#comparing-the-models"><span class="header-section-number">8.3</span> Comparing the Models</a></li>
  </ul></li>
  <li><a href="#model-validation" id="toc-model-validation" class="nav-link" data-scroll-target="#model-validation"><span class="header-section-number">9</span> Model Validation</a>
  <ul class="collapse">
  <li><a href="#calculating-prediction-errors" id="toc-calculating-prediction-errors" class="nav-link" data-scroll-target="#calculating-prediction-errors"><span class="header-section-number">9.1</span> Calculating Prediction Errors</a>
  <ul class="collapse">
  <li><a href="#big-model-back-transformation-and-calculating-fitsresiduals" id="toc-big-model-back-transformation-and-calculating-fitsresiduals" class="nav-link" data-scroll-target="#big-model-back-transformation-and-calculating-fitsresiduals"><span class="header-section-number">9.1.1</span> Big Model: Back-Transformation and Calculating Fits/Residuals</a></li>
  <li><a href="#small-model-back-transformation-and-calculating-fitsresiduals" id="toc-small-model-back-transformation-and-calculating-fitsresiduals" class="nav-link" data-scroll-target="#small-model-back-transformation-and-calculating-fitsresiduals"><span class="header-section-number">9.1.2</span> Small Model: Back-Transformation and Calculating Fits/Residuals</a></li>
  <li><a href="#combining-the-results" id="toc-combining-the-results" class="nav-link" data-scroll-target="#combining-the-results"><span class="header-section-number">9.1.3</span> Combining the Results</a></li>
  </ul></li>
  <li><a href="#visualizing-the-predictions" id="toc-visualizing-the-predictions" class="nav-link" data-scroll-target="#visualizing-the-predictions"><span class="header-section-number">9.2</span> Visualizing the Predictions</a></li>
  <li><a href="#summarizing-the-errors" id="toc-summarizing-the-errors" class="nav-link" data-scroll-target="#summarizing-the-errors"><span class="header-section-number">9.3</span> Summarizing the Errors</a>
  <ul class="collapse">
  <li><a href="#identify-the-largest-errors" id="toc-identify-the-largest-errors" class="nav-link" data-scroll-target="#identify-the-largest-errors"><span class="header-section-number">9.3.1</span> Identify the largest errors</a></li>
  </ul></li>
  <li><a href="#comparing-the-models-1" id="toc-comparing-the-models-1" class="nav-link" data-scroll-target="#comparing-the-models-1"><span class="header-section-number">9.4</span> Comparing the Models</a></li>
  </ul></li>
  <li><a href="#discussion" id="toc-discussion" class="nav-link" data-scroll-target="#discussion"><span class="header-section-number">10</span> Discussion</a>
  <ul class="collapse">
  <li><a href="#chosen-model" id="toc-chosen-model" class="nav-link" data-scroll-target="#chosen-model"><span class="header-section-number">10.1</span> Chosen Model</a></li>
  <li><a href="#answering-my-question" id="toc-answering-my-question" class="nav-link" data-scroll-target="#answering-my-question"><span class="header-section-number">10.2</span> Answering My Question</a></li>
  <li><a href="#next-steps" id="toc-next-steps" class="nav-link" data-scroll-target="#next-steps"><span class="header-section-number">10.3</span> Next Steps</a></li>
  <li><a href="#reflection" id="toc-reflection" class="nav-link" data-scroll-target="#reflection"><span class="header-section-number">10.4</span> Reflection</a></li>
  </ul></li>
  <li><a href="#session-information" id="toc-session-information" class="nav-link" data-scroll-target="#session-information"><span class="header-section-number">11</span> Session Information</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">431 Project B Sample Study 2 Report</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Thomas E. Love </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">2024-11-18</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Reminders from Dr.&nbsp;Love
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li><p>Remember that each subsection should include at least one complete sentence explaining what you are doing, specifying the variables you are using and how you are using them, and then conclude with at least one complete sentence of discussion of the key conclusions you draw from the current step, and a discussion of any limitations you can describe that apply to the results.</p></li>
<li><p>If you want to download the Quarto code I used to create this document <strong>to use as a template for your own work</strong>, click on the Code button near the title of this Sample Study.</p></li>
<li><p>In general, DO NOT use my exact words (other than the section and subsection headings) included in this sample report in your project. Rewrite everything to make it relevant to your situation. Do not repeat my instructions back to me.</p></li>
</ol>
<ul>
<li>One partial exception is that I have demonstrated the interpretation of at least one point estimate and at least one confidence interval in this Sample Report, using language that I would be happy to see you use.</li>
</ul>
</div>
</div>
<section id="setup-and-data-ingest" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Setup and Data Ingest</h1>
<p>This document demonstrates analyses we are asking you to complete in Study 2 for Project B. The simulated data used in this example report are found in the <code>hbp_study.csv</code> data file available in the projectB section of <a href="https://github.com/THOMASELOVE/431-data">our 431-data website</a>.</p>
<p>These are simulated data from a study of high blood pressure in 999 African-American adult subjects who are not of Hispanic or Latino ethnicity. To be included, the subject had to be between 33 and 83 years of age at baseline, have a series of items available in their health record at baseline, including a baseline systolic blood pressure, and then return for a blood pressure check 18 months later. Our goal will be to build a prediction model for the subject’s systolic blood pressure at the end of the 18-month period, with the key predictor being that same subject’s systolic blood pressure at the start of the period, and adjusting (in our larger model) for several other characteristics of the subjects at baseline.</p>
<section id="initial-setup-and-package-loads-in-r" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="initial-setup-and-package-loads-in-r"><span class="header-section-number">1.1</span> Initial Setup and Package Loads in R</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(GGally)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mosaic)  </span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mice)    </span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(naniar)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(xfun)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(easystats)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse) </span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="do">## Global options</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">comment=</span><span class="cn">NA</span>)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_lucid</span>())</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">dplyr.summarise.inform =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="loading-the-raw-data-into-r" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="loading-the-raw-data-into-r"><span class="header-section-number">1.2</span> Loading the Raw Data into R</h2>
<p>Here, we load the data using <code>read_csv</code> and then convert all <code>character</code> variables to <code>factors</code> in R, and then change our identifying code: <code>subj_id</code> back to a character variable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>hbp_study <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/hbp_study.csv"</span>, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.character), as.factor)) <span class="sc">|&gt;</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">subj_id =</span> <span class="fu">as.character</span>(subj_id))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="cleaning-the-data" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Cleaning the Data</h1>
<section id="merging-the-data" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="merging-the-data"><span class="header-section-number">2.1</span> Merging the Data</h2>
<p>In my little demonstration here, I don’t have to do any merging. See the Study 1 Example, or (for example) the Class 23 Slides for examples of merging data.</p>
</section>
<section id="the-raw-data" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="the-raw-data"><span class="header-section-number">2.2</span> The Raw Data</h2>
<p>The <code>hbp_study</code> data set includes 12 variables and 999 adult subjects. For each subject, we have gathered</p>
<ul>
<li>baseline information on their <code>age</code>, and their <code>sex</code>,</li>
<li>whether or not they have a <code>diabetes</code> diagnosis,</li>
<li>the socio-economic status of their neighborhood of residence (<code>nses</code>),</li>
<li>their body-mass index (<code>bmi1</code>) and systolic blood pressure (<code>sbp1</code>),</li>
<li>their <code>insurance</code> type, <code>tobacco</code> use history, and</li>
<li>whether or not they have a prescription for a <code>statin</code>, or for a <code>diuretic</code>.</li>
<li>Eighteen months later, we gathered a new systolic blood pressure (<code>sbp2</code>) for each subject.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(hbp_study)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 999
Columns: 12
$ subj_id   &lt;chr&gt; "A0001", "A0004", "A0005", "A0013", "A0015", "A0017", "A0018…
$ age       &lt;dbl&gt; 58, 65, 61, 51, 61, 45, 40, 50, 43, 46, 56, 52, 58, 59, 54, …
$ sex       &lt;fct&gt; F, F, F, M, F, F, F, F, M, F, F, F, M, F, M, F, F, F, M, M, …
$ diabetes  &lt;fct&gt; No, No, Yes, No, No, No, Yes, Yes, No, No, No, No, No, No, Y…
$ nses      &lt;fct&gt; Low, Very Low, Very Low, Very Low, Very Low, Low, Very Low, …
$ bmi1      &lt;dbl&gt; 24.41, 50.50, 29.76, 41.83, 30.95, 33.01, 36.32, 30.76, 23.1…
$ sbp1      &lt;dbl&gt; 147, 134, 170, 118, 132, 110, 127, 152, 125, 161, 140, 136, …
$ insurance &lt;fct&gt; Medicaid, Medicaid, Medicaid, Medicaid, Medicaid, Medicaid, …
$ tobacco   &lt;fct&gt; never, never, current, quit, never, current, never, never, c…
$ statin    &lt;dbl&gt; 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 1, 0, 1, 0, …
$ diuretic  &lt;dbl&gt; 1, 1, 1, 1, 0, 1, 1, 1, 0, 1, 0, 1, 0, 1, 1, 1, 1, 1, 0, 1, …
$ sbp2      &lt;dbl&gt; 138, 134, 140, 143, 162, 141, 101, 154, 111, 154, 154, 138, …</code></pre>
</div>
</div>
<p><strong>Note</strong>: If you have more than 20 variables in your initial (raw) data set, prune it down to 20 as the first step before showing us the results of <code>glimpse</code> for your data.</p>
<p>This tibble describes twelve variables, including:</p>
<ul>
<li>a character variable called <code>subj_id</code> not to be used in our model except for identification of subjects,</li>
<li>our outcome (<code>sbp2</code>) and our key predictor (<code>sbp1</code>) that describe systolic blood pressure at two different times.</li>
<li>seven categorical candidate predictors, specifically <code>sex</code>, <code>diabetes</code>, <code>nses</code>, <code>insurance</code>, <code>tobacco</code>, <code>statin</code>, and <code>diuretic</code>, each specified here in R as either a factor or a 1/0 numeric variable (<code>statin</code> and <code>diuretic</code>),</li>
<li>three quantitative candidate predictors, specifically <code>age</code>, <code>bmi1</code> and <code>sbp1</code>.</li>
</ul>
</section>
<section id="which-variables-should-be-included-in-the-tidy-data-set" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="which-variables-should-be-included-in-the-tidy-data-set"><span class="header-section-number">2.3</span> Which variables should be included in the tidy data set?</h2>
<p>In fitting my models, I actually plan only to use five predictors: <code>sbp1</code>, <code>age</code>, <code>bmi1</code>, <code>diabetes</code> and <code>tobacco</code> to model my outcome: <code>sbp2</code>. Even though I’m not planning to use all of these predictors in my models, I’m going to build a tidy data set including all of them anyway, so I can demonstrate solutions to some problems you might have.</p>
<p>When you build your tidy data set in the next section, restrict it to the variables (outcomes, predictors and <code>subj_id</code>) that you will actually use in your modeling.</p>
<p>In building our tidy version of these data, we must:</p>
<ul>
<li>deal with the ordering of levels in the multi-categorical variables <code>nses</code>, <code>insurance</code> and <code>tobacco</code>,</li>
<li>change the name of <code>nses</code> to something more helpful - I’ll use <code>nbhd_ses</code> as the new name<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>.</li>
</ul>
</section>
<section id="checking-our-outcome-and-key-predictor" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="checking-our-outcome-and-key-predictor"><span class="header-section-number">2.4</span> Checking our Outcome and Key Predictor</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">df_stats</span>(<span class="sc">~</span> sbp2 <span class="sc">+</span> sbp1, <span class="at">data =</span> hbp_study)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  response min  Q1 median  Q3 max     mean       sd   n missing
1     sbp2  77 121    133 144 203 133.7427 17.93623 999       0
2     sbp1  81 124    136 147 205 136.5185 18.34717 999       0</code></pre>
</div>
</div>
<p>We have no missing values in our outcome or our key predictor, and each of the values look plausible, so we’ll move on.</p>
</section>
<section id="checking-the-quantitative-predictors" class="level2" data-number="2.5">
<h2 data-number="2.5" class="anchored" data-anchor-id="checking-the-quantitative-predictors"><span class="header-section-number">2.5</span> Checking the Quantitative Predictors</h2>
<p>Besides <code>sbp1</code> we have two other quantitative predictor candidates, <code>age</code> and <code>bmi1</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">df_stats</span>(<span class="sc">~</span> age <span class="sc">+</span> bmi1, <span class="at">data =</span> hbp_study)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  response   min     Q1 median     Q3   max     mean       sd   n missing
1      age 33.00 52.000 59.000 66.000 83.00 58.68669 10.47551 999       0
2     bmi1 16.72 27.865 32.145 38.365 74.65 33.72258  8.36090 994       5</code></pre>
</div>
</div>
<p>We know that all subjects in these data had to be between 33 and 83 years of age in order to be included, so we’re happy to see that they are. We have five missing values (appropriately specified with NA) and no implausible values in our BMI values (I would use 16-80 as a plausible range of BMI values for adults.) Things look OK for now, as we’ll deal with the missing values last.</p>
</section>
<section id="checking-the-categorical-variables" class="level2" data-number="2.6">
<h2 data-number="2.6" class="anchored" data-anchor-id="checking-the-categorical-variables"><span class="header-section-number">2.6</span> Checking the Categorical Variables</h2>
<p>For categorical variables, it’s always worth it to check to see whether the existing orders of the factor levels match the inherent order of the information, as well as whether there are any levels which we might want to collapse due to insufficient data, and whether there are any missing values.</p>
<section id="nses-home-neighborhoods-socio-economic-status" class="level3" data-number="2.6.1">
<h3 data-number="2.6.1" class="anchored" data-anchor-id="nses-home-neighborhoods-socio-economic-status"><span class="header-section-number">2.6.1</span> <code>nses</code>: home neighborhood’s socio-economic status</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>hbp_study <span class="sc">|&gt;</span> <span class="fu">tabyl</span>(nses)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     nses   n     percent valid_percent
     High 154 0.154154154     0.1553986
      Low 336 0.336336336     0.3390515
   Middle 281 0.281281281     0.2835520
 Very Low 220 0.220220220     0.2219980
     &lt;NA&gt;   8 0.008008008            NA</code></pre>
</div>
</div>
<ul>
<li>The order of <code>nses</code>, instead of the alphabetical (“High”, “Low”, “Middle”, “Very Low”), should go from “Very Low” to “Low” to “Middle” to “High”, or perhaps its reverse.</li>
<li>Let’s fix that using the <code>fct_relevel</code> function from the <code>forcats</code> package, which is part of the <code>tidyverse</code>. While we’re at it, we’ll rename the variable <code>nbhd_ses</code> which is more helpful to me.</li>
<li>Then we’ll see how many subjects fall in each category.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>hbp_study <span class="ot">&lt;-</span> hbp_study <span class="sc">|&gt;</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">nbhd_ses =</span> nses) <span class="sc">|&gt;</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">nbhd_ses =</span> <span class="fu">fct_relevel</span>(nbhd_ses, <span class="st">"Very Low"</span>, <span class="st">"Low"</span>, </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"Middle"</span>, <span class="st">"High"</span>))</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>hbp_study <span class="sc">|&gt;</span> <span class="fu">tabyl</span>(nbhd_ses)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> nbhd_ses   n     percent valid_percent
 Very Low 220 0.220220220     0.2219980
      Low 336 0.336336336     0.3390515
   Middle 281 0.281281281     0.2835520
     High 154 0.154154154     0.1553986
     &lt;NA&gt;   8 0.008008008            NA</code></pre>
</div>
</div>
<p>We have 8 missing values of <code>nbhd_ses</code>. We’ll deal with that later.</p>
</section>
<section id="tobacco-tobacco-use-history" class="level3" data-number="2.6.2">
<h3 data-number="2.6.2" class="anchored" data-anchor-id="tobacco-tobacco-use-history"><span class="header-section-number">2.6.2</span> <code>tobacco</code>: tobacco use history</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>hbp_study <span class="sc">|&gt;</span> <span class="fu">tabyl</span>(tobacco)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> tobacco   n    percent valid_percent
 current 295 0.29529530     0.3022541
   never 319 0.31931932     0.3268443
    quit 362 0.36236236     0.3709016
    &lt;NA&gt;  23 0.02302302            NA</code></pre>
</div>
</div>
<ul>
<li>For <code>tobacco</code>, instead of (“current”, “never”, “quit”), we want a new order: (“never”, “quit”, “current”).</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>hbp_study <span class="ot">&lt;-</span> hbp_study <span class="sc">|&gt;</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tobacco =</span> <span class="fu">fct_relevel</span>(tobacco, <span class="st">"never"</span>, <span class="st">"quit"</span>, </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"current"</span>))</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>hbp_study <span class="sc">|&gt;</span> <span class="fu">count</span>(tobacco)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 2
  tobacco     n
  &lt;fct&gt;   &lt;int&gt;
1 never     319
2 quit      362
3 current   295
4 &lt;NA&gt;       23</code></pre>
</div>
</div>
<p>We have 23 missing values of <code>tobacco</code>. Again, we’ll deal with that later.</p>
</section>
<section id="insurance-primary-insurance-type" class="level3" data-number="2.6.3">
<h3 data-number="2.6.3" class="anchored" data-anchor-id="insurance-primary-insurance-type"><span class="header-section-number">2.6.3</span> <code>insurance</code>: primary insurance type</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>hbp_study <span class="sc">|&gt;</span> <span class="fu">tabyl</span>(insurance)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> insurance   n    percent
  Medicaid 398 0.39839840
  Medicare 402 0.40240240
   Private 160 0.16016016
 Uninsured  39 0.03903904</code></pre>
</div>
</div>
<ul>
<li>For <code>insurance</code>, we’ll change the order to (“Medicare”, “Private”, “Medicaid”, “Uninsured”)</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>hbp_study <span class="ot">&lt;-</span> hbp_study <span class="sc">|&gt;</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">insurance =</span> <span class="fu">fct_relevel</span>(insurance, <span class="st">"Medicare"</span>, </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">"Private"</span>, <span class="st">"Medicaid"</span>, </span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">"Uninsured"</span>))</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>hbp_study <span class="sc">|&gt;</span> <span class="fu">tabyl</span>(insurance)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> insurance   n    percent
  Medicare 402 0.40240240
   Private 160 0.16016016
  Medicaid 398 0.39839840
 Uninsured  39 0.03903904</code></pre>
</div>
</div>
<p>Note that any levels left out of a <code>fct_relevel</code> statement get included in their current order, after whatever levels have been specified.</p>
</section>
<section id="what-about-the-subjects" class="level3" data-number="2.6.4">
<h3 data-number="2.6.4" class="anchored" data-anchor-id="what-about-the-subjects"><span class="header-section-number">2.6.4</span> What about the subjects?</h3>
<p>It is important to make sure that we have a unique (distinct) code (here, <code>subj_id</code>) for each row in the raw data set.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(hbp_study)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 999</code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">n_distinct</span>(hbp_study <span class="sc">|&gt;</span> <span class="fu">select</span>(subj_id))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 999</code></pre>
</div>
</div>
<p>OK, that’s fine.</p>
</section>
</section>
<section id="dealing-with-missingness" class="level2" data-number="2.7">
<h2 data-number="2.7" class="anchored" data-anchor-id="dealing-with-missingness"><span class="header-section-number">2.7</span> Dealing with Missingness</h2>
<p>In Study 2, we will take the following steps once we have ensured that any <em>missing</em> values are appropriately specified using <code>NA</code>.</p>
<ol type="1">
<li>If there are any missing values in your outcome, drop those subjects.</li>
<li>If there are any missing values in your key predictor, drop those subjects.</li>
<li>Build your codebook using the original data you have (including missing values.)</li>
<li>Once you have built the codebook, perform single imputation with the <strong>mice</strong> package to obtain your analytic sample, which you will then partition into a training and testing sample, and then use for the remainder of the work (everything after the codebook.)</li>
</ol>
</section>
<section id="steps-1-and-2-missing-values-in-our-outcome-or-key-predictor" class="level2" data-number="2.8">
<h2 data-number="2.8" class="anchored" data-anchor-id="steps-1-and-2-missing-values-in-our-outcome-or-key-predictor"><span class="header-section-number">2.8</span> Steps 1 and 2: Missing values in our outcome or key predictor?</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">miss_var_summary</span>(hbp_study)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 3
   variable  n_miss pct_miss
   &lt;chr&gt;      &lt;int&gt;    &lt;num&gt;
 1 tobacco       23    2.30 
 2 nbhd_ses       8    0.801
 3 bmi1           5    0.501
 4 subj_id        0    0    
 5 age            0    0    
 6 sex            0    0    
 7 diabetes       0    0    
 8 sbp1           0    0    
 9 insurance      0    0    
10 statin         0    0    
11 diuretic       0    0    
12 sbp2           0    0    </code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">miss_case_table</span>(hbp_study)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 3
  n_miss_in_case n_cases pct_cases
           &lt;int&gt;   &lt;int&gt;     &lt;dbl&gt;
1              0     963     96.4 
2              1      36      3.60</code></pre>
</div>
</div>
<p>We are missing data for 36 of our 999 subjects, but we don’t have any missing values in either our outcome <code>sbp2</code> or our key predictor <code>sbp1</code>, so we’ll move on to build our codebook.</p>
</section>
</section>
<section id="codebook-and-data-description" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Codebook and Data Description</h1>
<section id="the-codebook" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="the-codebook"><span class="header-section-number">3.1</span> The Codebook</h2>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Below, I’ve demonstrated the task of building a set of variable descriptions for a larger set of predictors than I actually intend to use, just to illustrate.</p>
<p>The 12 variables in the <code>hbp_study</code> tibble are as follows.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 14%">
<col style="width: 21%">
<col style="width: 63%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">Variable</th>
<th style="text-align: center;">Type</th>
<th>Description / Levels</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;"><code>subj_id</code></td>
<td style="text-align: center;">Character</td>
<td>subject code (A001-A999)</td>
</tr>
<tr class="even">
<td style="text-align: right;"><code>sbp2</code></td>
<td style="text-align: center;">Quantitative</td>
<td><strong>outcome</strong> variable, SBP after 18 months, in mm Hg</td>
</tr>
<tr class="odd">
<td style="text-align: right;"><code>sbp1</code></td>
<td style="text-align: center;">Quantitative</td>
<td><strong>key predictor</strong> baseline SBP (systolic blood pressure), in mm Hg</td>
</tr>
<tr class="even">
<td style="text-align: right;"><code>age</code></td>
<td style="text-align: center;">Quantitative</td>
<td>age of subject at baseline, in years</td>
</tr>
<tr class="odd">
<td style="text-align: right;"><code>sex</code></td>
<td style="text-align: center;">Binary</td>
<td>Male or Female</td>
</tr>
<tr class="even">
<td style="text-align: right;"><code>diabetes</code></td>
<td style="text-align: center;">Binary</td>
<td>Does subject have a diabetes diagnosis: No or Yes</td>
</tr>
<tr class="odd">
<td style="text-align: right;"><code>nbhd_ses</code></td>
<td style="text-align: center;">4 level Cat.</td>
<td>Socio-economic status of subject’s home neighborhood: Very Low, Low, Middle and High</td>
</tr>
<tr class="even">
<td style="text-align: right;"><code>bmi1</code></td>
<td style="text-align: center;">Quantitative</td>
<td>subject’s body-mass index at baseline</td>
</tr>
<tr class="odd">
<td style="text-align: right;"><code>insurance</code></td>
<td style="text-align: center;">4 level Cat.</td>
<td>subject’s insurance status at baseline: Medicare, Private, Medicaid, Uninsured</td>
</tr>
<tr class="even">
<td style="text-align: right;"><code>tobacco</code></td>
<td style="text-align: center;">3 level Cat.</td>
<td>subject’s tobacco use at baseline: never, quit (former), current</td>
</tr>
<tr class="odd">
<td style="text-align: right;"><code>statin</code></td>
<td style="text-align: center;">Binary</td>
<td>1 = statin prescription at baseline, else 0</td>
</tr>
<tr class="even">
<td style="text-align: right;"><code>diuretic</code></td>
<td style="text-align: center;">Binary</td>
<td>1 = diuretic prescription at baseline, else 0</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>In fitting my models, I actually plan only to use five predictors: <code>sbp1</code>, <code>age</code>, <code>bmi1</code>, <code>diabetes</code> and <code>tobacco</code> to model my outcome: <code>sbp2</code>. So let’s create that data set as a tibble, and provide its set of variable descriptions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>hbp_a1 <span class="ot">&lt;-</span> hbp_study <span class="sc">|&gt;</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(subj_id, sbp2, sbp1, age, bmi1, diabetes, tobacco) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The 7 variables in the <code>hbp_a1</code> tibble are as follows.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 14%">
<col style="width: 21%">
<col style="width: 63%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">Variable</th>
<th style="text-align: center;">Type</th>
<th>Description / Levels</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;"><code>subj_id</code></td>
<td style="text-align: center;">Character</td>
<td>subject code (A001-A999)</td>
</tr>
<tr class="even">
<td style="text-align: right;"><code>sbp2</code></td>
<td style="text-align: center;">Quantitative</td>
<td><strong>outcome</strong> variable, SBP after 18 months, in mm Hg</td>
</tr>
<tr class="odd">
<td style="text-align: right;"><code>sbp1</code></td>
<td style="text-align: center;">Quantitative</td>
<td><strong>key predictor</strong> baseline SBP (systolic blood pressure), in mm Hg</td>
</tr>
<tr class="even">
<td style="text-align: right;"><code>age</code></td>
<td style="text-align: center;">Quantitative</td>
<td>age of subject at baseline, in years</td>
</tr>
<tr class="odd">
<td style="text-align: right;"><code>bmi1</code></td>
<td style="text-align: center;">Quantitative</td>
<td>subject’s body-mass index at baseline</td>
</tr>
<tr class="even">
<td style="text-align: right;"><code>diabetes</code></td>
<td style="text-align: center;">Binary</td>
<td>Does subject have a diabetes diagnosis: No or Yes</td>
</tr>
<tr class="odd">
<td style="text-align: right;"><code>tobacco</code></td>
<td style="text-align: center;">3 level Cat.</td>
<td>subject’s tobacco use at baseline: never, quit (former), current</td>
</tr>
</tbody>
</table>
</section>
<section id="print-the-tibble" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="print-the-tibble"><span class="header-section-number">3.2</span> Print the Tibble</h2>
<p>First, we’ll provide a printout of the tibble, which confirms that we have one.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>hbp_a1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 999 × 7
   subj_id  sbp2  sbp1   age  bmi1 diabetes tobacco
   &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;fct&gt;    &lt;fct&gt;  
 1 A0001     138   147    58  24.4 No       never  
 2 A0004     134   134    65  50.5 No       never  
 3 A0005     140   170    61  29.8 Yes      current
 4 A0013     143   118    51  41.8 No       quit   
 5 A0015     162   132    61  31.0 No       never  
 6 A0017     141   110    45  33.0 No       current
 7 A0018     101   127    40  36.3 Yes      never  
 8 A0019     154   152    50  30.8 Yes      never  
 9 A0020     111   125    43  23.1 No       current
10 A0025     154   161    46  NA   No       never  
# ℹ 989 more rows</code></pre>
</div>
</div>
<p>OK. All set. Now we show the <code>data_codebook()</code> results.</p>
</section>
<section id="data_codebook-results" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="data_codebook-results"><span class="header-section-number">3.3</span> <code>data_codebook()</code> results</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data_codebook</span>(hbp_a1 <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="sc">-</span>subj_id))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>select(hbp_a1, -subj_id) (999 rows and 6 variables, 6 shown)

ID | Name     | Type        |  Missings |         Values |           N
---+----------+-------------+-----------+----------------+------------
1  | sbp2     | numeric     |  0 (0.0%) |      [77, 203] |         999
---+----------+-------------+-----------+----------------+------------
2  | sbp1     | numeric     |  0 (0.0%) |      [81, 205] |         999
---+----------+-------------+-----------+----------------+------------
3  | age      | numeric     |  0 (0.0%) |       [33, 83] |         999
---+----------+-------------+-----------+----------------+------------
4  | bmi1     | numeric     |  5 (0.5%) | [16.72, 74.65] |         994
---+----------+-------------+-----------+----------------+------------
5  | diabetes | categorical |  0 (0.0%) |             No | 668 (66.9%)
   |          |             |           |            Yes | 331 (33.1%)
---+----------+-------------+-----------+----------------+------------
6  | tobacco  | categorical | 23 (2.3%) |          never | 319 (32.7%)
   |          |             |           |           quit | 362 (37.1%)
   |          |             |           |        current | 295 (30.2%)
----------------------------------------------------------------------</code></pre>
</div>
</div>
<p>We should (and do) see no implausible values here, and our categorical variables are treated as factors with a rational ordering for the levels.</p>
</section>
<section id="our-single-imputation" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="our-single-imputation"><span class="header-section-number">3.4</span> Our Single Imputation</h2>
<p>We will now assuming MISSING AT RANDOM and singly impute the missing values in <code>hbp_a1</code>, creating a new analytic tibble called <code>hbp_a2</code>, which we will use for the rest of our work.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">4311</span>)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>hbp_imp <span class="ot">&lt;-</span> <span class="fu">mice</span>(hbp_a1, <span class="at">m =</span> <span class="dv">1</span>, <span class="at">printFlag =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Number of logged events: 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>hbp_a2 <span class="ot">&lt;-</span> <span class="fu">complete</span>(hbp_imp)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="fu">n_miss</span>(hbp_a2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
</div>
</section>
<section id="partition-the-data" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="partition-the-data"><span class="header-section-number">3.5</span> Partition the Data</h2>
<p>First, we should check that our subject identifying codes are unique to each row of our analytic data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="fu">nrow</span>(hbp_a2), <span class="fu">n_distinct</span>(hbp_a2<span class="sc">$</span>subj_id))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 999 999</code></pre>
</div>
</div>
<p>OK. Since those two values match, we should be ready to partition. We’ll put 70% of the data in the training sample (<code>hbp_train</code>) leaving the other 30% for the test sample (<code>hbp_test</code>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">4312</span>)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>hbp_train <span class="ot">&lt;-</span> hbp_a2 <span class="sc">|&gt;</span> <span class="fu">slice_sample</span>(<span class="at">prop =</span> <span class="fl">0.7</span>, <span class="at">replace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>hbp_test <span class="ot">&lt;-</span> <span class="fu">anti_join</span>(hbp_a2, hbp_train, <span class="at">by =</span> <span class="st">"subj_id"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="my-research-question" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> My Research Question</h1>
<p>Here you should provide background information on the study, and the subjects, so that we understand what you’re talking about in your research question. I’ll skip that in the demo, because I’ve done it already in introducing the data set, but you’ll need that here.</p>
<p>A natural research question here would be something like:</p>
<blockquote class="blockquote">
<p>How effectively can we predict systolic BP 18 months after baseline using baseline systolic BP, and is the quality of prediction meaningfully improved when I adjust for four other predictors (baseline age, body-mass index, diabetes diagnosis and tobacco use) in the <code>hbp_study</code> data?</p>
</blockquote>
<p>Please don’t feel obliged to follow this format precisely in stating your question, and note that your “smaller” model needs to include your key predictor <strong>and</strong> at least one other predictor, something I didn’t require of myself in posing this question.</p>
</section>
<section id="transforming-the-outcome" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Transforming the Outcome</h1>
<section id="visualizing-the-outcome-distribution" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="visualizing-the-outcome-distribution"><span class="header-section-number">5.1</span> Visualizing the Outcome Distribution</h2>
<p>I see at least three potential graphs to use to describe the distribution of our outcome variable, <code>sbp2</code>. Again, remember we’re using only the <strong>training</strong> sample here.</p>
<ul>
<li>A boxplot, probably accompanied by a violin plot to show the shape of the distribution more honestly.</li>
<li>A histogram, which could perhaps be presented as a density plot with a Normal distribution superimposed.</li>
<li>A Normal Q-Q plot to directly assess Normality.</li>
</ul>
<p>I expect you to show at least two of these three, but I will display all three here. Should we see substantial skew in the outcome data, we will want to consider an appropriate transformation, and then display the results of that transformation, as well.</p>
<p><strong>WARNING</strong>: Please note that I am deliberately showing you plots that are less finished than I hope you will provide.</p>
<ul>
<li>The coloring is dull or non-existent.</li>
<li>The theme is the default gray and white grid that lots of people dislike.</li>
<li>There are no meaningful titles or subtitles.</li>
<li>The axis labels select the default settings, and use incomprehensible variable names.</li>
<li>The coordinates aren’t flipped when that might be appropriate.</li>
<li>I expect a much nicer presentation in your final work. Use the class slides and course text for good ideas.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>viz1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(hbp_train, <span class="fu">aes</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> sbp2)) <span class="sc">+</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_violin</span>() <span class="sc">+</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">width =</span> <span class="fl">0.25</span>)</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>viz2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(hbp_train, <span class="fu">aes</span>(<span class="at">x =</span> sbp2)) <span class="sc">+</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">30</span>, <span class="at">col =</span> <span class="st">"white"</span>)</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>viz3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(hbp_train, <span class="fu">aes</span>(<span class="at">sample =</span> sbp2)) <span class="sc">+</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_qq</span>() <span class="sc">+</span> <span class="fu">geom_qq_line</span>()</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>viz1 <span class="sc">+</span> viz2 <span class="sc">+</span> viz3 <span class="sc">+</span></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(<span class="at">title =</span> <span class="st">"Less-Than-Great Plots of My Outcome's Distribution"</span>,</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>                  <span class="at">subtitle =</span> <span class="st">"complete with a rotten title, default axis labels and bad captions"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="sample-study2_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Later, we’ll augment this initial look at the outcome data with a Box-Cox plot to suggest a potential transformation. Should you decide to make such a transformation, remember to return here to plot the results for your new and transformed outcome.</p>
</section>
<section id="numerical-summary-of-the-outcome" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="numerical-summary-of-the-outcome"><span class="header-section-number">5.2</span> Numerical Summary of the Outcome</h2>
<p>Assuming you plan no transformation of the outcome (and in our case, I am happy that the outcome data appear reasonably well-modeled by the Normal distribution) then you should just summarize the training data, with your favorite tool for that task. That might be:</p>
<ul>
<li><code>lovedist()</code> from our <code>431-Love.R</code> script, or</li>
<li><code>favstats</code> from the <code>mosaic</code> package, as shown below, or</li>
<li>something else, I guess.</li>
</ul>
<p>But show <strong>ONE</strong> of these choices, and not all of them. Make a decision and go with it!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">favstats</span>(<span class="sc">~</span> sbp2, <span class="at">data =</span> hbp_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> min  Q1 median  Q3 max     mean      sd   n missing
  90 121    133 143 200 133.1645 17.6876 699       0</code></pre>
</div>
</div>
</section>
<section id="numerical-summaries-of-the-predictors" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="numerical-summaries-of-the-predictors"><span class="header-section-number">5.3</span> Numerical Summaries of the Predictors</h2>
<p>We also need an appropriate set of numerical summaries of each predictor variable, in the training data. The <code>inspect</code> function provides a way to get results like <code>favstats</code>, but for an entire data frame.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>hbp_train <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="sc">-</span>subj_id, <span class="sc">-</span>sbp2) <span class="sc">|&gt;</span> </span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inspect</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
categorical variables:  
      name  class levels   n missing
1 diabetes factor      2 699       0
2  tobacco factor      3 699       0
                                   distribution
1 No (66.1%), Yes (33.9%)                      
2 quit (37.5%), never (33.5%) ...              

quantitative variables:  
  name   class   min      Q1 median      Q3    max      mean        sd   n
1 sbp1 numeric 83.00 124.000 135.00 146.000 203.00 135.89843 17.777992 699
2  age numeric 33.00  52.000  59.00  66.000  83.00  58.78541 10.442077 699
3 bmi1 numeric 16.72  27.715  32.26  38.255  74.65  33.69518  8.448366 699
  missing
1       0
2       0
3       0</code></pre>
</div>
</div>
<p>Next, we will build and interpret a scatterplot matrix to describe the associations (both numerically and graphically) between the outcome and all predictors.</p>
<ul>
<li>We’ll also use a Box-Cox plot to investigate whether a transformation of our outcome is suggested, and</li>
<li>describe what a correlation matrix suggests about collinearity between candidate predictors.</li>
</ul>
</section>
<section id="scatterplot-matrix" class="level2" data-number="5.4">
<h2 data-number="5.4" class="anchored" data-anchor-id="scatterplot-matrix"><span class="header-section-number">5.4</span> Scatterplot Matrix</h2>
<p>Here, we will build a scatterplot matrix (or two) to show the relationship between our outcome and the predictors. I’ll demonstrate the use of <code>ggpairs</code> from the <code>GGally</code> package.</p>
<ul>
<li>If you have more than five predictors (as we do in our case) you should build two scatterplot matrices, each ending with the outcome. Anything more than one outcome and five predictors becomes unreadable in Professor Love’s view.</li>
<li>If you have a multi-categorical predictor with more than four categories, that predictor will be very difficult to see and explore in the scatterplot matrix produced.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> hbp_train <span class="sc">|&gt;</span> </span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(sbp1, age, bmi1, diabetes, tobacco, sbp2) </span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggpairs</span>(temp, <span class="at">title =</span> <span class="st">"Scatterplot Matrix"</span>,</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">lower =</span> <span class="fu">list</span>(<span class="at">combo =</span> <span class="fu">wrap</span>(<span class="st">"facethist"</span>, <span class="at">bins =</span> <span class="dv">20</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="sample-study2_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>At the end of this section, you should provide some discussion of the distribution of any key predictors, and their relationship to the outcome (all of that is provided in the bottom row if you place the outcome last, as you should, in selecting variables for the plot.)</p>
<p><strong>HINT</strong>: For categorical variables, your efforts in this regard to summarize the relationships you see may be challenging. Your comments would be aided by the judicious use of numerical summaries. For example, suppose you want to study the relationship between tobacco use and <code>sbp2</code>, then you probably want to run and discuss the following results, in addition to the scatterplot matrix above.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">favstats</span>(sbp2 <span class="sc">~</span> tobacco, <span class="at">data =</span> hbp_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  tobacco min     Q1 median    Q3 max     mean       sd   n missing
1   never  95 126.00    135 144.0 186 135.5385 16.49661 234       0
2    quit  95 119.25    130 141.0 182 131.0992 16.55542 262       0
3 current  90 119.00    134 145.5 200 133.0936 20.02340 203       0</code></pre>
</div>
</div>
</section>
<section id="collinearity-checking" class="level2" data-number="5.5">
<h2 data-number="5.5" class="anchored" data-anchor-id="collinearity-checking"><span class="header-section-number">5.5</span> Collinearity Checking</h2>
<p>Next, we’ll take a brief look at potential collinearity. Remember that we want to see strong correlations between our <strong>outcome</strong> and the predictors, but relatively modest correlations between the predictors.</p>
<p>None of the numeric candidate predictors show any substantial correlation with each other. The largest Pearson correlation (in absolute value) between predictors is (-0.239) for <code>age</code> and <code>bmi1</code>, and that’s not strong. If we did see signs of meaningful collinearity, we might rethink our selected set of predictors.</p>
<p>I’ll recommend later that you run a generalized VIF (variance inflation factor) calculation<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> after fitting your kitchen sink model just to see if anything pops up (in my case, it won’t.)</p>
</section>
<section id="boxcox-function-to-assess-need-for-transformation-of-our-outcome" class="level2" data-number="5.6">
<h2 data-number="5.6" class="anchored" data-anchor-id="boxcox-function-to-assess-need-for-transformation-of-our-outcome"><span class="header-section-number">5.6</span> <code>boxCox</code> function to assess need for transformation of our outcome</h2>
<p>To use the <code>boxCox</code> approach here, we need to ensure that the distribution of our outcome, <code>sbp2</code>, includes strictly positive values. We can see from our numerical summary earlier that the minimum <code>sbp2</code> in our <code>hbp_train</code> sample is 90, so we’re OK.</p>
<ul>
<li>Note that I am restricting myself here to the five predictors I actually intend to use in building models.</li>
<li>Although we’re generally using a 90% confidence interval in this project, we won’t worry about that issue in the <code>boxCox</code> plot, and instead just look at the point estimate from <code>powerTransform</code>.</li>
<li>These commands (<code>boxCox</code> and <code>powerTransform</code>) come from the <code>car</code> package.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>model_temp <span class="ot">&lt;-</span> <span class="fu">lm</span>(sbp2 <span class="sc">~</span> sbp1 <span class="sc">+</span> age <span class="sc">+</span> bmi1 <span class="sc">+</span> diabetes <span class="sc">+</span> tobacco,</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data =</span> hbp_train)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="fu">boxCox</span>(model_temp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="sample-study2_files/figure-html/boxCox_plot-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The estimated power transformation is about 0.5, which looks like a square root transformation of <code>sbp2</code> is useful. Given that I’m using another measure of <code>sbp</code>, specifically, <code>sbp1</code> to predict <code>sbp2</code>, perhaps I want to transform that, too?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(hbp_train, <span class="fu">aes</span>(<span class="at">x =</span> sbp1, <span class="at">y =</span> <span class="fu">sqrt</span>(sbp2))) <span class="sc">+</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"loess"</span>, <span class="at">formula =</span> y <span class="sc">~</span> x, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> </span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">formula =</span> y <span class="sc">~</span> x, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"SQRT(sbp2) vs. SBP1"</span>)</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(hbp_train, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">sqrt</span>(sbp1), <span class="at">y =</span> <span class="fu">sqrt</span>(sbp2))) <span class="sc">+</span></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"loess"</span>, <span class="at">formula =</span> y <span class="sc">~</span> x, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> </span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">formula =</span> y <span class="sc">~</span> x, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> </span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"SQRT(sbp2) vs. SQRT(sbp1)"</span>)</span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="sample-study2_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>I don’t see an especially large difference between these two plots. It is up to you to decide whether a transformation suggested by <code>boxCox</code> should be applied to your data.</p>
<ul>
<li>For the purposes of this project, you should stick to transformations of strictly positive outcomes, and to the square root (power = 0.5), square (power = 2), logarithm (power = 0) and inverse (power = -1) transformations. Don’t make the transformation without being able to interpret the result well.</li>
<li>Feel encouraged to scale your transformations (by multiplying or dividing by a constant) so that most of the transformed values wind up between 0 and 100 or 0 and 1000, if you like.</li>
<li>If you do decide to include a transformation of your outcome in fitting models, be sure to back-transform any predictions you make at the end of the study so that we can understand the prediction error results.</li>
<li>If your outcome data are substantially multimodal, I wouldn’t treat the <code>boxCox</code> results as meaningful.</li>
</ul>
<p>I’m going to use the square root transformation for both my outcome and for the key predictor, but I don’t think it makes a big difference. I’m doing it mostly so that I can show you how to back-transform later.</p>
</section>
</section>
<section id="the-big-model" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> The Big Model</h1>
<p>We will specify a “kitchen sink” linear regression model to describe the relationship between our outcome (potentially after transformation) and the main effects of each of our predictors. We’ll need to:</p>
<ul>
<li>We’ll assess the overall effectiveness, within your training sample, of your model, by considering performance in the training sample using a wide range of summaries.<br>
</li>
<li>We’ll need to specify the size, magnitude and meaning of all coefficients, and identify appropriate conclusions regarding effect sizes with 90% confidence intervals.</li>
<li>Finally, we’ll assess whether collinearity in the kitchen sink model has a meaningful impact, and describe how we know that.</li>
</ul>
<section id="fittingsummarizing-the-kitchen-sink-model" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="fittingsummarizing-the-kitchen-sink-model"><span class="header-section-number">6.1</span> Fitting/Summarizing the Kitchen Sink model</h2>
<p>Our “kitchen sink” or “big” model predicts the square root of <code>sbp2</code> using the predictors (square root of <code>sbp1</code>), <code>age</code>, <code>bmi1</code>, <code>diabetes</code> and <code>tobacco</code>.</p>
<p>First, we’ll use <code>mutate</code> to create our two new transformed variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>hbp_train <span class="ot">&lt;-</span> hbp_train <span class="sc">|&gt;</span> </span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sbp2_tr =</span> <span class="fu">sqrt</span>(sbp2), <span class="at">sbp1_tr =</span> <span class="fu">sqrt</span>(sbp1))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, we’ll fit our “big” (kitchen sink) model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>model_big <span class="ot">&lt;-</span> <span class="fu">lm</span>(sbp2_tr <span class="sc">~</span> sbp1_tr <span class="sc">+</span> age <span class="sc">+</span> bmi1 <span class="sc">+</span> diabetes <span class="sc">+</span> tobacco, </span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> hbp_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">model_performance</span>(model_big)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># Indices of model performance

AIC      |     AICc |      BIC |    R2 | R2 (adj.) |  RMSE | Sigma
------------------------------------------------------------------
1525.395 | 1525.603 | 1561.792 | 0.128 |     0.121 | 0.712 | 0.716</code></pre>
</div>
</div>
</section>
<section id="effect-sizes-coefficient-estimates" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="effect-sizes-coefficient-estimates"><span class="header-section-number">6.2</span> Effect Sizes: Coefficient Estimates</h2>
<p>Specify the size and magnitude of all coefficients, providing estimated effect sizes with 90% confidence intervals.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">model_parameters</span>(model_big, <span class="at">ci =</span> <span class="fl">0.90</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Parameter         | Coefficient |       SE |         90% CI | t(692) |      p
-----------------------------------------------------------------------------
(Intercept)       |        7.31 |     0.47 | [ 6.53,  8.08] |  15.51 | &lt; .001
sbp1 tr           |        0.34 |     0.04 | [ 0.28,  0.40] |   9.39 | &lt; .001
age               |    3.58e-03 | 2.82e-03 | [ 0.00,  0.01] |   1.27 | 0.205 
bmi1              |    4.18e-03 | 3.49e-03 | [ 0.00,  0.01] |   1.20 | 0.231 
diabetes [Yes]    |   -9.27e-03 |     0.06 | [-0.10,  0.09] |  -0.16 | 0.873 
tobacco [quit]    |       -0.15 |     0.07 | [-0.25, -0.04] |  -2.23 | 0.026 
tobacco [current] |       -0.05 |     0.07 | [-0.16,  0.07] |  -0.63 | 0.530 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Uncertainty intervals (equal-tailed) and p-values (two-tailed) computed
  using a Wald t-distribution approximation.</code></pre>
</div>
</div>
</section>
<section id="describing-the-equation" class="level2" data-number="6.3">
<h2 data-number="6.3" class="anchored" data-anchor-id="describing-the-equation"><span class="header-section-number">6.3</span> Describing the Equation</h2>
<p>This model implies for the key predictor (<code>sbp_1</code>) that:</p>
<ul>
<li><strong>Point Estimate</strong>: If we had two subjects with the same values of age, BMI, diabetes and tobacco status, but A had a baseline square root of SBP of, for example, 12 (so an SBP at baseline of 144) and B had a baseline square root of SBP one unit lower, so for example, 11 (so an SBP at baseline of 121) our <code>model_big</code> predicts that the square root of subject A’s SBP at 18 months will be 0.34 points higher (90% CI: 0.28, 0.40) than that of subject B.</li>
<li><strong>90% Confidence Interval</strong>: Our <code>model_big</code> estimates the slope of the square root of <code>sbp_1</code> to be 0.34 in the participants in our study. When we generalize beyond study participants to the population they were selected at random from, then our data are compatible (at the 90% confidence level) with population slopes between 0.28 and 0.40 for our transformed <code>sbp_1</code>.</li>
</ul>
<p>You should also provide a description of the meaning (especially the direction) of the <strong>point estimates</strong> of the other coefficients in your model being sure to interpret the coefficients as having meaning <em>holding all other predictors constant</em>, but I’ll skip that here.</p>
</section>
</section>
<section id="the-smaller-model" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> The Smaller Model</h1>
<p>Here, we will build a second linear regression model using a subset of our “kitchen sink” model predictors, chosen to maximize predictive value within our training sample.</p>
<ul>
<li>We’ll specify the method you used to obtain this new model. (Backwards stepwise elimination is appealing but not great. It’s perfectly fine to just include the key predictor and one other predictor you like, or to use best subsets to generate a subset for this new model, so long as your subset includes your key predictor.)</li>
</ul>
<section id="backwards-stepwise-elimination" class="level2" data-number="7.1">
<h2 data-number="7.1" class="anchored" data-anchor-id="backwards-stepwise-elimination"><span class="header-section-number">7.1</span> Backwards Stepwise Elimination</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">step</span>(model_big)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Start:  AIC=-460.28
sbp2_tr ~ sbp1_tr + age + bmi1 + diabetes + tobacco

           Df Sum of Sq    RSS     AIC
- diabetes  1     0.013 354.66 -462.26
- bmi1      1     0.736 355.39 -460.83
- age       1     0.826 355.48 -460.65
&lt;none&gt;                  354.65 -460.28
- tobacco   2     2.658 357.31 -459.06
- sbp1_tr   1    45.165 399.82 -378.49

Step:  AIC=-462.26
sbp2_tr ~ sbp1_tr + age + bmi1 + tobacco

          Df Sum of Sq    RSS     AIC
- bmi1     1     0.722 355.39 -462.83
- age      1     0.820 355.49 -462.64
&lt;none&gt;                 354.66 -462.26
- tobacco  2     2.677 357.34 -461.00
- sbp1_tr  1    45.152 399.82 -380.49

Step:  AIC=-462.83
sbp2_tr ~ sbp1_tr + age + tobacco

          Df Sum of Sq    RSS     AIC
- age      1     0.457 355.84 -463.93
&lt;none&gt;                 355.39 -462.83
- tobacco  2     2.732 358.12 -461.48
- sbp1_tr  1    46.258 401.65 -379.30

Step:  AIC=-463.93
sbp2_tr ~ sbp1_tr + tobacco

          Df Sum of Sq    RSS     AIC
&lt;none&gt;                 355.84 -463.93
- tobacco  2     2.452 358.30 -463.13
- sbp1_tr  1    46.423 402.27 -380.22</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = sbp2_tr ~ sbp1_tr + tobacco, data = hbp_train)

Coefficients:
   (Intercept)         sbp1_tr     tobaccoquit  tobaccocurrent  
       7.62034         0.34114        -0.14135        -0.07367  </code></pre>
</div>
</div>
<p>The backwards selection stepwise approach suggests a model with <code>sqrt(sbp1)</code> and <code>tobacco</code>, but not <code>age</code>, <code>bmi1</code> or <code>diabetes</code>.</p>
</section>
<section id="fitting-the-small-model" class="level2" data-number="7.2">
<h2 data-number="7.2" class="anchored" data-anchor-id="fitting-the-small-model"><span class="header-section-number">7.2</span> Fitting the “small” model</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>model_small <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">sqrt</span>(sbp2) <span class="sc">~</span> <span class="fu">sqrt</span>(sbp1) <span class="sc">+</span> tobacco, <span class="at">data =</span> hbp_train)</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a><span class="fu">model_performance</span>(model_small)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># Indices of model performance

AIC      |     AICc |      BIC |    R2 | R2 (adj.) |  RMSE | Sigma
------------------------------------------------------------------
5903.846 | 5903.932 | 5926.594 | 0.126 |     0.122 | 0.713 | 0.716</code></pre>
</div>
</div>
</section>
<section id="effect-sizes-coefficient-estimates-1" class="level2" data-number="7.3">
<h2 data-number="7.3" class="anchored" data-anchor-id="effect-sizes-coefficient-estimates-1"><span class="header-section-number">7.3</span> Effect Sizes: Coefficient Estimates</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">model_parameters</span>(model_small, <span class="at">ci =</span> <span class="fl">0.90</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Parameter         | Coefficient |   SE |         90% CI | t(695) |      p
-------------------------------------------------------------------------
(Intercept)       |        7.62 | 0.42 | [ 6.92,  8.32] |  18.03 | &lt; .001
sbp1 [sqrt]       |        0.34 | 0.04 | [ 0.28,  0.40] |   9.52 | &lt; .001
tobacco [quit]    |       -0.14 | 0.06 | [-0.25, -0.03] |  -2.19 | 0.029 
tobacco [current] |       -0.07 | 0.07 | [-0.19,  0.04] |  -1.07 | 0.285 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Uncertainty intervals (equal-tailed) and p-values (two-tailed) computed
  using a Wald t-distribution approximation.</code></pre>
</div>
</div>
</section>
<section id="interpreting-the-small-model-regression-equation" class="level2" data-number="7.4">
<h2 data-number="7.4" class="anchored" data-anchor-id="interpreting-the-small-model-regression-equation"><span class="header-section-number">7.4</span> Interpreting the Small Model Regression Equation</h2>
<p>Here, we again need to specify the size and magnitude of all coefficients, providing estimated effect sizes with 90% confidence intervals.</p>
<p>I’ll skip the necessary English sentences here in the demo that explain the meaning of the estimates in our model. You should provide a detailed explanation of the point estimates for all slopes, and of the confidence interval for the slope of your key predictor.</p>
</section>
</section>
<section id="in-sample-comparison" class="level1" data-number="8">
<h1 data-number="8"><span class="header-section-number">8</span> In-Sample Comparison</h1>
<section id="compare-performance" class="level2" data-number="8.1">
<h2 data-number="8.1" class="anchored" data-anchor-id="compare-performance"><span class="header-section-number">8.1</span> Compare Performance</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">compare_performance</span>(model_big, model_small))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>When comparing models, please note that probably not all models were fit
  from same data.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="sample-study2_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">compare_performance</span>(model_big, model_small, <span class="at">rank =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>When comparing models, please note that probably not all models were fit
  from same data.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># Comparison of Model Performance Indices

Name        | Model |    R2 | R2 (adj.) |  RMSE | Sigma | AIC weights | AICc weights | BIC weights | Performance-Score
----------------------------------------------------------------------------------------------------------------------
model_big   |    lm | 0.128 |     0.121 | 0.712 | 0.716 |        1.00 |         1.00 |        1.00 |            71.43%
model_small |    lm | 0.126 |     0.122 | 0.713 | 0.716 |    0.00e+00 |     0.00e+00 |    0.00e+00 |            28.57%</code></pre>
</div>
</div>
<p>These results can be summarized as follows:</p>
<ul>
<li><code>model_big</code> (naturally) has a stronger <span class="math inline">\(R^2\)</span> result, but it also has a better result for RMSE, AIC and BIC.</li>
<li><code>model_small</code> has a stronger result for Adjusted <span class="math inline">\(R^2\)</span> and Sigma.</li>
</ul>
</section>
<section id="assessing-assumptions" class="level2" data-number="8.2">
<h2 data-number="8.2" class="anchored" data-anchor-id="assessing-assumptions"><span class="header-section-number">8.2</span> Assessing Assumptions</h2>
<p>Here, we should run a set of residual plots for each model, with <code>check_model()</code> and interpret your findings in each case, carefully. I’ll show my plots for <code>model_big</code> here.</p>
<section id="checking-model_big" class="level3" data-number="8.2.1">
<h3 data-number="8.2.1" class="anchored" data-anchor-id="checking-model_big"><span class="header-section-number">8.2.1</span> Checking <code>model_big</code></h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">check_model</span>(model_big)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="sample-study2_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>I see no serious problems with the assumptions of linearity, Normality and constant variance, nor do I see any highly influential points in our big model.</p>
</section>
<section id="does-collinearity-have-a-meaningful-impact" class="level3" data-number="8.2.2">
<h3 data-number="8.2.2" class="anchored" data-anchor-id="does-collinearity-have-a-meaningful-impact"><span class="header-section-number">8.2.2</span> Does collinearity have a meaningful impact?</h3>
<p>If we fit models with multiple predictors, then we might want to augment the plot above by assessing variance inflation factors to see the potential impact of collinearity.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">vif</span>(model_big)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             GVIF Df GVIF^(1/(2*Df))
sbp1_tr  1.014160  1        1.007055
age      1.181857  1        1.087132
bmi1     1.185957  1        1.089017
diabetes 1.027252  1        1.013534
tobacco  1.165447  2        1.039018</code></pre>
</div>
</div>
<p>We’d need to see a generalized variance inflation factor above 5 for collinearity to be a meaningful concern, so we should be fine in our big model. Our small model also has multiple predictors, but collinearity cannot be an issue, since it’s just a subset of our big model, which didn’t have a collinearity problem.</p>
</section>
</section>
<section id="comparing-the-models" class="level2" data-number="8.3">
<h2 data-number="8.3" class="anchored" data-anchor-id="comparing-the-models"><span class="header-section-number">8.3</span> Comparing the Models</h2>
<p>Based on the training sample, you should draw a conclusion. So far, I will support the larger model. It has (slightly) better performance on the fit quality measures, and each model shows no serious problems with regression assumptions.</p>
</section>
</section>
<section id="model-validation" class="level1" data-number="9">
<h1 data-number="9"><span class="header-section-number">9</span> Model Validation</h1>
<p>Now, we will use our two regression models to predict the value of our outcome using the predictor values in the test sample.</p>
<ul>
<li>We may need to back-transform the predictions to the original units if we wind up fitting a model to a transformed outcome.</li>
<li>We’ll definitely need to compare the two models in terms of our four main summaries, in a Table, which I will definitely want to see in your portfolio.</li>
<li>We’ll have to specify which model appears better at out-of-sample prediction according to these comparisons, and how we know that.</li>
</ul>
<section id="calculating-prediction-errors" class="level2" data-number="9.1">
<h2 data-number="9.1" class="anchored" data-anchor-id="calculating-prediction-errors"><span class="header-section-number">9.1</span> Calculating Prediction Errors</h2>
<section id="big-model-back-transformation-and-calculating-fitsresiduals" class="level3" data-number="9.1.1">
<h3 data-number="9.1.1" class="anchored" data-anchor-id="big-model-back-transformation-and-calculating-fitsresiduals"><span class="header-section-number">9.1.1</span> Big Model: Back-Transformation and Calculating Fits/Residuals</h3>
<p>First, we need to create our transformed data in our test data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>hbp_test <span class="ot">&lt;-</span> hbp_test <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">sbp1_tr =</span> <span class="fu">sqrt</span>(sbp1), <span class="at">sbp2_tr =</span> <span class="fu">sqrt</span>(sbp2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We’ll use the <code>augment</code> function from the <code>broom</code> package to help us here, and create <code>sbp2_fit</code> to hold the fitted values on the original <code>sbp2</code> scale after back-transformation (by squaring the predictions on the square root scale) and then <code>sbp2_res</code> to hold the residuals (prediction errors) we observe using the big model on the <code>hbp_test</code> data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>aug_big <span class="ot">&lt;-</span> <span class="fu">augment</span>(model_big, <span class="at">newdata =</span> hbp_test) <span class="sc">|&gt;</span> </span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mod_name =</span> <span class="st">"big"</span>,</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">sbp2_fit =</span> .fitted<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">sbp2_res =</span> sbp2 <span class="sc">-</span> sbp2_fit) <span class="sc">|&gt;</span></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(subj_id, mod_name, sbp2, sbp2_fit, sbp2_res, <span class="fu">everything</span>())</span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(aug_big,<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 14
  subj_id mod_name  sbp2 sbp2_fit sbp2_res  sbp1   age  bmi1 diabetes tobacco
  &lt;chr&gt;   &lt;chr&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;fct&gt;    &lt;fct&gt;  
1 A0001   big        138     137.    0.886   147    58  24.4 No       never  
2 A0018   big        101     130.  -28.9     127    40  36.3 Yes      never  
3 A0032   big        147     129.   18.1     130    58  32.8 No       quit   
# ℹ 4 more variables: sbp1_tr &lt;dbl&gt;, sbp2_tr &lt;dbl&gt;, .fitted &lt;dbl&gt;, .resid &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
<section id="small-model-back-transformation-and-calculating-fitsresiduals" class="level3" data-number="9.1.2">
<h3 data-number="9.1.2" class="anchored" data-anchor-id="small-model-back-transformation-and-calculating-fitsresiduals"><span class="header-section-number">9.1.2</span> Small Model: Back-Transformation and Calculating Fits/Residuals</h3>
<p>We’ll do the same thing, but using the small model in the <code>hbp_test</code> data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>aug_small <span class="ot">&lt;-</span> <span class="fu">augment</span>(model_small, <span class="at">newdata =</span> hbp_test) <span class="sc">|&gt;</span> </span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mod_name =</span> <span class="st">"small"</span>,</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">sbp2_fit =</span> .fitted<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">sbp2_res =</span> sbp2 <span class="sc">-</span> sbp2_fit) <span class="sc">|&gt;</span></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(subj_id, mod_name, sbp2, sbp2_fit, sbp2_res, <span class="fu">everything</span>())</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(aug_small,<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 14
  subj_id mod_name  sbp2 sbp2_fit sbp2_res  sbp1   age  bmi1 diabetes tobacco
  &lt;chr&gt;   &lt;chr&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;fct&gt;    &lt;fct&gt;  
1 A0001   small      138     138.   -0.215   147    58  24.4 No       never  
2 A0018   small      101     131.  -30.4     127    40  36.3 Yes      never  
3 A0032   small      147     129.   17.8     130    58  32.8 No       quit   
# ℹ 4 more variables: sbp1_tr &lt;dbl&gt;, sbp2_tr &lt;dbl&gt;, .fitted &lt;dbl&gt;, .resid &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
<section id="combining-the-results" class="level3" data-number="9.1.3">
<h3 data-number="9.1.3" class="anchored" data-anchor-id="combining-the-results"><span class="header-section-number">9.1.3</span> Combining the Results</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>test_comp <span class="ot">&lt;-</span> <span class="fu">union</span>(aug_big, aug_small) <span class="sc">|&gt;</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(subj_id, mod_name)</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>test_comp <span class="sc">|&gt;</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 14
  subj_id mod_name  sbp2 sbp2_fit sbp2_res  sbp1   age  bmi1 diabetes tobacco
  &lt;chr&gt;   &lt;chr&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;fct&gt;    &lt;fct&gt;  
1 A0001   big        138     137.    0.886   147    58  24.4 No       never  
2 A0001   small      138     138.   -0.215   147    58  24.4 No       never  
3 A0002   big        138     133.    5.43    130    64  30.8 No       never  
4 A0002   small      138     132.    5.52    130    64  30.8 No       never  
5 A0003   big        131     128.    2.87    130    52  29.4 No       quit   
6 A0003   small      131     129.    1.75    130    52  29.4 No       quit   
# ℹ 4 more variables: sbp1_tr &lt;dbl&gt;, sbp2_tr &lt;dbl&gt;, .fitted &lt;dbl&gt;, .resid &lt;dbl&gt;</code></pre>
</div>
</div>
<p>Given this <code>test_comp</code> tibble, including predictions and residuals from the kitchen sink model on our test data, we can now:</p>
<ol type="1">
<li>Visualize the prediction errors from each model.</li>
<li>Summarize those errors across each model.</li>
<li>Identify the “worst fitting” subject for each model in the test sample.</li>
</ol>
<p>The next few subsections actually do these things.</p>
</section>
</section>
<section id="visualizing-the-predictions" class="level2" data-number="9.2">
<h2 data-number="9.2" class="anchored" data-anchor-id="visualizing-the-predictions"><span class="header-section-number">9.2</span> Visualizing the Predictions</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(test_comp, <span class="fu">aes</span>(<span class="at">x =</span> sbp2_fit, <span class="at">y =</span> sbp2)) <span class="sc">+</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">1</span>, <span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">lty =</span> <span class="st">"dashed"</span>) <span class="sc">+</span> </span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"loess"</span>, <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">formula =</span> y <span class="sc">~</span> x) <span class="sc">+</span></span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>( <span class="sc">~</span> mod_name, <span class="at">labeller =</span> <span class="st">"label_both"</span>) <span class="sc">+</span></span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Predicted sbp2"</span>,</span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Observed sbp2"</span>,</span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Observed vs. Predicted sbp2"</span>,</span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Comparing Big to Small Model in Test Sample"</span>,</span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">"Dashed line is where Observed = Predicted"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="sample-study2_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>I’m not seeing a lot of difference between the models in terms of the adherence of the points to the dashed line. The models seem to be making fairly similar errors.</p>
</section>
<section id="summarizing-the-errors" class="level2" data-number="9.3">
<h2 data-number="9.3" class="anchored" data-anchor-id="summarizing-the-errors"><span class="header-section-number">9.3</span> Summarizing the Errors</h2>
<p>Calculate the mean absolute prediction error (MAPE), the root mean squared prediction error (RMSPE) and the maximum absolute error across the predictions made by each model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>test_comp <span class="sc">|&gt;</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(mod_name) <span class="sc">|&gt;</span></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">MAPE =</span> <span class="fu">mean</span>(<span class="fu">abs</span>(sbp2_res)), </span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">RMSPE =</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>(sbp2_res<span class="sc">^</span><span class="dv">2</span>)),</span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">max_error =</span> <span class="fu">max</span>(<span class="fu">abs</span>(sbp2_res)),</span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">R2_val =</span> <span class="fu">cor</span>(sbp2, sbp2_fit)<span class="sc">^</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 6
  mod_name     n  MAPE RMSPE max_error R2_val
  &lt;chr&gt;    &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;  &lt;dbl&gt;
1 big        300  13.7  17.3      48.8  0.127
2 small      300  13.7  17.3      49.2  0.126</code></pre>
</div>
</div>
<p>This is a table Dr.&nbsp;Love will <strong>definitely</strong> need to see during your presentation.</p>
<p>In this case, all four of these summaries are better for the bigger model.</p>
<p>These models suggest an average error in predicting systolic blood pressure (using MAPE) of more than 13 mm Hg. That’s not great on the scale of systolic blood pressure, I think. In addition, our validated <span class="math inline">\(R^2\)</span> values here are only slightly worse (in either model) than what we saw in our training sample.</p>
<section id="identify-the-largest-errors" class="level3" data-number="9.3.1">
<h3 data-number="9.3.1" class="anchored" data-anchor-id="identify-the-largest-errors"><span class="header-section-number">9.3.1</span> Identify the largest errors</h3>
<p>Identify the subject(s) where that maximum prediction error was made by each model, and the observed and model-fitted values of <code>sbp2</code> for that subject in each case.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>temp1 <span class="ot">&lt;-</span> aug_big <span class="sc">|&gt;</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">abs</span>(sbp2_res) <span class="sc">==</span> <span class="fu">max</span>(<span class="fu">abs</span>(sbp2_res)))</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>temp2 <span class="ot">&lt;-</span> aug_small <span class="sc">|&gt;</span></span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">abs</span>(sbp2_res) <span class="sc">==</span> <span class="fu">max</span>(<span class="fu">abs</span>(sbp2_res)))</span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(temp1, temp2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 14
  subj_id mod_name  sbp2 sbp2_fit sbp2_res  sbp1   age  bmi1 diabetes tobacco
  &lt;chr&gt;   &lt;chr&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;fct&gt;    &lt;fct&gt;  
1 A0703   big        178     129.     48.8   130    64  30.0 No       quit   
2 A0265   small      180     131.     49.2   130    65  27.3 No       current
# ℹ 4 more variables: sbp1_tr &lt;dbl&gt;, sbp2_tr &lt;dbl&gt;, .fitted &lt;dbl&gt;, .resid &lt;dbl&gt;</code></pre>
</div>
</div>
<ul>
<li>In our case, a different subject (<code>A0703</code> in the big model, and <code>A0265</code> in the small model) was most poorly fit by each model.</li>
</ul>
</section>
</section>
<section id="comparing-the-models-1" class="level2" data-number="9.4">
<h2 data-number="9.4" class="anchored" data-anchor-id="comparing-the-models-1"><span class="header-section-number">9.4</span> Comparing the Models</h2>
<p>I would select <code>model_big</code> here, on the basis of the similar performance in terms of the visualization of errors, and small improvements in all four of our main test sample summaries.</p>
</section>
</section>
<section id="discussion" class="level1" data-number="10">
<h1 data-number="10"><span class="header-section-number">10</span> Discussion</h1>
<section id="chosen-model" class="level2" data-number="10.1">
<h2 data-number="10.1" class="anchored" data-anchor-id="chosen-model"><span class="header-section-number">10.1</span> Chosen Model</h2>
<p>I chose the bigger model. You’ll want to briefly reiterate the reasons why in this subsection, using results related to training-sample summaries, training-sample assumptions and model checks, and test-sample performance assessments. If you have evidence towards both models, decide what’s more important to you, and pick a winner.</p>
</section>
<section id="answering-my-question" class="level2" data-number="10.2">
<h2 data-number="10.2" class="anchored" data-anchor-id="answering-my-question"><span class="header-section-number">10.2</span> Answering My Question</h2>
<p>Now use the winning model to answer the research question, in a complete sentence of two.</p>
</section>
<section id="next-steps" class="level2" data-number="10.3">
<h2 data-number="10.3" class="anchored" data-anchor-id="next-steps"><span class="header-section-number">10.3</span> Next Steps</h2>
<p>Describe an interesting next step, which might involve fitting a new model not available with your current cleaned data, or dealing with missing values differently, or obtaining new or better data, or something else. You should be able to describe why this might help.</p>
</section>
<section id="reflection" class="level2" data-number="10.4">
<h2 data-number="10.4" class="anchored" data-anchor-id="reflection"><span class="header-section-number">10.4</span> Reflection</h2>
<p>Tell us what you know now that would have changed your approach to Study 2 had you known it at the start.</p>
</section>
</section>
<section id="session-information" class="level1" data-number="11">
<h1 data-number="11"><span class="header-section-number">11</span> Session Information</h1>
<p>should be included at the end of your report, from the <strong>xfun</strong> package, please.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">session_info</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R version 4.4.2 (2024-10-31 ucrt)
Platform: x86_64-w64-mingw32/x64
Running under: Windows 11 x64 (build 22631)

Locale:
  LC_COLLATE=English_United States.utf8 
  LC_CTYPE=English_United States.utf8   
  LC_MONETARY=English_United States.utf8
  LC_NUMERIC=C                          
  LC_TIME=English_United States.utf8    

Package version:
  abind_1.4-8          askpass_1.2.1        backports_1.5.0     
  base64enc_0.1.3      bayestestR_0.15.0    bit_4.5.0           
  bit64_4.5.2          blob_1.2.4           boot_1.3-31         
  broom_1.0.7          bslib_0.8.0          cachem_1.1.0        
  callr_3.7.6          car_3.1-3            carData_3.0-5       
  cellranger_1.1.0     cli_3.6.3            clipr_0.8.0         
  coda_0.19-4.1        codetools_0.2-20     colorspace_2.1-1    
  compiler_4.4.2       conflicted_1.2.0     correlation_0.8.6   
  cowplot_1.1.3        cpp11_0.5.0          crayon_1.5.3        
  curl_6.0.1           data.table_1.16.2    datasets_4.4.2      
  datawizard_0.13.0    DBI_1.2.3            dbplyr_2.5.0        
  Deriv_4.1.6          digest_0.6.37        doBy_4.6.24         
  dplyr_1.1.4          dtplyr_1.3.1         easystats_0.7.3     
  effectsize_0.8.9     emmeans_1.10.5       estimability_1.5.1  
  evaluate_1.0.1       fansi_1.0.6          farver_2.1.2        
  fastmap_1.2.0        fontawesome_0.5.3    forcats_1.0.0       
  foreach_1.5.2        Formula_1.2-5        fs_1.6.5            
  gargle_1.5.2         generics_0.1.3       GGally_2.2.1        
  ggformula_0.12.0     ggplot2_3.5.1        ggrepel_0.9.6       
  ggridges_0.5.6       ggstats_0.7.0        glmnet_4.1-8        
  glue_1.8.0           googledrive_2.1.1    googlesheets4_1.1.1 
  graphics_4.4.2       grDevices_4.4.2      grid_4.4.2          
  gridExtra_2.3        gtable_0.3.6         haven_2.5.4         
  highr_0.11           hms_1.1.3            htmltools_0.5.8.1   
  htmlwidgets_1.6.4    httr_1.4.7           ids_1.0.1           
  insight_0.20.5       isoband_0.2.7        iterators_1.0.14    
  janitor_2.2.0        jomo_2.7-6           jquerylib_0.1.4     
  jsonlite_1.8.9       knitr_1.49           labeling_0.4.3      
  labelled_2.13.0      lattice_0.22-6       lifecycle_1.0.4     
  lme4_1.1-35.5        lubridate_1.9.3      magrittr_2.0.3      
  MASS_7.3-61          Matrix_1.7-1         MatrixModels_0.5.3  
  memoise_2.0.1        methods_4.4.2        mgcv_1.9-1          
  mice_3.16.0          microbenchmark_1.5.0 mime_0.12           
  minqa_1.2.8          mitml_0.4-5          modelbased_0.8.9    
  modelr_0.1.11        mosaic_1.9.1         mosaicCore_0.9.4.0  
  mosaicData_0.20.4    multcomp_1.4-26      munsell_0.5.1       
  mvtnorm_1.3-2        naniar_1.1.0         nlme_3.1-166        
  nloptr_2.1.1         nnet_7.3-19          norm_1.0.11.1       
  numDeriv_2016.8.1.1  openssl_2.2.2        ordinal_2023.12.4.1 
  pan_1.9              parallel_4.4.2       parameters_0.23.0   
  patchwork_1.3.0      pbkrtest_0.5.3       performance_0.12.4  
  pillar_1.9.0         pkgconfig_2.0.3      plyr_1.8.9          
  prettyunits_1.2.0    processx_3.8.4       progress_1.2.3      
  ps_1.8.1             purrr_1.0.2          quantreg_5.99       
  R6_2.5.1             ragg_1.3.3           rappdirs_0.3.3      
  RColorBrewer_1.1-3   Rcpp_1.0.13-1        RcppEigen_0.3.4.0.2 
  readr_2.1.5          readxl_1.4.3         rematch_2.0.0       
  rematch2_2.1.2       report_0.5.9         reprex_2.1.1        
  rlang_1.1.4          rmarkdown_2.29       rpart_4.1.23        
  rstudioapi_0.17.1    rvest_1.0.4          sandwich_3.1-1      
  sass_0.4.9           scales_1.3.0         see_0.9.0           
  selectr_0.4.2        shape_1.4.6.1        snakecase_0.11.1    
  SparseM_1.84.2       splines_4.4.2        stats_4.4.2         
  stringi_1.8.4        stringr_1.5.1        survival_3.7-0      
  sys_3.4.3            systemfonts_1.1.0    textshaping_0.4.0   
  TH.data_1.1-2        tibble_3.2.1         tidyr_1.3.1         
  tidyselect_1.2.1     tidyverse_2.0.0      timechange_0.3.0    
  tinytex_0.54         tools_4.4.2          tzdb_0.4.0          
  ucminf_1.2.2         UpSetR_1.4.0         utf8_1.2.4          
  utils_4.4.2          uuid_1.2.1           vctrs_0.6.5         
  viridis_0.6.5        viridisLite_0.4.2    visdat_0.6.0        
  vroom_1.6.5          withr_3.0.2          xfun_0.49           
  xml2_1.3.6           xtable_1.8-4         yaml_2.3.10         
  zoo_1.8-12          </code></pre>
</div>
</div>


<!-- -->

</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Admittedly, that’s not much better.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>As we’ll see in that setting, none of the generalized variance inflation factors will approach the 5 or so that would cause us to be seriously concerned about collinearity.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
          // default icon
          link.classList.add("external");
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb88" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "431 Project B Sample Study 2 Report"</span></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Thomas E. Love"</span></span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> last-modified</span></span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a><span class="co">    theme: simplex</span></span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a><span class="co">    date-format: iso</span></span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a><span class="co">    number-sections: true</span></span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb88-12"><a href="#cb88-12" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb88-13"><a href="#cb88-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-14"><a href="#cb88-14" aria-hidden="true" tabindex="-1"></a>:::{.callout-important}</span>
<span id="cb88-15"><a href="#cb88-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-16"><a href="#cb88-16" aria-hidden="true" tabindex="-1"></a><span class="fu">## Reminders from Dr. Love </span></span>
<span id="cb88-17"><a href="#cb88-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-18"><a href="#cb88-18" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Remember that each subsection should include at least one complete sentence explaining what you are doing, specifying the variables you are using and how you are using them, and then conclude with at least one complete sentence of discussion of the key conclusions you draw from the current step, and a discussion of any limitations you can describe that apply to the results.</span>
<span id="cb88-19"><a href="#cb88-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-20"><a href="#cb88-20" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>If you want to download the Quarto code I used to create this document **to use as a template for your own work**, click on the Code button near the title of this Sample Study.</span>
<span id="cb88-21"><a href="#cb88-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-22"><a href="#cb88-22" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>In general, DO NOT use my exact words (other than the section and subsection headings) included in this sample report in your project. Rewrite everything to make it relevant to your situation. Do not repeat my instructions back to me. </span>
<span id="cb88-23"><a href="#cb88-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-24"><a href="#cb88-24" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>One partial exception is that I have demonstrated the interpretation of at least one point estimate and at least one confidence interval in this Sample Report, using language that I would be happy to see you use.</span>
<span id="cb88-25"><a href="#cb88-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-26"><a href="#cb88-26" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb88-27"><a href="#cb88-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-28"><a href="#cb88-28" aria-hidden="true" tabindex="-1"></a><span class="fu"># Setup and Data Ingest </span></span>
<span id="cb88-29"><a href="#cb88-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-30"><a href="#cb88-30" aria-hidden="true" tabindex="-1"></a>This document demonstrates analyses we are asking you to complete in Study 2 for Project B. The simulated data used in this example report are found in the <span class="in">`hbp_study.csv`</span> data file available in the projectB section of <span class="co">[</span><span class="ot">our 431-data website</span><span class="co">](https://github.com/THOMASELOVE/431-data)</span>.</span>
<span id="cb88-31"><a href="#cb88-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-32"><a href="#cb88-32" aria-hidden="true" tabindex="-1"></a>These are simulated data from a study of high blood pressure in 999 African-American adult subjects who are not of Hispanic or Latino ethnicity. To be included, the subject had to be between 33 and 83 years of age at baseline, have a series of items available in their health record at baseline, including a baseline systolic blood pressure, and then return for a blood pressure check 18 months later. Our goal will be to build a prediction model for the subject's systolic blood pressure at the end of the 18-month period, with the key predictor being that same subject's systolic blood pressure at the start of the period, and adjusting (in our larger model) for several other characteristics of the subjects at baseline.</span>
<span id="cb88-33"><a href="#cb88-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-34"><a href="#cb88-34" aria-hidden="true" tabindex="-1"></a><span class="fu">## Initial Setup and Package Loads in R </span></span>
<span id="cb88-35"><a href="#cb88-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-38"><a href="#cb88-38" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb88-39"><a href="#cb88-39" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb88-40"><a href="#cb88-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-41"><a href="#cb88-41" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb88-42"><a href="#cb88-42" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb88-43"><a href="#cb88-43" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(GGally)</span>
<span id="cb88-44"><a href="#cb88-44" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor)</span>
<span id="cb88-45"><a href="#cb88-45" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb88-46"><a href="#cb88-46" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mosaic)  </span>
<span id="cb88-47"><a href="#cb88-47" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mice)    </span>
<span id="cb88-48"><a href="#cb88-48" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(naniar)</span>
<span id="cb88-49"><a href="#cb88-49" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb88-50"><a href="#cb88-50" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(xfun)</span>
<span id="cb88-51"><a href="#cb88-51" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(easystats)</span>
<span id="cb88-52"><a href="#cb88-52" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse) </span>
<span id="cb88-53"><a href="#cb88-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-54"><a href="#cb88-54" aria-hidden="true" tabindex="-1"></a><span class="do">## Global options</span></span>
<span id="cb88-55"><a href="#cb88-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-56"><a href="#cb88-56" aria-hidden="true" tabindex="-1"></a>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">comment=</span><span class="cn">NA</span>)</span>
<span id="cb88-57"><a href="#cb88-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-58"><a href="#cb88-58" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_lucid</span>())</span>
<span id="cb88-59"><a href="#cb88-59" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">dplyr.summarise.inform =</span> <span class="cn">FALSE</span>)</span>
<span id="cb88-60"><a href="#cb88-60" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb88-61"><a href="#cb88-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-62"><a href="#cb88-62" aria-hidden="true" tabindex="-1"></a><span class="fu">## Loading the Raw Data into R </span></span>
<span id="cb88-63"><a href="#cb88-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-64"><a href="#cb88-64" aria-hidden="true" tabindex="-1"></a>Here, we load the data using <span class="in">`read_csv`</span> and then convert all <span class="in">`character`</span> variables to <span class="in">`factors`</span> in R, and then change our identifying code: <span class="in">`subj_id`</span> back to a character variable.</span>
<span id="cb88-65"><a href="#cb88-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-66"><a href="#cb88-66" aria-hidden="true" tabindex="-1"></a><span class="in">```{r data_load}</span></span>
<span id="cb88-67"><a href="#cb88-67" aria-hidden="true" tabindex="-1"></a><span class="in">hbp_study &lt;- read_csv("data/hbp_study.csv", show_col_types = FALSE) |&gt;</span></span>
<span id="cb88-68"><a href="#cb88-68" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(across(where(is.character), as.factor)) |&gt;</span></span>
<span id="cb88-69"><a href="#cb88-69" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(subj_id = as.character(subj_id))</span></span>
<span id="cb88-70"><a href="#cb88-70" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb88-71"><a href="#cb88-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-72"><a href="#cb88-72" aria-hidden="true" tabindex="-1"></a><span class="fu"># Cleaning the Data</span></span>
<span id="cb88-73"><a href="#cb88-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-74"><a href="#cb88-74" aria-hidden="true" tabindex="-1"></a><span class="fu">## Merging the Data</span></span>
<span id="cb88-75"><a href="#cb88-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-76"><a href="#cb88-76" aria-hidden="true" tabindex="-1"></a>In my little demonstration here, I don't have to do any merging. See the Study 1 Example, or (for example) the Class 23 Slides for examples of merging data.</span>
<span id="cb88-77"><a href="#cb88-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-78"><a href="#cb88-78" aria-hidden="true" tabindex="-1"></a><span class="fu">## The Raw Data</span></span>
<span id="cb88-79"><a href="#cb88-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-80"><a href="#cb88-80" aria-hidden="true" tabindex="-1"></a>The <span class="in">`hbp_study`</span> data set includes 12 variables and 999 adult subjects. For each subject, we have gathered</span>
<span id="cb88-81"><a href="#cb88-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-82"><a href="#cb88-82" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>baseline information on their <span class="in">`age`</span>, and their <span class="in">`sex`</span>, </span>
<span id="cb88-83"><a href="#cb88-83" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>whether or not they have a <span class="in">`diabetes`</span> diagnosis, </span>
<span id="cb88-84"><a href="#cb88-84" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>the socio-economic status of their neighborhood of residence (<span class="in">`nses`</span>), </span>
<span id="cb88-85"><a href="#cb88-85" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>their body-mass index (<span class="in">`bmi1`</span>) and systolic blood pressure (<span class="in">`sbp1`</span>), </span>
<span id="cb88-86"><a href="#cb88-86" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>their <span class="in">`insurance`</span> type, <span class="in">`tobacco`</span> use history, and </span>
<span id="cb88-87"><a href="#cb88-87" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>whether or not they have a prescription for a <span class="in">`statin`</span>, or for a <span class="in">`diuretic`</span>. </span>
<span id="cb88-88"><a href="#cb88-88" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Eighteen months later, we gathered a new systolic blood pressure (<span class="in">`sbp2`</span>) for each subject.</span>
<span id="cb88-89"><a href="#cb88-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-90"><a href="#cb88-90" aria-hidden="true" tabindex="-1"></a><span class="in">```{r hbp_study_data_in_the_raw}</span></span>
<span id="cb88-91"><a href="#cb88-91" aria-hidden="true" tabindex="-1"></a><span class="in">glimpse(hbp_study)</span></span>
<span id="cb88-92"><a href="#cb88-92" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb88-93"><a href="#cb88-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-94"><a href="#cb88-94" aria-hidden="true" tabindex="-1"></a>**Note**: If you have more than 20 variables in your initial (raw) data set, prune it down to 20 as the first step before showing us the results of <span class="in">`glimpse`</span> for your data.</span>
<span id="cb88-95"><a href="#cb88-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-96"><a href="#cb88-96" aria-hidden="true" tabindex="-1"></a>This tibble describes twelve variables, including:</span>
<span id="cb88-97"><a href="#cb88-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-98"><a href="#cb88-98" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>a character variable called <span class="in">`subj_id`</span> not to be used in our model except for identification of subjects,</span>
<span id="cb88-99"><a href="#cb88-99" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>our outcome (<span class="in">`sbp2`</span>) and our key predictor (<span class="in">`sbp1`</span>) that describe systolic blood pressure at two different times.</span>
<span id="cb88-100"><a href="#cb88-100" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>seven categorical candidate predictors, specifically <span class="in">`sex`</span>, <span class="in">`diabetes`</span>, <span class="in">`nses`</span>, <span class="in">`insurance`</span>, <span class="in">`tobacco`</span>, <span class="in">`statin`</span>, and <span class="in">`diuretic`</span>, each specified here in R as either a factor or a 1/0 numeric variable (<span class="in">`statin`</span> and <span class="in">`diuretic`</span>),</span>
<span id="cb88-101"><a href="#cb88-101" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>three quantitative candidate predictors, specifically <span class="in">`age`</span>, <span class="in">`bmi1`</span> and <span class="in">`sbp1`</span>. </span>
<span id="cb88-102"><a href="#cb88-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-103"><a href="#cb88-103" aria-hidden="true" tabindex="-1"></a><span class="fu">## Which variables should be included in the tidy data set?</span></span>
<span id="cb88-104"><a href="#cb88-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-105"><a href="#cb88-105" aria-hidden="true" tabindex="-1"></a>In fitting my models, I actually plan only to use five predictors: <span class="in">`sbp1`</span>, <span class="in">`age`</span>, <span class="in">`bmi1`</span>, <span class="in">`diabetes`</span> and <span class="in">`tobacco`</span> to model my outcome: <span class="in">`sbp2`</span>. Even though I'm not planning to use all of these predictors in my models, I'm going to build a tidy data set including all of them anyway, so I can demonstrate solutions to some problems you might have. </span>
<span id="cb88-106"><a href="#cb88-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-107"><a href="#cb88-107" aria-hidden="true" tabindex="-1"></a>When you build your tidy data set in the next section, restrict it to the variables (outcomes, predictors and <span class="in">`subj_id`</span>) that you will actually use in your modeling. </span>
<span id="cb88-108"><a href="#cb88-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-109"><a href="#cb88-109" aria-hidden="true" tabindex="-1"></a>In building our tidy version of these data, we must:</span>
<span id="cb88-110"><a href="#cb88-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-111"><a href="#cb88-111" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>deal with the ordering of levels in the multi-categorical variables <span class="in">`nses`</span>, <span class="in">`insurance`</span> and <span class="in">`tobacco`</span>,</span>
<span id="cb88-112"><a href="#cb88-112" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>change the name of <span class="in">`nses`</span> to something more helpful - I'll use <span class="in">`nbhd_ses`</span> as the new name^<span class="co">[</span><span class="ot">Admittedly, that's not much better.</span><span class="co">]</span>.</span>
<span id="cb88-113"><a href="#cb88-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-114"><a href="#cb88-114" aria-hidden="true" tabindex="-1"></a><span class="fu">## Checking our Outcome and Key Predictor</span></span>
<span id="cb88-115"><a href="#cb88-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-118"><a href="#cb88-118" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb88-119"><a href="#cb88-119" aria-hidden="true" tabindex="-1"></a><span class="fu">df_stats</span>(<span class="sc">~</span> sbp2 <span class="sc">+</span> sbp1, <span class="at">data =</span> hbp_study)</span>
<span id="cb88-120"><a href="#cb88-120" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb88-121"><a href="#cb88-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-122"><a href="#cb88-122" aria-hidden="true" tabindex="-1"></a>We have no missing values in our outcome or our key predictor, and each of the values look plausible, so we'll move on.</span>
<span id="cb88-123"><a href="#cb88-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-124"><a href="#cb88-124" aria-hidden="true" tabindex="-1"></a><span class="fu">## Checking the Quantitative Predictors</span></span>
<span id="cb88-125"><a href="#cb88-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-126"><a href="#cb88-126" aria-hidden="true" tabindex="-1"></a>Besides <span class="in">`sbp1`</span> we have two other quantitative predictor candidates, <span class="in">`age`</span> and <span class="in">`bmi1`</span>.</span>
<span id="cb88-127"><a href="#cb88-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-130"><a href="#cb88-130" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb88-131"><a href="#cb88-131" aria-hidden="true" tabindex="-1"></a><span class="fu">df_stats</span>(<span class="sc">~</span> age <span class="sc">+</span> bmi1, <span class="at">data =</span> hbp_study)</span>
<span id="cb88-132"><a href="#cb88-132" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb88-133"><a href="#cb88-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-134"><a href="#cb88-134" aria-hidden="true" tabindex="-1"></a>We know that all subjects in these data had to be between 33 and 83 years of age in order to be included, so we're happy to see that they are. We have five missing values (appropriately specified with NA) and no implausible values in our BMI values (I would use 16-80 as a plausible range of BMI values for adults.) Things look OK for now, as we'll deal with the missing values last.</span>
<span id="cb88-135"><a href="#cb88-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-136"><a href="#cb88-136" aria-hidden="true" tabindex="-1"></a><span class="fu">## Checking the Categorical Variables</span></span>
<span id="cb88-137"><a href="#cb88-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-138"><a href="#cb88-138" aria-hidden="true" tabindex="-1"></a>For categorical variables, it's always worth it to check to see whether the existing orders of the factor levels match the inherent order of the information, as well as whether there are any levels which we might want to collapse due to insufficient data, and whether there are any missing values.</span>
<span id="cb88-139"><a href="#cb88-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-140"><a href="#cb88-140" aria-hidden="true" tabindex="-1"></a><span class="fu">### `nses`: home neighborhood's socio-economic status</span></span>
<span id="cb88-141"><a href="#cb88-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-142"><a href="#cb88-142" aria-hidden="true" tabindex="-1"></a><span class="in">```{r levels_of_nses}</span></span>
<span id="cb88-143"><a href="#cb88-143" aria-hidden="true" tabindex="-1"></a><span class="in">hbp_study |&gt; tabyl(nses)</span></span>
<span id="cb88-144"><a href="#cb88-144" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb88-145"><a href="#cb88-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-146"><a href="#cb88-146" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The order of <span class="in">`nses`</span>, instead of the alphabetical ("High", "Low", "Middle", "Very Low"), should go from "Very Low" to "Low" to "Middle" to "High", or perhaps its reverse.</span>
<span id="cb88-147"><a href="#cb88-147" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Let's fix that using the <span class="in">`fct_relevel`</span> function from the <span class="in">`forcats`</span> package, which is part of the <span class="in">`tidyverse`</span>. While we're at it, we'll rename the variable <span class="in">`nbhd_ses`</span> which is more helpful to me.</span>
<span id="cb88-148"><a href="#cb88-148" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Then we'll see how many subjects fall in each category.</span>
<span id="cb88-149"><a href="#cb88-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-150"><a href="#cb88-150" aria-hidden="true" tabindex="-1"></a><span class="in">```{r relevel_nses}</span></span>
<span id="cb88-151"><a href="#cb88-151" aria-hidden="true" tabindex="-1"></a><span class="in">hbp_study &lt;- hbp_study |&gt;</span></span>
<span id="cb88-152"><a href="#cb88-152" aria-hidden="true" tabindex="-1"></a><span class="in">  rename(nbhd_ses = nses) |&gt;</span></span>
<span id="cb88-153"><a href="#cb88-153" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(nbhd_ses = fct_relevel(nbhd_ses, "Very Low", "Low", </span></span>
<span id="cb88-154"><a href="#cb88-154" aria-hidden="true" tabindex="-1"></a><span class="in">                            "Middle", "High"))</span></span>
<span id="cb88-155"><a href="#cb88-155" aria-hidden="true" tabindex="-1"></a><span class="in">hbp_study |&gt; tabyl(nbhd_ses)</span></span>
<span id="cb88-156"><a href="#cb88-156" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb88-157"><a href="#cb88-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-158"><a href="#cb88-158" aria-hidden="true" tabindex="-1"></a>We have 8 missing values of <span class="in">`nbhd_ses`</span>. We'll deal with that later.</span>
<span id="cb88-159"><a href="#cb88-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-160"><a href="#cb88-160" aria-hidden="true" tabindex="-1"></a><span class="fu">### `tobacco`: tobacco use history</span></span>
<span id="cb88-161"><a href="#cb88-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-162"><a href="#cb88-162" aria-hidden="true" tabindex="-1"></a><span class="in">```{r levels_of_tobacco}</span></span>
<span id="cb88-163"><a href="#cb88-163" aria-hidden="true" tabindex="-1"></a><span class="in">hbp_study |&gt; tabyl(tobacco)</span></span>
<span id="cb88-164"><a href="#cb88-164" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb88-165"><a href="#cb88-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-166"><a href="#cb88-166" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>For <span class="in">`tobacco`</span>, instead of ("current", "never", "quit"), we want a new order: ("never", "quit", "current").</span>
<span id="cb88-167"><a href="#cb88-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-168"><a href="#cb88-168" aria-hidden="true" tabindex="-1"></a><span class="in">```{r relevel_tobacco}</span></span>
<span id="cb88-169"><a href="#cb88-169" aria-hidden="true" tabindex="-1"></a><span class="in">hbp_study &lt;- hbp_study |&gt;</span></span>
<span id="cb88-170"><a href="#cb88-170" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(tobacco = fct_relevel(tobacco, "never", "quit", </span></span>
<span id="cb88-171"><a href="#cb88-171" aria-hidden="true" tabindex="-1"></a><span class="in">                            "current"))</span></span>
<span id="cb88-172"><a href="#cb88-172" aria-hidden="true" tabindex="-1"></a><span class="in">hbp_study |&gt; count(tobacco)</span></span>
<span id="cb88-173"><a href="#cb88-173" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb88-174"><a href="#cb88-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-175"><a href="#cb88-175" aria-hidden="true" tabindex="-1"></a>We have 23 missing values of <span class="in">`tobacco`</span>. Again, we'll deal with that later.</span>
<span id="cb88-176"><a href="#cb88-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-177"><a href="#cb88-177" aria-hidden="true" tabindex="-1"></a><span class="fu">### `insurance`: primary insurance type</span></span>
<span id="cb88-178"><a href="#cb88-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-179"><a href="#cb88-179" aria-hidden="true" tabindex="-1"></a><span class="in">```{r levels_insurance}</span></span>
<span id="cb88-180"><a href="#cb88-180" aria-hidden="true" tabindex="-1"></a><span class="in">hbp_study |&gt; tabyl(insurance)</span></span>
<span id="cb88-181"><a href="#cb88-181" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb88-182"><a href="#cb88-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-183"><a href="#cb88-183" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>For <span class="in">`insurance`</span>, we'll change the order to ("Medicare", "Private", "Medicaid", "Uninsured")</span>
<span id="cb88-184"><a href="#cb88-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-185"><a href="#cb88-185" aria-hidden="true" tabindex="-1"></a><span class="in">```{r relevel_insurance}</span></span>
<span id="cb88-186"><a href="#cb88-186" aria-hidden="true" tabindex="-1"></a><span class="in">hbp_study &lt;- hbp_study |&gt;</span></span>
<span id="cb88-187"><a href="#cb88-187" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(insurance = fct_relevel(insurance, "Medicare", </span></span>
<span id="cb88-188"><a href="#cb88-188" aria-hidden="true" tabindex="-1"></a><span class="in">                                 "Private", "Medicaid", </span></span>
<span id="cb88-189"><a href="#cb88-189" aria-hidden="true" tabindex="-1"></a><span class="in">                                 "Uninsured"))</span></span>
<span id="cb88-190"><a href="#cb88-190" aria-hidden="true" tabindex="-1"></a><span class="in">hbp_study |&gt; tabyl(insurance)</span></span>
<span id="cb88-191"><a href="#cb88-191" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb88-192"><a href="#cb88-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-193"><a href="#cb88-193" aria-hidden="true" tabindex="-1"></a>Note that any levels left out of a <span class="in">`fct_relevel`</span> statement get included in their current order, after whatever levels have been specified.</span>
<span id="cb88-194"><a href="#cb88-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-195"><a href="#cb88-195" aria-hidden="true" tabindex="-1"></a><span class="fu">### What about the subjects?</span></span>
<span id="cb88-196"><a href="#cb88-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-197"><a href="#cb88-197" aria-hidden="true" tabindex="-1"></a>It is important to make sure that we have a unique (distinct) code (here, <span class="in">`subj_id`</span>) for each row in the raw data set.</span>
<span id="cb88-198"><a href="#cb88-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-201"><a href="#cb88-201" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb88-202"><a href="#cb88-202" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(hbp_study)</span>
<span id="cb88-203"><a href="#cb88-203" aria-hidden="true" tabindex="-1"></a><span class="fu">n_distinct</span>(hbp_study <span class="sc">|&gt;</span> <span class="fu">select</span>(subj_id))</span>
<span id="cb88-204"><a href="#cb88-204" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb88-205"><a href="#cb88-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-206"><a href="#cb88-206" aria-hidden="true" tabindex="-1"></a>OK, that's fine.</span>
<span id="cb88-207"><a href="#cb88-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-208"><a href="#cb88-208" aria-hidden="true" tabindex="-1"></a><span class="fu">## Dealing with Missingness</span></span>
<span id="cb88-209"><a href="#cb88-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-210"><a href="#cb88-210" aria-hidden="true" tabindex="-1"></a>In Study 2, we will take the following steps once we have ensured that any *missing* values are appropriately specified using <span class="in">`NA`</span>.</span>
<span id="cb88-211"><a href="#cb88-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-212"><a href="#cb88-212" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>If there are any missing values in your outcome, drop those subjects.</span>
<span id="cb88-213"><a href="#cb88-213" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>If there are any missing values in your key predictor, drop those subjects.</span>
<span id="cb88-214"><a href="#cb88-214" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Build your codebook using the original data you have (including missing values.)</span>
<span id="cb88-215"><a href="#cb88-215" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>Once you have built the codebook, perform single imputation with the **mice** package to obtain your analytic sample, which you will then partition into a training and testing sample, and then use for the remainder of the work (everything after the codebook.)</span>
<span id="cb88-216"><a href="#cb88-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-217"><a href="#cb88-217" aria-hidden="true" tabindex="-1"></a><span class="fu">## Steps 1 and 2: Missing values in our outcome or key predictor?</span></span>
<span id="cb88-218"><a href="#cb88-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-221"><a href="#cb88-221" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb88-222"><a href="#cb88-222" aria-hidden="true" tabindex="-1"></a><span class="fu">miss_var_summary</span>(hbp_study)</span>
<span id="cb88-223"><a href="#cb88-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-224"><a href="#cb88-224" aria-hidden="true" tabindex="-1"></a><span class="fu">miss_case_table</span>(hbp_study)</span>
<span id="cb88-225"><a href="#cb88-225" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb88-226"><a href="#cb88-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-227"><a href="#cb88-227" aria-hidden="true" tabindex="-1"></a>We are missing data for 36 of our 999 subjects, but we don't have any missing values in either our outcome <span class="in">`sbp2`</span> or our key predictor <span class="in">`sbp1`</span>, so we'll move on to build our codebook.</span>
<span id="cb88-228"><a href="#cb88-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-229"><a href="#cb88-229" aria-hidden="true" tabindex="-1"></a><span class="fu"># Codebook and Data Description</span></span>
<span id="cb88-230"><a href="#cb88-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-231"><a href="#cb88-231" aria-hidden="true" tabindex="-1"></a><span class="fu">## The Codebook</span></span>
<span id="cb88-232"><a href="#cb88-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-233"><a href="#cb88-233" aria-hidden="true" tabindex="-1"></a>:::{.callout-note}</span>
<span id="cb88-234"><a href="#cb88-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-235"><a href="#cb88-235" aria-hidden="true" tabindex="-1"></a>Below, I've demonstrated the task of building a set of variable descriptions for a larger set of predictors than I actually intend to use, just to illustrate.</span>
<span id="cb88-236"><a href="#cb88-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-237"><a href="#cb88-237" aria-hidden="true" tabindex="-1"></a>The 12 variables in the <span class="in">`hbp_study`</span> tibble are as follows. </span>
<span id="cb88-238"><a href="#cb88-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-239"><a href="#cb88-239" aria-hidden="true" tabindex="-1"></a>Variable      | Type  | Description / Levels</span>
<span id="cb88-240"><a href="#cb88-240" aria-hidden="true" tabindex="-1"></a>---------: | :-------------: | --------------------------------------------</span>
<span id="cb88-241"><a href="#cb88-241" aria-hidden="true" tabindex="-1"></a><span class="in">`subj_id`</span>   | Character  | subject code (A001-A999)</span>
<span id="cb88-242"><a href="#cb88-242" aria-hidden="true" tabindex="-1"></a><span class="in">`sbp2`</span>      | Quantitative | **outcome** variable, SBP after 18 months, in mm Hg</span>
<span id="cb88-243"><a href="#cb88-243" aria-hidden="true" tabindex="-1"></a><span class="in">`sbp1`</span>      | Quantitative | **key predictor** baseline SBP (systolic blood pressure), in mm Hg</span>
<span id="cb88-244"><a href="#cb88-244" aria-hidden="true" tabindex="-1"></a><span class="in">`age`</span>       | Quantitative | age of subject at baseline, in years</span>
<span id="cb88-245"><a href="#cb88-245" aria-hidden="true" tabindex="-1"></a><span class="in">`sex`</span>       | Binary | Male or Female</span>
<span id="cb88-246"><a href="#cb88-246" aria-hidden="true" tabindex="-1"></a><span class="in">`diabetes`</span>  | Binary | Does subject have a diabetes diagnosis: No or Yes</span>
<span id="cb88-247"><a href="#cb88-247" aria-hidden="true" tabindex="-1"></a><span class="in">`nbhd_ses`</span>  | 4 level Cat. | Socio-economic status of subject's home neighborhood: Very Low, Low, Middle and High</span>
<span id="cb88-248"><a href="#cb88-248" aria-hidden="true" tabindex="-1"></a><span class="in">`bmi1`</span>      | Quantitative | subject's body-mass index at baseline</span>
<span id="cb88-249"><a href="#cb88-249" aria-hidden="true" tabindex="-1"></a><span class="in">`insurance`</span> | 4 level Cat. | subject's insurance status at baseline: Medicare, Private, Medicaid, Uninsured</span>
<span id="cb88-250"><a href="#cb88-250" aria-hidden="true" tabindex="-1"></a><span class="in">`tobacco`</span>   | 3 level Cat. | subject's tobacco use at baseline: never, quit (former), current</span>
<span id="cb88-251"><a href="#cb88-251" aria-hidden="true" tabindex="-1"></a><span class="in">`statin`</span>    | Binary | 1 = statin prescription at baseline, else 0</span>
<span id="cb88-252"><a href="#cb88-252" aria-hidden="true" tabindex="-1"></a><span class="in">`diuretic`</span>  | Binary | 1 = diuretic prescription at baseline, else 0</span>
<span id="cb88-253"><a href="#cb88-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-254"><a href="#cb88-254" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb88-255"><a href="#cb88-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-256"><a href="#cb88-256" aria-hidden="true" tabindex="-1"></a>In fitting my models, I actually plan only to use five predictors: <span class="in">`sbp1`</span>, <span class="in">`age`</span>, <span class="in">`bmi1`</span>, <span class="in">`diabetes`</span> and <span class="in">`tobacco`</span> to model my outcome: <span class="in">`sbp2`</span>. So let's create that data set as a tibble, and provide its set of variable descriptions.</span>
<span id="cb88-257"><a href="#cb88-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-260"><a href="#cb88-260" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb88-261"><a href="#cb88-261" aria-hidden="true" tabindex="-1"></a>hbp_a1 <span class="ot">&lt;-</span> hbp_study <span class="sc">|&gt;</span></span>
<span id="cb88-262"><a href="#cb88-262" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(subj_id, sbp2, sbp1, age, bmi1, diabetes, tobacco) </span>
<span id="cb88-263"><a href="#cb88-263" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb88-264"><a href="#cb88-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-265"><a href="#cb88-265" aria-hidden="true" tabindex="-1"></a>The 7 variables in the <span class="in">`hbp_a1`</span> tibble are as follows. </span>
<span id="cb88-266"><a href="#cb88-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-267"><a href="#cb88-267" aria-hidden="true" tabindex="-1"></a>Variable      | Type  | Description / Levels</span>
<span id="cb88-268"><a href="#cb88-268" aria-hidden="true" tabindex="-1"></a>---------: | :-------------: | --------------------------------------------</span>
<span id="cb88-269"><a href="#cb88-269" aria-hidden="true" tabindex="-1"></a><span class="in">`subj_id`</span>   | Character  | subject code (A001-A999)</span>
<span id="cb88-270"><a href="#cb88-270" aria-hidden="true" tabindex="-1"></a><span class="in">`sbp2`</span>      | Quantitative | **outcome** variable, SBP after 18 months, in mm Hg</span>
<span id="cb88-271"><a href="#cb88-271" aria-hidden="true" tabindex="-1"></a><span class="in">`sbp1`</span>      | Quantitative | **key predictor** baseline SBP (systolic blood pressure), in mm Hg</span>
<span id="cb88-272"><a href="#cb88-272" aria-hidden="true" tabindex="-1"></a><span class="in">`age`</span>       | Quantitative | age of subject at baseline, in years</span>
<span id="cb88-273"><a href="#cb88-273" aria-hidden="true" tabindex="-1"></a><span class="in">`bmi1`</span>      | Quantitative | subject's body-mass index at baseline</span>
<span id="cb88-274"><a href="#cb88-274" aria-hidden="true" tabindex="-1"></a><span class="in">`diabetes`</span>  | Binary | Does subject have a diabetes diagnosis: No or Yes</span>
<span id="cb88-275"><a href="#cb88-275" aria-hidden="true" tabindex="-1"></a><span class="in">`tobacco`</span>   | 3 level Cat. | subject's tobacco use at baseline: never, quit (former), current</span>
<span id="cb88-276"><a href="#cb88-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-277"><a href="#cb88-277" aria-hidden="true" tabindex="-1"></a><span class="fu">## Print the Tibble</span></span>
<span id="cb88-278"><a href="#cb88-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-279"><a href="#cb88-279" aria-hidden="true" tabindex="-1"></a>First, we'll provide a printout of the tibble, which confirms that we have one.</span>
<span id="cb88-280"><a href="#cb88-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-283"><a href="#cb88-283" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb88-284"><a href="#cb88-284" aria-hidden="true" tabindex="-1"></a>hbp_a1</span>
<span id="cb88-285"><a href="#cb88-285" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb88-286"><a href="#cb88-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-287"><a href="#cb88-287" aria-hidden="true" tabindex="-1"></a>OK. All set. Now we show the <span class="in">`data_codebook()`</span> results.</span>
<span id="cb88-288"><a href="#cb88-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-289"><a href="#cb88-289" aria-hidden="true" tabindex="-1"></a><span class="fu">## `data_codebook()` results</span></span>
<span id="cb88-290"><a href="#cb88-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-293"><a href="#cb88-293" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb88-294"><a href="#cb88-294" aria-hidden="true" tabindex="-1"></a><span class="fu">data_codebook</span>(hbp_a1 <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="sc">-</span>subj_id))</span>
<span id="cb88-295"><a href="#cb88-295" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb88-296"><a href="#cb88-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-297"><a href="#cb88-297" aria-hidden="true" tabindex="-1"></a>We should (and do) see no implausible values here, and our categorical variables are treated as factors with a rational ordering for the levels.</span>
<span id="cb88-298"><a href="#cb88-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-299"><a href="#cb88-299" aria-hidden="true" tabindex="-1"></a><span class="fu">## Our Single Imputation</span></span>
<span id="cb88-300"><a href="#cb88-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-301"><a href="#cb88-301" aria-hidden="true" tabindex="-1"></a>We will now assuming MISSING AT RANDOM and singly impute the missing values in <span class="in">`hbp_a1`</span>, creating a new analytic tibble called <span class="in">`hbp_a2`</span>, which we will use for the rest of our work.</span>
<span id="cb88-302"><a href="#cb88-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-305"><a href="#cb88-305" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb88-306"><a href="#cb88-306" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">4311</span>)</span>
<span id="cb88-307"><a href="#cb88-307" aria-hidden="true" tabindex="-1"></a>hbp_imp <span class="ot">&lt;-</span> <span class="fu">mice</span>(hbp_a1, <span class="at">m =</span> <span class="dv">1</span>, <span class="at">printFlag =</span> <span class="cn">FALSE</span>)</span>
<span id="cb88-308"><a href="#cb88-308" aria-hidden="true" tabindex="-1"></a>hbp_a2 <span class="ot">&lt;-</span> <span class="fu">complete</span>(hbp_imp)</span>
<span id="cb88-309"><a href="#cb88-309" aria-hidden="true" tabindex="-1"></a><span class="fu">n_miss</span>(hbp_a2)</span>
<span id="cb88-310"><a href="#cb88-310" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb88-311"><a href="#cb88-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-312"><a href="#cb88-312" aria-hidden="true" tabindex="-1"></a><span class="fu">## Partition the Data</span></span>
<span id="cb88-313"><a href="#cb88-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-314"><a href="#cb88-314" aria-hidden="true" tabindex="-1"></a>First, we should check that our subject identifying codes are unique to each row of our analytic data.</span>
<span id="cb88-315"><a href="#cb88-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-318"><a href="#cb88-318" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb88-319"><a href="#cb88-319" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="fu">nrow</span>(hbp_a2), <span class="fu">n_distinct</span>(hbp_a2<span class="sc">$</span>subj_id))</span>
<span id="cb88-320"><a href="#cb88-320" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb88-321"><a href="#cb88-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-322"><a href="#cb88-322" aria-hidden="true" tabindex="-1"></a>OK. Since those two values match, we should be ready to partition. We'll put 70% of the data in the training sample (<span class="in">`hbp_train`</span>) leaving the other 30% for the test sample (<span class="in">`hbp_test`</span>).</span>
<span id="cb88-323"><a href="#cb88-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-326"><a href="#cb88-326" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb88-327"><a href="#cb88-327" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">4312</span>)</span>
<span id="cb88-328"><a href="#cb88-328" aria-hidden="true" tabindex="-1"></a>hbp_train <span class="ot">&lt;-</span> hbp_a2 <span class="sc">|&gt;</span> <span class="fu">slice_sample</span>(<span class="at">prop =</span> <span class="fl">0.7</span>, <span class="at">replace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb88-329"><a href="#cb88-329" aria-hidden="true" tabindex="-1"></a>hbp_test <span class="ot">&lt;-</span> <span class="fu">anti_join</span>(hbp_a2, hbp_train, <span class="at">by =</span> <span class="st">"subj_id"</span>)</span>
<span id="cb88-330"><a href="#cb88-330" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb88-331"><a href="#cb88-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-332"><a href="#cb88-332" aria-hidden="true" tabindex="-1"></a><span class="fu"># My Research Question</span></span>
<span id="cb88-333"><a href="#cb88-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-334"><a href="#cb88-334" aria-hidden="true" tabindex="-1"></a>Here you should provide background information on the study, and the subjects, so that we understand what you're talking about in your research question. I'll skip that in the demo, because I've done it already in introducing the data set, but you'll need that here.</span>
<span id="cb88-335"><a href="#cb88-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-336"><a href="#cb88-336" aria-hidden="true" tabindex="-1"></a>A natural research question here would be something like:</span>
<span id="cb88-337"><a href="#cb88-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-338"><a href="#cb88-338" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; How effectively can we predict systolic BP 18 months after baseline using baseline systolic BP, and is the quality of prediction meaningfully improved when I adjust for four other predictors (baseline age, body-mass index, diabetes diagnosis and tobacco use) in the </span><span class="in">`hbp_study`</span><span class="at"> data? </span></span>
<span id="cb88-339"><a href="#cb88-339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-340"><a href="#cb88-340" aria-hidden="true" tabindex="-1"></a>Please don't feel obliged to follow this format precisely in stating your question, and note that your "smaller" model needs to include your key predictor **and** at least one other predictor, something I didn't require of myself in posing this question.</span>
<span id="cb88-341"><a href="#cb88-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-342"><a href="#cb88-342" aria-hidden="true" tabindex="-1"></a><span class="fu"># Transforming the Outcome</span></span>
<span id="cb88-343"><a href="#cb88-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-344"><a href="#cb88-344" aria-hidden="true" tabindex="-1"></a><span class="fu">## Visualizing the Outcome Distribution</span></span>
<span id="cb88-345"><a href="#cb88-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-346"><a href="#cb88-346" aria-hidden="true" tabindex="-1"></a>I see at least three potential graphs to use to describe the distribution of our outcome variable, <span class="in">`sbp2`</span>. Again, remember we're using only the **training** sample here.</span>
<span id="cb88-347"><a href="#cb88-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-348"><a href="#cb88-348" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>A boxplot, probably accompanied by a violin plot to show the shape of the distribution more honestly.</span>
<span id="cb88-349"><a href="#cb88-349" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>A histogram, which could perhaps be presented as a density plot with a Normal distribution superimposed.</span>
<span id="cb88-350"><a href="#cb88-350" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>A Normal Q-Q plot to directly assess Normality.</span>
<span id="cb88-351"><a href="#cb88-351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-352"><a href="#cb88-352" aria-hidden="true" tabindex="-1"></a>I expect you to show at least two of these three, but I will display all three here. Should we see substantial skew in the outcome data, we will want to consider an appropriate transformation, and then display the results of that transformation, as well.</span>
<span id="cb88-353"><a href="#cb88-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-354"><a href="#cb88-354" aria-hidden="true" tabindex="-1"></a>**WARNING**: Please note that I am deliberately showing you plots that are less finished than I hope you will provide. </span>
<span id="cb88-355"><a href="#cb88-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-356"><a href="#cb88-356" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>The coloring is dull or non-existent.</span>
<span id="cb88-357"><a href="#cb88-357" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>The theme is the default gray and white grid that lots of people dislike.</span>
<span id="cb88-358"><a href="#cb88-358" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>There are no meaningful titles or subtitles.</span>
<span id="cb88-359"><a href="#cb88-359" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>The axis labels select the default settings, and use incomprehensible variable names.</span>
<span id="cb88-360"><a href="#cb88-360" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>The coordinates aren't flipped when that might be appropriate.</span>
<span id="cb88-361"><a href="#cb88-361" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>I expect a much nicer presentation in your final work. Use the class slides and course text for good ideas.</span>
<span id="cb88-362"><a href="#cb88-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-365"><a href="#cb88-365" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb88-366"><a href="#cb88-366" aria-hidden="true" tabindex="-1"></a>viz1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(hbp_train, <span class="fu">aes</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> sbp2)) <span class="sc">+</span></span>
<span id="cb88-367"><a href="#cb88-367" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_violin</span>() <span class="sc">+</span></span>
<span id="cb88-368"><a href="#cb88-368" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">width =</span> <span class="fl">0.25</span>)</span>
<span id="cb88-369"><a href="#cb88-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-370"><a href="#cb88-370" aria-hidden="true" tabindex="-1"></a>viz2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(hbp_train, <span class="fu">aes</span>(<span class="at">x =</span> sbp2)) <span class="sc">+</span></span>
<span id="cb88-371"><a href="#cb88-371" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">30</span>, <span class="at">col =</span> <span class="st">"white"</span>)</span>
<span id="cb88-372"><a href="#cb88-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-373"><a href="#cb88-373" aria-hidden="true" tabindex="-1"></a>viz3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(hbp_train, <span class="fu">aes</span>(<span class="at">sample =</span> sbp2)) <span class="sc">+</span></span>
<span id="cb88-374"><a href="#cb88-374" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_qq</span>() <span class="sc">+</span> <span class="fu">geom_qq_line</span>()</span>
<span id="cb88-375"><a href="#cb88-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-376"><a href="#cb88-376" aria-hidden="true" tabindex="-1"></a>viz1 <span class="sc">+</span> viz2 <span class="sc">+</span> viz3 <span class="sc">+</span></span>
<span id="cb88-377"><a href="#cb88-377" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(<span class="at">title =</span> <span class="st">"Less-Than-Great Plots of My Outcome's Distribution"</span>,</span>
<span id="cb88-378"><a href="#cb88-378" aria-hidden="true" tabindex="-1"></a>                  <span class="at">subtitle =</span> <span class="st">"complete with a rotten title, default axis labels and bad captions"</span>)</span>
<span id="cb88-379"><a href="#cb88-379" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb88-380"><a href="#cb88-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-381"><a href="#cb88-381" aria-hidden="true" tabindex="-1"></a>Later, we'll augment this initial look at the outcome data with a Box-Cox plot to suggest a potential transformation. Should you decide to make such a transformation, remember to return here to plot the results for your new and transformed outcome.</span>
<span id="cb88-382"><a href="#cb88-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-383"><a href="#cb88-383" aria-hidden="true" tabindex="-1"></a><span class="fu">## Numerical Summary of the Outcome</span></span>
<span id="cb88-384"><a href="#cb88-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-385"><a href="#cb88-385" aria-hidden="true" tabindex="-1"></a>Assuming you plan no transformation of the outcome (and in our case, I am happy that the outcome data appear reasonably well-modeled by the Normal distribution) then you should just summarize the training data, with your favorite tool for that task. That might be:</span>
<span id="cb88-386"><a href="#cb88-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-387"><a href="#cb88-387" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`lovedist()`</span> from our <span class="in">`431-Love.R`</span> script, or</span>
<span id="cb88-388"><a href="#cb88-388" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`favstats`</span> from the <span class="in">`mosaic`</span> package, as shown below, or</span>
<span id="cb88-389"><a href="#cb88-389" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>something else, I guess. </span>
<span id="cb88-390"><a href="#cb88-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-391"><a href="#cb88-391" aria-hidden="true" tabindex="-1"></a>But show **ONE** of these choices, and not all of them. Make a decision and go with it!</span>
<span id="cb88-392"><a href="#cb88-392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-395"><a href="#cb88-395" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb88-396"><a href="#cb88-396" aria-hidden="true" tabindex="-1"></a><span class="fu">favstats</span>(<span class="sc">~</span> sbp2, <span class="at">data =</span> hbp_train)</span>
<span id="cb88-397"><a href="#cb88-397" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb88-398"><a href="#cb88-398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-399"><a href="#cb88-399" aria-hidden="true" tabindex="-1"></a><span class="fu">## Numerical Summaries of the Predictors</span></span>
<span id="cb88-400"><a href="#cb88-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-401"><a href="#cb88-401" aria-hidden="true" tabindex="-1"></a>We also need an appropriate set of numerical summaries of each predictor variable, in the training data. The <span class="in">`inspect`</span> function provides a way to get results like <span class="in">`favstats`</span>, but for an entire data frame.</span>
<span id="cb88-402"><a href="#cb88-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-405"><a href="#cb88-405" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb88-406"><a href="#cb88-406" aria-hidden="true" tabindex="-1"></a>hbp_train <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="sc">-</span>subj_id, <span class="sc">-</span>sbp2) <span class="sc">|&gt;</span> </span>
<span id="cb88-407"><a href="#cb88-407" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inspect</span>()</span>
<span id="cb88-408"><a href="#cb88-408" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb88-409"><a href="#cb88-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-410"><a href="#cb88-410" aria-hidden="true" tabindex="-1"></a>Next, we will build and interpret a scatterplot matrix to describe the associations (both numerically and graphically) between the outcome and all predictors. </span>
<span id="cb88-411"><a href="#cb88-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-412"><a href="#cb88-412" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We'll also use a Box-Cox plot to investigate whether a transformation of our outcome is suggested, and</span>
<span id="cb88-413"><a href="#cb88-413" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>describe what a correlation matrix suggests about collinearity between candidate predictors.</span>
<span id="cb88-414"><a href="#cb88-414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-415"><a href="#cb88-415" aria-hidden="true" tabindex="-1"></a><span class="fu">## Scatterplot Matrix</span></span>
<span id="cb88-416"><a href="#cb88-416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-417"><a href="#cb88-417" aria-hidden="true" tabindex="-1"></a>Here, we will build a scatterplot matrix (or two) to show the relationship between our outcome and the predictors. I'll demonstrate the use of <span class="in">`ggpairs`</span> from the <span class="in">`GGally`</span> package.</span>
<span id="cb88-418"><a href="#cb88-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-419"><a href="#cb88-419" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>If you have more than five predictors (as we do in our case) you should build two scatterplot matrices, each ending with the outcome. Anything more than one outcome and five predictors becomes unreadable in Professor Love's view.</span>
<span id="cb88-420"><a href="#cb88-420" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>If you have a multi-categorical predictor with more than four categories, that predictor will be very difficult to see and explore in the scatterplot matrix produced.</span>
<span id="cb88-421"><a href="#cb88-421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-424"><a href="#cb88-424" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb88-425"><a href="#cb88-425" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb88-426"><a href="#cb88-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-427"><a href="#cb88-427" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> hbp_train <span class="sc">|&gt;</span> </span>
<span id="cb88-428"><a href="#cb88-428" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(sbp1, age, bmi1, diabetes, tobacco, sbp2) </span>
<span id="cb88-429"><a href="#cb88-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-430"><a href="#cb88-430" aria-hidden="true" tabindex="-1"></a><span class="fu">ggpairs</span>(temp, <span class="at">title =</span> <span class="st">"Scatterplot Matrix"</span>,</span>
<span id="cb88-431"><a href="#cb88-431" aria-hidden="true" tabindex="-1"></a>        <span class="at">lower =</span> <span class="fu">list</span>(<span class="at">combo =</span> <span class="fu">wrap</span>(<span class="st">"facethist"</span>, <span class="at">bins =</span> <span class="dv">20</span>)))</span>
<span id="cb88-432"><a href="#cb88-432" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb88-433"><a href="#cb88-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-434"><a href="#cb88-434" aria-hidden="true" tabindex="-1"></a>At the end of this section, you should provide some discussion of the distribution of any key predictors, and their relationship to the outcome (all of that is provided in the bottom row if you place the outcome last, as you should, in selecting variables for the plot.)</span>
<span id="cb88-435"><a href="#cb88-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-436"><a href="#cb88-436" aria-hidden="true" tabindex="-1"></a>**HINT**: For categorical variables, your efforts in this regard to summarize the relationships you see may be challenging. Your comments would be aided by the judicious use of numerical summaries. For example, suppose you want to study the relationship between tobacco use and <span class="in">`sbp2`</span>, then you probably want to run and discuss the following results, in addition to the scatterplot matrix above.</span>
<span id="cb88-437"><a href="#cb88-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-440"><a href="#cb88-440" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb88-441"><a href="#cb88-441" aria-hidden="true" tabindex="-1"></a><span class="fu">favstats</span>(sbp2 <span class="sc">~</span> tobacco, <span class="at">data =</span> hbp_train)</span>
<span id="cb88-442"><a href="#cb88-442" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb88-443"><a href="#cb88-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-444"><a href="#cb88-444" aria-hidden="true" tabindex="-1"></a><span class="fu">## Collinearity Checking</span></span>
<span id="cb88-445"><a href="#cb88-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-446"><a href="#cb88-446" aria-hidden="true" tabindex="-1"></a>Next, we'll take a brief look at potential collinearity. Remember that we want to see strong correlations between our **outcome** and the predictors, but relatively modest correlations between the predictors.</span>
<span id="cb88-447"><a href="#cb88-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-448"><a href="#cb88-448" aria-hidden="true" tabindex="-1"></a>None of the numeric candidate predictors show any substantial correlation with each other. The largest Pearson correlation (in absolute value) between predictors is (-0.239) for <span class="in">`age`</span> and <span class="in">`bmi1`</span>, and that's not strong. If we did see signs of meaningful collinearity, we might rethink our selected set of predictors.</span>
<span id="cb88-449"><a href="#cb88-449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-450"><a href="#cb88-450" aria-hidden="true" tabindex="-1"></a>I'll recommend later that you run a generalized VIF (variance inflation factor) calculation^<span class="co">[</span><span class="ot">As we'll see in that setting, none of the generalized variance inflation factors will approach the 5 or so that would cause us to be seriously concerned about collinearity.</span><span class="co">]</span> after fitting your kitchen sink model just to see if anything pops up (in my case, it won't.) </span>
<span id="cb88-451"><a href="#cb88-451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-452"><a href="#cb88-452" aria-hidden="true" tabindex="-1"></a><span class="fu">## `boxCox` function to assess need for transformation of our outcome</span></span>
<span id="cb88-453"><a href="#cb88-453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-454"><a href="#cb88-454" aria-hidden="true" tabindex="-1"></a>To use the <span class="in">`boxCox`</span> approach here, we need to ensure that the distribution of our outcome, <span class="in">`sbp2`</span>, includes strictly positive values. We can see from our numerical summary earlier that the minimum <span class="in">`sbp2`</span> in our <span class="in">`hbp_train`</span> sample is 90, so we're OK.</span>
<span id="cb88-455"><a href="#cb88-455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-456"><a href="#cb88-456" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Note that I am restricting myself here to the five predictors I actually intend to use in building models.</span>
<span id="cb88-457"><a href="#cb88-457" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Although we're generally using a 90% confidence interval in this project, we won't worry about that issue in the <span class="in">`boxCox`</span> plot, and instead just look at the point estimate from <span class="in">`powerTransform`</span>. </span>
<span id="cb88-458"><a href="#cb88-458" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>These commands (<span class="in">`boxCox`</span> and <span class="in">`powerTransform`</span>) come from the <span class="in">`car`</span> package.</span>
<span id="cb88-459"><a href="#cb88-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-460"><a href="#cb88-460" aria-hidden="true" tabindex="-1"></a><span class="in">```{r boxCox_plot}</span></span>
<span id="cb88-461"><a href="#cb88-461" aria-hidden="true" tabindex="-1"></a><span class="in">model_temp &lt;- lm(sbp2 ~ sbp1 + age + bmi1 + diabetes + tobacco,</span></span>
<span id="cb88-462"><a href="#cb88-462" aria-hidden="true" tabindex="-1"></a><span class="in">                 data = hbp_train)</span></span>
<span id="cb88-463"><a href="#cb88-463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-464"><a href="#cb88-464" aria-hidden="true" tabindex="-1"></a><span class="in">boxCox(model_temp)</span></span>
<span id="cb88-465"><a href="#cb88-465" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb88-466"><a href="#cb88-466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-467"><a href="#cb88-467" aria-hidden="true" tabindex="-1"></a>The estimated power transformation is about 0.5, which looks like a square root transformation of <span class="in">`sbp2`</span> is useful. Given that I'm using another measure of <span class="in">`sbp`</span>, specifically, <span class="in">`sbp1`</span> to predict <span class="in">`sbp2`</span>, perhaps I want to transform that, too?</span>
<span id="cb88-468"><a href="#cb88-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-471"><a href="#cb88-471" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb88-472"><a href="#cb88-472" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(hbp_train, <span class="fu">aes</span>(<span class="at">x =</span> sbp1, <span class="at">y =</span> <span class="fu">sqrt</span>(sbp2))) <span class="sc">+</span></span>
<span id="cb88-473"><a href="#cb88-473" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb88-474"><a href="#cb88-474" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"loess"</span>, <span class="at">formula =</span> y <span class="sc">~</span> x, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> </span>
<span id="cb88-475"><a href="#cb88-475" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">formula =</span> y <span class="sc">~</span> x, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb88-476"><a href="#cb88-476" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"SQRT(sbp2) vs. SBP1"</span>)</span>
<span id="cb88-477"><a href="#cb88-477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-478"><a href="#cb88-478" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(hbp_train, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">sqrt</span>(sbp1), <span class="at">y =</span> <span class="fu">sqrt</span>(sbp2))) <span class="sc">+</span></span>
<span id="cb88-479"><a href="#cb88-479" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb88-480"><a href="#cb88-480" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"loess"</span>, <span class="at">formula =</span> y <span class="sc">~</span> x, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> </span>
<span id="cb88-481"><a href="#cb88-481" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">formula =</span> y <span class="sc">~</span> x, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> </span>
<span id="cb88-482"><a href="#cb88-482" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"SQRT(sbp2) vs. SQRT(sbp1)"</span>)</span>
<span id="cb88-483"><a href="#cb88-483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-484"><a href="#cb88-484" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2</span>
<span id="cb88-485"><a href="#cb88-485" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb88-486"><a href="#cb88-486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-487"><a href="#cb88-487" aria-hidden="true" tabindex="-1"></a>I don't see an especially large difference between these two plots. It is up to you to decide whether a transformation suggested by <span class="in">`boxCox`</span> should be applied to your data.</span>
<span id="cb88-488"><a href="#cb88-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-489"><a href="#cb88-489" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>For the purposes of this project, you should stick to transformations of strictly positive outcomes, and to the square root (power = 0.5), square (power = 2), logarithm (power = 0) and inverse (power = -1) transformations. Don't make the transformation without being able to interpret the result well.</span>
<span id="cb88-490"><a href="#cb88-490" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Feel encouraged to scale your transformations (by multiplying or dividing by a constant) so that most of the transformed values wind up between 0 and 100 or 0 and 1000, if you like.</span>
<span id="cb88-491"><a href="#cb88-491" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>If you do decide to include a transformation of your outcome in fitting models, be sure to back-transform any predictions you make at the end of the study so that we can understand the prediction error results.</span>
<span id="cb88-492"><a href="#cb88-492" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>If your outcome data are substantially multimodal, I wouldn't treat the <span class="in">`boxCox`</span> results as meaningful. </span>
<span id="cb88-493"><a href="#cb88-493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-494"><a href="#cb88-494" aria-hidden="true" tabindex="-1"></a>I'm going to use the square root transformation for both my outcome and for the key predictor, but I don't think it makes a big difference. I'm doing it mostly so that I can show you how to back-transform later.</span>
<span id="cb88-495"><a href="#cb88-495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-496"><a href="#cb88-496" aria-hidden="true" tabindex="-1"></a><span class="fu"># The Big Model</span></span>
<span id="cb88-497"><a href="#cb88-497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-498"><a href="#cb88-498" aria-hidden="true" tabindex="-1"></a>We will specify a "kitchen sink" linear regression model to describe the relationship between our outcome (potentially after transformation) and the main effects of each of our predictors. We'll need to:</span>
<span id="cb88-499"><a href="#cb88-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-500"><a href="#cb88-500" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We'll assess the overall effectiveness, within your training sample, of your model, by considering performance in the training sample using a wide range of summaries.  </span>
<span id="cb88-501"><a href="#cb88-501" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We'll need to specify the size, magnitude and meaning of all coefficients, and identify appropriate conclusions regarding effect sizes with 90% confidence intervals.</span>
<span id="cb88-502"><a href="#cb88-502" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Finally, we'll assess whether collinearity in the kitchen sink model has a meaningful impact, and describe how we know that.</span>
<span id="cb88-503"><a href="#cb88-503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-504"><a href="#cb88-504" aria-hidden="true" tabindex="-1"></a><span class="fu">## Fitting/Summarizing the Kitchen Sink model</span></span>
<span id="cb88-505"><a href="#cb88-505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-506"><a href="#cb88-506" aria-hidden="true" tabindex="-1"></a>Our "kitchen sink" or "big" model predicts the square root of <span class="in">`sbp2`</span> using the predictors (square root of <span class="in">`sbp1`</span>), <span class="in">`age`</span>, <span class="in">`bmi1`</span>, <span class="in">`diabetes`</span> and <span class="in">`tobacco`</span>.</span>
<span id="cb88-507"><a href="#cb88-507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-508"><a href="#cb88-508" aria-hidden="true" tabindex="-1"></a>First, we'll use <span class="in">`mutate`</span> to create our two new transformed variables.</span>
<span id="cb88-509"><a href="#cb88-509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-510"><a href="#cb88-510" aria-hidden="true" tabindex="-1"></a><span class="in">```{r kitchen_sink}</span></span>
<span id="cb88-511"><a href="#cb88-511" aria-hidden="true" tabindex="-1"></a><span class="in">hbp_train &lt;- hbp_train |&gt; </span></span>
<span id="cb88-512"><a href="#cb88-512" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(sbp2_tr = sqrt(sbp2), sbp1_tr = sqrt(sbp1))</span></span>
<span id="cb88-513"><a href="#cb88-513" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb88-514"><a href="#cb88-514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-515"><a href="#cb88-515" aria-hidden="true" tabindex="-1"></a>Next, we'll fit our "big" (kitchen sink) model.</span>
<span id="cb88-516"><a href="#cb88-516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-519"><a href="#cb88-519" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb88-520"><a href="#cb88-520" aria-hidden="true" tabindex="-1"></a>model_big <span class="ot">&lt;-</span> <span class="fu">lm</span>(sbp2_tr <span class="sc">~</span> sbp1_tr <span class="sc">+</span> age <span class="sc">+</span> bmi1 <span class="sc">+</span> diabetes <span class="sc">+</span> tobacco, </span>
<span id="cb88-521"><a href="#cb88-521" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> hbp_train)</span>
<span id="cb88-522"><a href="#cb88-522" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb88-523"><a href="#cb88-523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-526"><a href="#cb88-526" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb88-527"><a href="#cb88-527" aria-hidden="true" tabindex="-1"></a><span class="fu">model_performance</span>(model_big)</span>
<span id="cb88-528"><a href="#cb88-528" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb88-529"><a href="#cb88-529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-530"><a href="#cb88-530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-531"><a href="#cb88-531" aria-hidden="true" tabindex="-1"></a><span class="fu">## Effect Sizes: Coefficient Estimates</span></span>
<span id="cb88-532"><a href="#cb88-532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-533"><a href="#cb88-533" aria-hidden="true" tabindex="-1"></a>Specify the size and magnitude of all coefficients, providing estimated effect sizes with 90% confidence intervals.</span>
<span id="cb88-534"><a href="#cb88-534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-537"><a href="#cb88-537" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb88-538"><a href="#cb88-538" aria-hidden="true" tabindex="-1"></a><span class="fu">model_parameters</span>(model_big, <span class="at">ci =</span> <span class="fl">0.90</span>)</span>
<span id="cb88-539"><a href="#cb88-539" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb88-540"><a href="#cb88-540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-541"><a href="#cb88-541" aria-hidden="true" tabindex="-1"></a><span class="fu">## Describing the Equation</span></span>
<span id="cb88-542"><a href="#cb88-542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-543"><a href="#cb88-543" aria-hidden="true" tabindex="-1"></a>This model implies for the key predictor (<span class="in">`sbp_1`</span>) that:</span>
<span id="cb88-544"><a href="#cb88-544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-545"><a href="#cb88-545" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Point Estimate**: If we had two subjects with the same values of age, BMI, diabetes and tobacco status, but A had a baseline square root of SBP of, for example, 12 (so an SBP at baseline of 144) and B had a baseline square root of SBP one unit lower, so for example, 11 (so an SBP at baseline of 121) our <span class="in">`model_big`</span> predicts that the square root of subject A's SBP at 18 months will be 0.34 points higher (90% CI: 0.28, 0.40) than that of subject B.</span>
<span id="cb88-546"><a href="#cb88-546" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**90% Confidence Interval**: Our <span class="in">`model_big`</span> estimates the slope of the square root of <span class="in">`sbp_1`</span> to be 0.34 in the  participants in our study. When we generalize beyond study participants to the population they were selected at random from, then our data are compatible (at the 90% confidence level) with population slopes between 0.28 and 0.40 for our transformed <span class="in">`sbp_1`</span>. </span>
<span id="cb88-547"><a href="#cb88-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-548"><a href="#cb88-548" aria-hidden="true" tabindex="-1"></a>You should also provide a description of the meaning (especially the direction) of the **point estimates** of the other coefficients in your model being sure to interpret the coefficients as having meaning *holding all other predictors constant*, but I'll skip that here.</span>
<span id="cb88-549"><a href="#cb88-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-550"><a href="#cb88-550" aria-hidden="true" tabindex="-1"></a><span class="fu"># The Smaller Model</span></span>
<span id="cb88-551"><a href="#cb88-551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-552"><a href="#cb88-552" aria-hidden="true" tabindex="-1"></a>Here, we will build a second linear regression model using a subset of our "kitchen sink" model predictors, chosen to maximize predictive value within our training sample. </span>
<span id="cb88-553"><a href="#cb88-553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-554"><a href="#cb88-554" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We'll specify the method you used to obtain this new model. (Backwards stepwise elimination is appealing but not great. It's perfectly fine to just include the key predictor and one other predictor you like, or to use best subsets to generate a subset for this new model, so long as your subset includes your key predictor.) </span>
<span id="cb88-555"><a href="#cb88-555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-556"><a href="#cb88-556" aria-hidden="true" tabindex="-1"></a><span class="fu">## Backwards Stepwise Elimination</span></span>
<span id="cb88-557"><a href="#cb88-557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-558"><a href="#cb88-558" aria-hidden="true" tabindex="-1"></a><span class="in">```{r stepwise_bw_model}</span></span>
<span id="cb88-559"><a href="#cb88-559" aria-hidden="true" tabindex="-1"></a><span class="in">step(model_big)</span></span>
<span id="cb88-560"><a href="#cb88-560" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb88-561"><a href="#cb88-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-562"><a href="#cb88-562" aria-hidden="true" tabindex="-1"></a>The backwards selection stepwise approach suggests a model with <span class="in">`sqrt(sbp1)`</span> and <span class="in">`tobacco`</span>, but not <span class="in">`age`</span>, <span class="in">`bmi1`</span> or <span class="in">`diabetes`</span>.</span>
<span id="cb88-563"><a href="#cb88-563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-564"><a href="#cb88-564" aria-hidden="true" tabindex="-1"></a><span class="fu">## Fitting the "small" model</span></span>
<span id="cb88-565"><a href="#cb88-565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-568"><a href="#cb88-568" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb88-569"><a href="#cb88-569" aria-hidden="true" tabindex="-1"></a>model_small <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">sqrt</span>(sbp2) <span class="sc">~</span> <span class="fu">sqrt</span>(sbp1) <span class="sc">+</span> tobacco, <span class="at">data =</span> hbp_train)</span>
<span id="cb88-570"><a href="#cb88-570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-571"><a href="#cb88-571" aria-hidden="true" tabindex="-1"></a><span class="fu">model_performance</span>(model_small)</span>
<span id="cb88-572"><a href="#cb88-572" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb88-573"><a href="#cb88-573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-574"><a href="#cb88-574" aria-hidden="true" tabindex="-1"></a><span class="fu">## Effect Sizes: Coefficient Estimates</span></span>
<span id="cb88-575"><a href="#cb88-575" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-578"><a href="#cb88-578" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb88-579"><a href="#cb88-579" aria-hidden="true" tabindex="-1"></a><span class="fu">model_parameters</span>(model_small, <span class="at">ci =</span> <span class="fl">0.90</span>)</span>
<span id="cb88-580"><a href="#cb88-580" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb88-581"><a href="#cb88-581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-582"><a href="#cb88-582" aria-hidden="true" tabindex="-1"></a><span class="fu">## Interpreting the Small Model Regression Equation</span></span>
<span id="cb88-583"><a href="#cb88-583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-584"><a href="#cb88-584" aria-hidden="true" tabindex="-1"></a>Here, we again need to specify the size and magnitude of all coefficients, providing estimated effect sizes with 90% confidence intervals.</span>
<span id="cb88-585"><a href="#cb88-585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-586"><a href="#cb88-586" aria-hidden="true" tabindex="-1"></a>I'll skip the necessary English sentences here in the demo that explain the meaning of the estimates in our model. You should provide a detailed explanation of the point estimates for all slopes, and of the confidence interval for the slope of your key predictor.</span>
<span id="cb88-587"><a href="#cb88-587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-588"><a href="#cb88-588" aria-hidden="true" tabindex="-1"></a><span class="fu"># In-Sample Comparison</span></span>
<span id="cb88-589"><a href="#cb88-589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-590"><a href="#cb88-590" aria-hidden="true" tabindex="-1"></a><span class="fu">## Compare Performance</span></span>
<span id="cb88-591"><a href="#cb88-591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-594"><a href="#cb88-594" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb88-595"><a href="#cb88-595" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">compare_performance</span>(model_big, model_small))</span>
<span id="cb88-596"><a href="#cb88-596" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb88-597"><a href="#cb88-597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-600"><a href="#cb88-600" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb88-601"><a href="#cb88-601" aria-hidden="true" tabindex="-1"></a><span class="fu">compare_performance</span>(model_big, model_small, <span class="at">rank =</span> <span class="cn">TRUE</span>)</span>
<span id="cb88-602"><a href="#cb88-602" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb88-603"><a href="#cb88-603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-604"><a href="#cb88-604" aria-hidden="true" tabindex="-1"></a>These results can be summarized as follows:</span>
<span id="cb88-605"><a href="#cb88-605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-606"><a href="#cb88-606" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`model_big`</span> (naturally) has a stronger $R^2$ result, but it also has a better result for RMSE, AIC and BIC.</span>
<span id="cb88-607"><a href="#cb88-607" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`model_small`</span> has a stronger result for Adjusted $R^2$ and Sigma.</span>
<span id="cb88-608"><a href="#cb88-608" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-609"><a href="#cb88-609" aria-hidden="true" tabindex="-1"></a><span class="fu">## Assessing Assumptions</span></span>
<span id="cb88-610"><a href="#cb88-610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-611"><a href="#cb88-611" aria-hidden="true" tabindex="-1"></a>Here, we should run a set of residual plots for each model, with <span class="in">`check_model()`</span> and interpret your findings in each case, carefully. I'll show my plots for <span class="in">`model_big`</span> here. </span>
<span id="cb88-612"><a href="#cb88-612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-613"><a href="#cb88-613" aria-hidden="true" tabindex="-1"></a><span class="fu">### Checking `model_big`</span></span>
<span id="cb88-614"><a href="#cb88-614" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-617"><a href="#cb88-617" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb88-618"><a href="#cb88-618" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 8</span></span>
<span id="cb88-619"><a href="#cb88-619" aria-hidden="true" tabindex="-1"></a><span class="fu">check_model</span>(model_big)</span>
<span id="cb88-620"><a href="#cb88-620" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb88-621"><a href="#cb88-621" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-622"><a href="#cb88-622" aria-hidden="true" tabindex="-1"></a>I see no serious problems with the assumptions of linearity, Normality and constant variance, nor do I see any highly influential points in our big model.</span>
<span id="cb88-623"><a href="#cb88-623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-624"><a href="#cb88-624" aria-hidden="true" tabindex="-1"></a><span class="fu">### Does collinearity have a meaningful impact?</span></span>
<span id="cb88-625"><a href="#cb88-625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-626"><a href="#cb88-626" aria-hidden="true" tabindex="-1"></a>If we fit models with multiple predictors, then we might want to augment the plot above by assessing variance inflation factors to see the potential impact of collinearity.</span>
<span id="cb88-627"><a href="#cb88-627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-630"><a href="#cb88-630" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb88-631"><a href="#cb88-631" aria-hidden="true" tabindex="-1"></a><span class="fu">vif</span>(model_big)</span>
<span id="cb88-632"><a href="#cb88-632" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb88-633"><a href="#cb88-633" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-634"><a href="#cb88-634" aria-hidden="true" tabindex="-1"></a>We'd need to see a generalized variance inflation factor above 5 for collinearity to be a meaningful concern, so we should be fine in our big model. Our small model also has multiple predictors, but collinearity cannot be an issue, since it's just a subset of our big model, which didn't have a collinearity problem.</span>
<span id="cb88-635"><a href="#cb88-635" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-636"><a href="#cb88-636" aria-hidden="true" tabindex="-1"></a><span class="fu">## Comparing the Models</span></span>
<span id="cb88-637"><a href="#cb88-637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-638"><a href="#cb88-638" aria-hidden="true" tabindex="-1"></a>Based on the training sample, you should draw a conclusion. So far, I will support the larger model. It has (slightly) better performance on the fit quality measures, and each model shows no serious problems with regression assumptions.</span>
<span id="cb88-639"><a href="#cb88-639" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-640"><a href="#cb88-640" aria-hidden="true" tabindex="-1"></a><span class="fu"># Model Validation</span></span>
<span id="cb88-641"><a href="#cb88-641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-642"><a href="#cb88-642" aria-hidden="true" tabindex="-1"></a>Now, we will use our two regression models to predict the value of our outcome using the predictor values  in the test sample. </span>
<span id="cb88-643"><a href="#cb88-643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-644"><a href="#cb88-644" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We may need to back-transform the predictions to the original units if we wind up fitting a model to a transformed outcome. </span>
<span id="cb88-645"><a href="#cb88-645" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We'll definitely need to compare the two models in terms of our four main summaries, in a Table, which I will definitely want to see in your portfolio. </span>
<span id="cb88-646"><a href="#cb88-646" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We'll have to specify which model appears better at out-of-sample prediction according to these comparisons, and how we know that.</span>
<span id="cb88-647"><a href="#cb88-647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-648"><a href="#cb88-648" aria-hidden="true" tabindex="-1"></a><span class="fu">## Calculating Prediction Errors</span></span>
<span id="cb88-649"><a href="#cb88-649" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-650"><a href="#cb88-650" aria-hidden="true" tabindex="-1"></a><span class="fu">### Big Model: Back-Transformation and Calculating Fits/Residuals</span></span>
<span id="cb88-651"><a href="#cb88-651" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-652"><a href="#cb88-652" aria-hidden="true" tabindex="-1"></a>First, we need to create our transformed data in our test data.</span>
<span id="cb88-653"><a href="#cb88-653" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-656"><a href="#cb88-656" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb88-657"><a href="#cb88-657" aria-hidden="true" tabindex="-1"></a>hbp_test <span class="ot">&lt;-</span> hbp_test <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">sbp1_tr =</span> <span class="fu">sqrt</span>(sbp1), <span class="at">sbp2_tr =</span> <span class="fu">sqrt</span>(sbp2))</span>
<span id="cb88-658"><a href="#cb88-658" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb88-659"><a href="#cb88-659" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-660"><a href="#cb88-660" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-661"><a href="#cb88-661" aria-hidden="true" tabindex="-1"></a>We'll use the <span class="in">`augment`</span> function from the <span class="in">`broom`</span> package to help us here, and create <span class="in">`sbp2_fit`</span> to hold the fitted values on the original <span class="in">`sbp2`</span> scale after back-transformation (by squaring the predictions on the square root scale) and then <span class="in">`sbp2_res`</span> to hold the residuals (prediction errors) we observe using the big model on the <span class="in">`hbp_test`</span> data.</span>
<span id="cb88-662"><a href="#cb88-662" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-665"><a href="#cb88-665" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb88-666"><a href="#cb88-666" aria-hidden="true" tabindex="-1"></a>aug_big <span class="ot">&lt;-</span> <span class="fu">augment</span>(model_big, <span class="at">newdata =</span> hbp_test) <span class="sc">|&gt;</span> </span>
<span id="cb88-667"><a href="#cb88-667" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mod_name =</span> <span class="st">"big"</span>,</span>
<span id="cb88-668"><a href="#cb88-668" aria-hidden="true" tabindex="-1"></a>         <span class="at">sbp2_fit =</span> .fitted<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb88-669"><a href="#cb88-669" aria-hidden="true" tabindex="-1"></a>         <span class="at">sbp2_res =</span> sbp2 <span class="sc">-</span> sbp2_fit) <span class="sc">|&gt;</span></span>
<span id="cb88-670"><a href="#cb88-670" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(subj_id, mod_name, sbp2, sbp2_fit, sbp2_res, <span class="fu">everything</span>())</span>
<span id="cb88-671"><a href="#cb88-671" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-672"><a href="#cb88-672" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(aug_big,<span class="dv">3</span>)</span>
<span id="cb88-673"><a href="#cb88-673" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb88-674"><a href="#cb88-674" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-675"><a href="#cb88-675" aria-hidden="true" tabindex="-1"></a><span class="fu">### Small Model: Back-Transformation and Calculating Fits/Residuals</span></span>
<span id="cb88-676"><a href="#cb88-676" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-677"><a href="#cb88-677" aria-hidden="true" tabindex="-1"></a>We'll do the same thing, but using the small model in the <span class="in">`hbp_test`</span> data.</span>
<span id="cb88-678"><a href="#cb88-678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-681"><a href="#cb88-681" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb88-682"><a href="#cb88-682" aria-hidden="true" tabindex="-1"></a>aug_small <span class="ot">&lt;-</span> <span class="fu">augment</span>(model_small, <span class="at">newdata =</span> hbp_test) <span class="sc">|&gt;</span> </span>
<span id="cb88-683"><a href="#cb88-683" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mod_name =</span> <span class="st">"small"</span>,</span>
<span id="cb88-684"><a href="#cb88-684" aria-hidden="true" tabindex="-1"></a>         <span class="at">sbp2_fit =</span> .fitted<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb88-685"><a href="#cb88-685" aria-hidden="true" tabindex="-1"></a>         <span class="at">sbp2_res =</span> sbp2 <span class="sc">-</span> sbp2_fit) <span class="sc">|&gt;</span></span>
<span id="cb88-686"><a href="#cb88-686" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(subj_id, mod_name, sbp2, sbp2_fit, sbp2_res, <span class="fu">everything</span>())</span>
<span id="cb88-687"><a href="#cb88-687" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-688"><a href="#cb88-688" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(aug_small,<span class="dv">3</span>)</span>
<span id="cb88-689"><a href="#cb88-689" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb88-690"><a href="#cb88-690" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-691"><a href="#cb88-691" aria-hidden="true" tabindex="-1"></a><span class="fu">### Combining the Results</span></span>
<span id="cb88-692"><a href="#cb88-692" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-695"><a href="#cb88-695" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb88-696"><a href="#cb88-696" aria-hidden="true" tabindex="-1"></a>test_comp <span class="ot">&lt;-</span> <span class="fu">union</span>(aug_big, aug_small) <span class="sc">|&gt;</span></span>
<span id="cb88-697"><a href="#cb88-697" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(subj_id, mod_name)</span>
<span id="cb88-698"><a href="#cb88-698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-699"><a href="#cb88-699" aria-hidden="true" tabindex="-1"></a>test_comp <span class="sc">|&gt;</span> <span class="fu">head</span>()</span>
<span id="cb88-700"><a href="#cb88-700" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb88-701"><a href="#cb88-701" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-702"><a href="#cb88-702" aria-hidden="true" tabindex="-1"></a>Given this <span class="in">`test_comp`</span> tibble, including predictions and residuals from the kitchen sink model on our test data, we can now:</span>
<span id="cb88-703"><a href="#cb88-703" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-704"><a href="#cb88-704" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Visualize the prediction errors from each model.</span>
<span id="cb88-705"><a href="#cb88-705" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Summarize those errors across each model.</span>
<span id="cb88-706"><a href="#cb88-706" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Identify the "worst fitting" subject for each model in the test sample.</span>
<span id="cb88-707"><a href="#cb88-707" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-708"><a href="#cb88-708" aria-hidden="true" tabindex="-1"></a>The next few subsections actually do these things.</span>
<span id="cb88-709"><a href="#cb88-709" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-710"><a href="#cb88-710" aria-hidden="true" tabindex="-1"></a><span class="fu">## Visualizing the Predictions</span></span>
<span id="cb88-711"><a href="#cb88-711" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-714"><a href="#cb88-714" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb88-715"><a href="#cb88-715" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(test_comp, <span class="fu">aes</span>(<span class="at">x =</span> sbp2_fit, <span class="at">y =</span> sbp2)) <span class="sc">+</span></span>
<span id="cb88-716"><a href="#cb88-716" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb88-717"><a href="#cb88-717" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">1</span>, <span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">lty =</span> <span class="st">"dashed"</span>) <span class="sc">+</span> </span>
<span id="cb88-718"><a href="#cb88-718" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"loess"</span>, <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">formula =</span> y <span class="sc">~</span> x) <span class="sc">+</span></span>
<span id="cb88-719"><a href="#cb88-719" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>( <span class="sc">~</span> mod_name, <span class="at">labeller =</span> <span class="st">"label_both"</span>) <span class="sc">+</span></span>
<span id="cb88-720"><a href="#cb88-720" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Predicted sbp2"</span>,</span>
<span id="cb88-721"><a href="#cb88-721" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Observed sbp2"</span>,</span>
<span id="cb88-722"><a href="#cb88-722" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Observed vs. Predicted sbp2"</span>,</span>
<span id="cb88-723"><a href="#cb88-723" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Comparing Big to Small Model in Test Sample"</span>,</span>
<span id="cb88-724"><a href="#cb88-724" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">"Dashed line is where Observed = Predicted"</span>)</span>
<span id="cb88-725"><a href="#cb88-725" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb88-726"><a href="#cb88-726" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-727"><a href="#cb88-727" aria-hidden="true" tabindex="-1"></a>I'm not seeing a lot of difference between the models in terms of the adherence of the points to the dashed line. The models seem to be making fairly similar errors.</span>
<span id="cb88-728"><a href="#cb88-728" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-729"><a href="#cb88-729" aria-hidden="true" tabindex="-1"></a><span class="fu">## Summarizing the Errors</span></span>
<span id="cb88-730"><a href="#cb88-730" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-731"><a href="#cb88-731" aria-hidden="true" tabindex="-1"></a>Calculate the mean absolute prediction error (MAPE), the root mean squared prediction error (RMSPE) and the maximum absolute error across the predictions made by each model. </span>
<span id="cb88-732"><a href="#cb88-732" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-735"><a href="#cb88-735" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb88-736"><a href="#cb88-736" aria-hidden="true" tabindex="-1"></a>test_comp <span class="sc">|&gt;</span></span>
<span id="cb88-737"><a href="#cb88-737" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(mod_name) <span class="sc">|&gt;</span></span>
<span id="cb88-738"><a href="#cb88-738" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb88-739"><a href="#cb88-739" aria-hidden="true" tabindex="-1"></a>            <span class="at">MAPE =</span> <span class="fu">mean</span>(<span class="fu">abs</span>(sbp2_res)), </span>
<span id="cb88-740"><a href="#cb88-740" aria-hidden="true" tabindex="-1"></a>            <span class="at">RMSPE =</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>(sbp2_res<span class="sc">^</span><span class="dv">2</span>)),</span>
<span id="cb88-741"><a href="#cb88-741" aria-hidden="true" tabindex="-1"></a>            <span class="at">max_error =</span> <span class="fu">max</span>(<span class="fu">abs</span>(sbp2_res)),</span>
<span id="cb88-742"><a href="#cb88-742" aria-hidden="true" tabindex="-1"></a>            <span class="at">R2_val =</span> <span class="fu">cor</span>(sbp2, sbp2_fit)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb88-743"><a href="#cb88-743" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb88-744"><a href="#cb88-744" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-745"><a href="#cb88-745" aria-hidden="true" tabindex="-1"></a>This is a table Dr. Love will **definitely** need to see during your presentation.</span>
<span id="cb88-746"><a href="#cb88-746" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-747"><a href="#cb88-747" aria-hidden="true" tabindex="-1"></a>In this case, all four of these summaries are better for the bigger model.</span>
<span id="cb88-748"><a href="#cb88-748" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-749"><a href="#cb88-749" aria-hidden="true" tabindex="-1"></a>These models suggest an average error in predicting systolic blood pressure (using MAPE) of more than 13 mm Hg. That's not great on the scale of systolic blood pressure, I think. In addition, our validated $R^2$ values here are only slightly worse (in either model) than what we saw in our training sample.</span>
<span id="cb88-750"><a href="#cb88-750" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-751"><a href="#cb88-751" aria-hidden="true" tabindex="-1"></a><span class="fu">### Identify the largest errors</span></span>
<span id="cb88-752"><a href="#cb88-752" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-753"><a href="#cb88-753" aria-hidden="true" tabindex="-1"></a>Identify the subject(s) where that maximum prediction error was made by each model, and the observed and model-fitted values of <span class="in">`sbp2`</span> for that subject in each case.</span>
<span id="cb88-754"><a href="#cb88-754" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-757"><a href="#cb88-757" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb88-758"><a href="#cb88-758" aria-hidden="true" tabindex="-1"></a>temp1 <span class="ot">&lt;-</span> aug_big <span class="sc">|&gt;</span></span>
<span id="cb88-759"><a href="#cb88-759" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">abs</span>(sbp2_res) <span class="sc">==</span> <span class="fu">max</span>(<span class="fu">abs</span>(sbp2_res)))</span>
<span id="cb88-760"><a href="#cb88-760" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-761"><a href="#cb88-761" aria-hidden="true" tabindex="-1"></a>temp2 <span class="ot">&lt;-</span> aug_small <span class="sc">|&gt;</span></span>
<span id="cb88-762"><a href="#cb88-762" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">abs</span>(sbp2_res) <span class="sc">==</span> <span class="fu">max</span>(<span class="fu">abs</span>(sbp2_res)))</span>
<span id="cb88-763"><a href="#cb88-763" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-764"><a href="#cb88-764" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(temp1, temp2)</span>
<span id="cb88-765"><a href="#cb88-765" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb88-766"><a href="#cb88-766" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-767"><a href="#cb88-767" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>In our case, a different subject (<span class="in">`A0703`</span> in the big model, and <span class="in">`A0265`</span> in the small model) was most poorly fit by each model.</span>
<span id="cb88-768"><a href="#cb88-768" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-769"><a href="#cb88-769" aria-hidden="true" tabindex="-1"></a><span class="fu">## Comparing the Models</span></span>
<span id="cb88-770"><a href="#cb88-770" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-771"><a href="#cb88-771" aria-hidden="true" tabindex="-1"></a>I would select <span class="in">`model_big`</span> here, on the basis of the similar performance in terms of the visualization of errors, and small improvements in all four of our main test sample summaries.</span>
<span id="cb88-772"><a href="#cb88-772" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-773"><a href="#cb88-773" aria-hidden="true" tabindex="-1"></a><span class="fu"># Discussion</span></span>
<span id="cb88-774"><a href="#cb88-774" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-775"><a href="#cb88-775" aria-hidden="true" tabindex="-1"></a><span class="fu">## Chosen Model</span></span>
<span id="cb88-776"><a href="#cb88-776" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-777"><a href="#cb88-777" aria-hidden="true" tabindex="-1"></a>I chose the bigger model. You'll want to briefly reiterate the reasons why in this subsection, using results related to training-sample summaries, training-sample assumptions and model checks, and test-sample performance assessments. If you have evidence towards both models, decide what's more important to you, and pick a winner.</span>
<span id="cb88-778"><a href="#cb88-778" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-779"><a href="#cb88-779" aria-hidden="true" tabindex="-1"></a><span class="fu">## Answering My Question</span></span>
<span id="cb88-780"><a href="#cb88-780" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-781"><a href="#cb88-781" aria-hidden="true" tabindex="-1"></a>Now use the winning model to answer the research question, in a complete sentence of two.</span>
<span id="cb88-782"><a href="#cb88-782" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-783"><a href="#cb88-783" aria-hidden="true" tabindex="-1"></a><span class="fu">## Next Steps</span></span>
<span id="cb88-784"><a href="#cb88-784" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-785"><a href="#cb88-785" aria-hidden="true" tabindex="-1"></a>Describe an interesting next step, which might involve fitting a new model not available with your current cleaned data, or dealing with missing values differently, or obtaining new or better data, or something else. You should be able to describe why this might help.</span>
<span id="cb88-786"><a href="#cb88-786" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-787"><a href="#cb88-787" aria-hidden="true" tabindex="-1"></a><span class="fu">## Reflection</span></span>
<span id="cb88-788"><a href="#cb88-788" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-789"><a href="#cb88-789" aria-hidden="true" tabindex="-1"></a>Tell us what you know now that would have changed your approach to Study 2 had you known it at the start.</span>
<span id="cb88-790"><a href="#cb88-790" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-791"><a href="#cb88-791" aria-hidden="true" tabindex="-1"></a><span class="fu"># Session Information</span></span>
<span id="cb88-792"><a href="#cb88-792" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-793"><a href="#cb88-793" aria-hidden="true" tabindex="-1"></a>should be included at the end of your report, from the **xfun** package, please.</span>
<span id="cb88-794"><a href="#cb88-794" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-797"><a href="#cb88-797" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb88-798"><a href="#cb88-798" aria-hidden="true" tabindex="-1"></a><span class="fu">session_info</span>()</span>
<span id="cb88-799"><a href="#cb88-799" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>