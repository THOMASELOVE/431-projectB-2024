<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Thomas E. Love">
<meta name="dcterms.date" content="2023-10-16">

<title>431 Project B Sample Study 2 Report – 431 Project B</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">431 Project B</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-the-data" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">The Data</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-the-data">    
        <li>
    <a class="dropdown-item" href="./data1.html">
 <span class="dropdown-text">Data Development</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./data2.html">
 <span class="dropdown-text">Using NHANES data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./data3.html">
 <span class="dropdown-text">Using Something Else</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="./register.html"> 
<span class="menu-text">Registration</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-study-1" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Study 1</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-study-1">    
        <li>
    <a class="dropdown-item" href="./study1a.html">
 <span class="dropdown-text">Required Study 1 Analyses</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./study1b.html">
 <span class="dropdown-text">Study 1 Report Specifications</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./study1c.html">
 <span class="dropdown-text">Study 1 Sample Report</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-study-2" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Study 2</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-study-2">    
        <li>
    <a class="dropdown-item" href="./study2a.html">
 <span class="dropdown-text">Required Study 2 Analyses</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./study2b.html">
 <span class="dropdown-text">Study 2 Report Specifications</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./study2c.html">
 <span class="dropdown-text">Study 2 Sample Report</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="./self_eval.html"> 
<span class="menu-text">Self-Evaluation</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./checklist.html"> 
<span class="menu-text">Checklist</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./tipsheet.html"> 
<span class="menu-text">Tip Sheet</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="https://thomaselove.github.io/431-2024/contact.html"> 
<span class="menu-text">Contact Us</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://thomaselove.github.io/431-2024"> 
<span class="menu-text">431 Homepage</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#important-reminders-from-dr.-love" id="toc-important-reminders-from-dr.-love" class="nav-link active" data-scroll-target="#important-reminders-from-dr.-love">Important Reminders from Dr.&nbsp;Love</a></li>
  <li><a href="#setup-and-data-ingest" id="toc-setup-and-data-ingest" class="nav-link" data-scroll-target="#setup-and-data-ingest"><span class="header-section-number">1</span> Setup and Data Ingest</a>
  <ul class="collapse">
  <li><a href="#initial-setup-and-package-loads-in-r" id="toc-initial-setup-and-package-loads-in-r" class="nav-link" data-scroll-target="#initial-setup-and-package-loads-in-r"><span class="header-section-number">1.1</span> Initial Setup and Package Loads in R</a></li>
  <li><a href="#loading-the-raw-data-into-r" id="toc-loading-the-raw-data-into-r" class="nav-link" data-scroll-target="#loading-the-raw-data-into-r"><span class="header-section-number">1.2</span> Loading the Raw Data into R</a></li>
  </ul></li>
  <li><a href="#cleaning-the-data" id="toc-cleaning-the-data" class="nav-link" data-scroll-target="#cleaning-the-data"><span class="header-section-number">2</span> Cleaning the Data</a>
  <ul class="collapse">
  <li><a href="#merging-the-data" id="toc-merging-the-data" class="nav-link" data-scroll-target="#merging-the-data"><span class="header-section-number">2.1</span> Merging the Data</a></li>
  <li><a href="#the-raw-data" id="toc-the-raw-data" class="nav-link" data-scroll-target="#the-raw-data"><span class="header-section-number">2.2</span> The Raw Data</a></li>
  <li><a href="#which-variables-should-be-included-in-the-tidy-data-set" id="toc-which-variables-should-be-included-in-the-tidy-data-set" class="nav-link" data-scroll-target="#which-variables-should-be-included-in-the-tidy-data-set"><span class="header-section-number">2.3</span> Which variables should be included in the tidy data set?</a></li>
  <li><a href="#checking-our-outcome-and-key-predictor" id="toc-checking-our-outcome-and-key-predictor" class="nav-link" data-scroll-target="#checking-our-outcome-and-key-predictor"><span class="header-section-number">2.4</span> Checking our Outcome and Key Predictor</a></li>
  <li><a href="#checking-the-quantitative-predictors" id="toc-checking-the-quantitative-predictors" class="nav-link" data-scroll-target="#checking-the-quantitative-predictors"><span class="header-section-number">2.5</span> Checking the Quantitative Predictors</a></li>
  <li><a href="#checking-the-categorical-variables" id="toc-checking-the-categorical-variables" class="nav-link" data-scroll-target="#checking-the-categorical-variables"><span class="header-section-number">2.6</span> Checking the Categorical Variables</a>
  <ul class="collapse">
  <li><a href="#nses-home-neighborhoods-socio-economic-status" id="toc-nses-home-neighborhoods-socio-economic-status" class="nav-link" data-scroll-target="#nses-home-neighborhoods-socio-economic-status"><span class="header-section-number">2.6.1</span> <code>nses</code>: home neighborhood’s socio-economic status</a></li>
  <li><a href="#tobacco-tobacco-use-history" id="toc-tobacco-tobacco-use-history" class="nav-link" data-scroll-target="#tobacco-tobacco-use-history"><span class="header-section-number">2.6.2</span> <code>tobacco</code>: tobacco use history</a></li>
  <li><a href="#insurance-primary-insurance-type" id="toc-insurance-primary-insurance-type" class="nav-link" data-scroll-target="#insurance-primary-insurance-type"><span class="header-section-number">2.6.3</span> <code>insurance</code>: primary insurance type</a></li>
  <li><a href="#what-about-the-subjects" id="toc-what-about-the-subjects" class="nav-link" data-scroll-target="#what-about-the-subjects"><span class="header-section-number">2.6.4</span> What about the subjects?</a></li>
  </ul></li>
  <li><a href="#dealing-with-missingness" id="toc-dealing-with-missingness" class="nav-link" data-scroll-target="#dealing-with-missingness"><span class="header-section-number">2.7</span> Dealing with Missingness</a>
  <ul class="collapse">
  <li><a href="#assume-mcar-and-build-tibble-of-complete-cases" id="toc-assume-mcar-and-build-tibble-of-complete-cases" class="nav-link" data-scroll-target="#assume-mcar-and-build-tibble-of-complete-cases"><span class="header-section-number">2.7.1</span> Assume MCAR and Build Tibble of Complete Cases</a></li>
  <li><a href="#identifying-missing-data" id="toc-identifying-missing-data" class="nav-link" data-scroll-target="#identifying-missing-data"><span class="header-section-number">2.7.2</span> Identifying Missing Data</a></li>
  <li><a href="#the-complete-cases-tibble" id="toc-the-complete-cases-tibble" class="nav-link" data-scroll-target="#the-complete-cases-tibble"><span class="header-section-number">2.7.3</span> The Complete Cases Tibble</a></li>
  <li><a href="#what-if-we-instead-did-imputation" id="toc-what-if-we-instead-did-imputation" class="nav-link" data-scroll-target="#what-if-we-instead-did-imputation"><span class="header-section-number">2.7.4</span> What if we instead did imputation?</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#codebook-and-data-description" id="toc-codebook-and-data-description" class="nav-link" data-scroll-target="#codebook-and-data-description"><span class="header-section-number">3</span> Codebook and Data Description</a>
  <ul class="collapse">
  <li><a href="#the-codebook" id="toc-the-codebook" class="nav-link" data-scroll-target="#the-codebook"><span class="header-section-number">3.1</span> The Codebook</a></li>
  <li><a href="#analytic-tibble" id="toc-analytic-tibble" class="nav-link" data-scroll-target="#analytic-tibble"><span class="header-section-number">3.2</span> Analytic Tibble</a></li>
  <li><a href="#numerical-data-description" id="toc-numerical-data-description" class="nav-link" data-scroll-target="#numerical-data-description"><span class="header-section-number">3.3</span> Numerical Data Description</a></li>
  </ul></li>
  <li><a href="#my-research-question" id="toc-my-research-question" class="nav-link" data-scroll-target="#my-research-question"><span class="header-section-number">4</span> My Research Question</a></li>
  <li><a href="#partitioning-the-data" id="toc-partitioning-the-data" class="nav-link" data-scroll-target="#partitioning-the-data"><span class="header-section-number">5</span> Partitioning the Data</a></li>
  <li><a href="#transforming-the-outcome" id="toc-transforming-the-outcome" class="nav-link" data-scroll-target="#transforming-the-outcome"><span class="header-section-number">6</span> Transforming the Outcome</a>
  <ul class="collapse">
  <li><a href="#visualizing-the-outcome-distribution" id="toc-visualizing-the-outcome-distribution" class="nav-link" data-scroll-target="#visualizing-the-outcome-distribution"><span class="header-section-number">6.1</span> Visualizing the Outcome Distribution</a></li>
  <li><a href="#numerical-summary-of-the-outcome" id="toc-numerical-summary-of-the-outcome" class="nav-link" data-scroll-target="#numerical-summary-of-the-outcome"><span class="header-section-number">6.2</span> Numerical Summary of the Outcome</a></li>
  <li><a href="#numerical-summaries-of-the-predictors" id="toc-numerical-summaries-of-the-predictors" class="nav-link" data-scroll-target="#numerical-summaries-of-the-predictors"><span class="header-section-number">6.3</span> Numerical Summaries of the Predictors</a>
  <ul class="collapse">
  <li><a href="#using-the-inspect-function-from-mosaic" id="toc-using-the-inspect-function-from-mosaic" class="nav-link" data-scroll-target="#using-the-inspect-function-from-mosaic"><span class="header-section-number">6.3.1</span> Using the <code>inspect</code> function from <code>mosaic</code></a></li>
  </ul></li>
  <li><a href="#scatterplot-matrix" id="toc-scatterplot-matrix" class="nav-link" data-scroll-target="#scatterplot-matrix"><span class="header-section-number">6.4</span> Scatterplot Matrix</a></li>
  <li><a href="#collinearity-checking" id="toc-collinearity-checking" class="nav-link" data-scroll-target="#collinearity-checking"><span class="header-section-number">6.5</span> Collinearity Checking</a></li>
  <li><a href="#boxcox-function-to-assess-need-for-transformation-of-our-outcome" id="toc-boxcox-function-to-assess-need-for-transformation-of-our-outcome" class="nav-link" data-scroll-target="#boxcox-function-to-assess-need-for-transformation-of-our-outcome"><span class="header-section-number">6.6</span> <code>boxCox</code> function to assess need for transformation of our outcome</a></li>
  </ul></li>
  <li><a href="#the-big-model" id="toc-the-big-model" class="nav-link" data-scroll-target="#the-big-model"><span class="header-section-number">7</span> The Big Model</a>
  <ul class="collapse">
  <li><a href="#fittingsummarizing-the-kitchen-sink-model" id="toc-fittingsummarizing-the-kitchen-sink-model" class="nav-link" data-scroll-target="#fittingsummarizing-the-kitchen-sink-model"><span class="header-section-number">7.1</span> Fitting/Summarizing the Kitchen Sink model</a></li>
  <li><a href="#effect-sizes-coefficient-estimates" id="toc-effect-sizes-coefficient-estimates" class="nav-link" data-scroll-target="#effect-sizes-coefficient-estimates"><span class="header-section-number">7.2</span> Effect Sizes: Coefficient Estimates</a></li>
  <li><a href="#describing-the-equation" id="toc-describing-the-equation" class="nav-link" data-scroll-target="#describing-the-equation"><span class="header-section-number">7.3</span> Describing the Equation</a></li>
  </ul></li>
  <li><a href="#the-smaller-model" id="toc-the-smaller-model" class="nav-link" data-scroll-target="#the-smaller-model"><span class="header-section-number">8</span> The Smaller Model</a>
  <ul class="collapse">
  <li><a href="#backwards-stepwise-elimination" id="toc-backwards-stepwise-elimination" class="nav-link" data-scroll-target="#backwards-stepwise-elimination"><span class="header-section-number">8.1</span> Backwards Stepwise Elimination</a></li>
  <li><a href="#fitting-the-small-model" id="toc-fitting-the-small-model" class="nav-link" data-scroll-target="#fitting-the-small-model"><span class="header-section-number">8.2</span> Fitting the “small” model</a></li>
  <li><a href="#effect-sizes-coefficient-estimates-1" id="toc-effect-sizes-coefficient-estimates-1" class="nav-link" data-scroll-target="#effect-sizes-coefficient-estimates-1"><span class="header-section-number">8.3</span> Effect Sizes: Coefficient Estimates</a></li>
  <li><a href="#interpreting-the-small-model-regression-equation" id="toc-interpreting-the-small-model-regression-equation" class="nav-link" data-scroll-target="#interpreting-the-small-model-regression-equation"><span class="header-section-number">8.4</span> Interpreting the Small Model Regression Equation</a></li>
  </ul></li>
  <li><a href="#in-sample-comparison" id="toc-in-sample-comparison" class="nav-link" data-scroll-target="#in-sample-comparison"><span class="header-section-number">9</span> In-Sample Comparison</a>
  <ul class="collapse">
  <li><a href="#quality-of-fit" id="toc-quality-of-fit" class="nav-link" data-scroll-target="#quality-of-fit"><span class="header-section-number">9.1</span> Quality of Fit</a></li>
  <li><a href="#assessing-assumptions" id="toc-assessing-assumptions" class="nav-link" data-scroll-target="#assessing-assumptions"><span class="header-section-number">9.2</span> Assessing Assumptions</a>
  <ul class="collapse">
  <li><a href="#residual-plots-for-the-big-model" id="toc-residual-plots-for-the-big-model" class="nav-link" data-scroll-target="#residual-plots-for-the-big-model"><span class="header-section-number">9.2.1</span> Residual Plots for the Big Model</a></li>
  <li><a href="#residual-plots-for-the-small-model" id="toc-residual-plots-for-the-small-model" class="nav-link" data-scroll-target="#residual-plots-for-the-small-model"><span class="header-section-number">9.2.2</span> Residual Plots for the Small Model</a></li>
  <li><a href="#does-collinearity-have-a-meaningful-impact" id="toc-does-collinearity-have-a-meaningful-impact" class="nav-link" data-scroll-target="#does-collinearity-have-a-meaningful-impact"><span class="header-section-number">9.2.3</span> Does collinearity have a meaningful impact?</a></li>
  </ul></li>
  <li><a href="#comparing-the-models" id="toc-comparing-the-models" class="nav-link" data-scroll-target="#comparing-the-models"><span class="header-section-number">9.3</span> Comparing the Models</a></li>
  </ul></li>
  <li><a href="#model-validation" id="toc-model-validation" class="nav-link" data-scroll-target="#model-validation"><span class="header-section-number">10</span> Model Validation</a>
  <ul class="collapse">
  <li><a href="#calculating-prediction-errors" id="toc-calculating-prediction-errors" class="nav-link" data-scroll-target="#calculating-prediction-errors"><span class="header-section-number">10.1</span> Calculating Prediction Errors</a>
  <ul class="collapse">
  <li><a href="#big-model-back-transformation-and-calculating-fitsresiduals" id="toc-big-model-back-transformation-and-calculating-fitsresiduals" class="nav-link" data-scroll-target="#big-model-back-transformation-and-calculating-fitsresiduals"><span class="header-section-number">10.1.1</span> Big Model: Back-Transformation and Calculating Fits/Residuals</a></li>
  <li><a href="#small-model-back-transformation-and-calculating-fitsresiduals" id="toc-small-model-back-transformation-and-calculating-fitsresiduals" class="nav-link" data-scroll-target="#small-model-back-transformation-and-calculating-fitsresiduals"><span class="header-section-number">10.1.2</span> Small Model: Back-Transformation and Calculating Fits/Residuals</a></li>
  <li><a href="#combining-the-results" id="toc-combining-the-results" class="nav-link" data-scroll-target="#combining-the-results"><span class="header-section-number">10.1.3</span> Combining the Results</a></li>
  </ul></li>
  <li><a href="#visualizing-the-predictions" id="toc-visualizing-the-predictions" class="nav-link" data-scroll-target="#visualizing-the-predictions"><span class="header-section-number">10.2</span> Visualizing the Predictions</a></li>
  <li><a href="#summarizing-the-errors" id="toc-summarizing-the-errors" class="nav-link" data-scroll-target="#summarizing-the-errors"><span class="header-section-number">10.3</span> Summarizing the Errors</a>
  <ul class="collapse">
  <li><a href="#identify-the-largest-errors" id="toc-identify-the-largest-errors" class="nav-link" data-scroll-target="#identify-the-largest-errors"><span class="header-section-number">10.3.1</span> Identify the largest errors</a></li>
  <li><a href="#validated-r-square-values" id="toc-validated-r-square-values" class="nav-link" data-scroll-target="#validated-r-square-values"><span class="header-section-number">10.3.2</span> Validated R-square values</a></li>
  </ul></li>
  <li><a href="#comparing-the-models-1" id="toc-comparing-the-models-1" class="nav-link" data-scroll-target="#comparing-the-models-1"><span class="header-section-number">10.4</span> Comparing the Models</a></li>
  </ul></li>
  <li><a href="#discussion" id="toc-discussion" class="nav-link" data-scroll-target="#discussion"><span class="header-section-number">11</span> Discussion</a>
  <ul class="collapse">
  <li><a href="#chosen-model" id="toc-chosen-model" class="nav-link" data-scroll-target="#chosen-model"><span class="header-section-number">11.1</span> Chosen Model</a></li>
  <li><a href="#answering-my-question" id="toc-answering-my-question" class="nav-link" data-scroll-target="#answering-my-question"><span class="header-section-number">11.2</span> Answering My Question</a></li>
  <li><a href="#next-steps" id="toc-next-steps" class="nav-link" data-scroll-target="#next-steps"><span class="header-section-number">11.3</span> Next Steps</a></li>
  <li><a href="#reflection" id="toc-reflection" class="nav-link" data-scroll-target="#reflection"><span class="header-section-number">11.4</span> Reflection</a></li>
  </ul></li>
  <li><a href="#session-information" id="toc-session-information" class="nav-link" data-scroll-target="#session-information"><span class="header-section-number">12</span> Session Information</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">431 Project B Sample Study 2 Report</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Thomas E. Love </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">2023-10-16</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="important-reminders-from-dr.-love" class="level1 unnumbered">
<h1 class="unnumbered">Important Reminders from Dr.&nbsp;Love</h1>
<ol type="1">
<li><p>Remember that each subsection should include at least one complete sentence explaining what you are doing, specifying the variables you are using and how you are using them, and then conclude with at least one complete sentence of discussion of the key conclusions you draw from the current step, and a discussion of any limitations you can describe that apply to the results.</p></li>
<li><p>If you want to download the Quarto code I used to create this document, click on the Code button near the title of this Sample Study.</p></li>
<li><p>For heaven’s sake, DO NOT use my words included in this example report in your project. Rewrite everything to make it relevant to your situation. Do not repeat my instructions back to me.</p></li>
</ol>
</section>
<section id="setup-and-data-ingest" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Setup and Data Ingest</h1>
<p>This document demonstrates analyses we are asking you to complete in Study 2 for Project B. The simulated data used in this example report are found in the <code>hbp_study.csv</code> data file available in the projectB section of <a href="https://github.com/THOMASELOVE/431-data">our 431-data website</a>.</p>
<p>These are simulated data from a study of high blood pressure in 999 African-American adult subjects who are not of Hispanic or Latino ethnicity. To be included, the subject had to be between 33 and 83 years of age at baseline, have a series of items available in their health record at baseline, including a baseline systolic blood pressure, and then return for a blood pressure check 18 months later. Our goal will be to build a prediction model for the subject’s systolic blood pressure at the end of the 18-month period, with the key predictor being that same subject’s systolic blood pressure at the start of the period, and adjusting (in our larger model) for several other characteristics of the subjects at baseline.</p>
<section id="initial-setup-and-package-loads-in-r" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="initial-setup-and-package-loads-in-r"><span class="header-section-number">1.1</span> Initial Setup and Package Loads in R</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(GGally)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Hmisc)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mosaic)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(naniar)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sessioninfo)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(simputation)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse) </span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="do">## Global options</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">comment=</span><span class="cn">NA</span>)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_bw</span>())</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">dplyr.summarise.inform =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="loading-the-raw-data-into-r" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="loading-the-raw-data-into-r"><span class="header-section-number">1.2</span> Loading the Raw Data into R</h2>
<p>Here, we load the data using <code>read_csv</code> and then convert all <code>character</code> variables to <code>factors</code> in R, and then change our identifying code: <code>subj_id</code> back to a character variable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>hbp_study <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/hbp_study.csv"</span>, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.character), as.factor)) <span class="sc">|&gt;</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">subj_id =</span> <span class="fu">as.character</span>(subj_id))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="cleaning-the-data" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Cleaning the Data</h1>
<section id="merging-the-data" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="merging-the-data"><span class="header-section-number">2.1</span> Merging the Data</h2>
<p>In my little demonstration here, I don’t have to do any merging.</p>
</section>
<section id="the-raw-data" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="the-raw-data"><span class="header-section-number">2.2</span> The Raw Data</h2>
<p>The <code>hbp_study</code> data set includes 12 variables and 999 adult subjects. For each subject, we have gathered</p>
<ul>
<li>baseline information on their <code>age</code>, and their <code>sex</code>,</li>
<li>whether or not they have a <code>diabetes</code> diagnosis,</li>
<li>the socio-economic status of their neighborhood of residence (<code>nses</code>),</li>
<li>their body-mass index (<code>bmi1</code>) and systolic blood pressure (<code>sbp1</code>),</li>
<li>their <code>insurance</code> type, <code>tobacco</code> use history, and</li>
<li>whether or not they have a prescription for a <code>statin</code>, or for a <code>diuretic</code>.</li>
<li>Eighteen months later, we gathered a new systolic blood pressure (<code>sbp2</code>) for each subject.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(hbp_study)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 999
Columns: 12
$ subj_id   &lt;chr&gt; "A0001", "A0004", "A0005", "A0013", "A0015", "A0017", "A0018…
$ age       &lt;dbl&gt; 58, 65, 61, 51, 61, 45, 40, 50, 43, 46, 56, 52, 58, 59, 54, …
$ sex       &lt;fct&gt; F, F, F, M, F, F, F, F, M, F, F, F, M, F, M, F, F, F, M, M, …
$ diabetes  &lt;fct&gt; No, No, Yes, No, No, No, Yes, Yes, No, No, No, No, No, No, Y…
$ nses      &lt;fct&gt; Low, Very Low, Very Low, Very Low, Very Low, Low, Very Low, …
$ bmi1      &lt;dbl&gt; 24.41, 50.50, 29.76, 41.83, 30.95, 33.01, 36.32, 30.76, 23.1…
$ sbp1      &lt;dbl&gt; 147, 134, 170, 118, 132, 110, 127, 152, 125, 161, 140, 136, …
$ insurance &lt;fct&gt; Medicaid, Medicaid, Medicaid, Medicaid, Medicaid, Medicaid, …
$ tobacco   &lt;fct&gt; never, never, current, quit, never, current, never, never, c…
$ statin    &lt;dbl&gt; 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 1, 0, 1, 0, …
$ diuretic  &lt;dbl&gt; 1, 1, 1, 1, 0, 1, 1, 1, 0, 1, 0, 1, 0, 1, 1, 1, 1, 1, 0, 1, …
$ sbp2      &lt;dbl&gt; 138, 134, 140, 143, 162, 141, 101, 154, 111, 154, 154, 138, …</code></pre>
</div>
</div>
<p><strong>Note</strong>: If you have more than 20 variables in your initial (raw) data set, prune it down to 20 as the first step before showing us the results of <code>glimpse</code> for your data.</p>
<p>This tibble describes twelve variables, including:</p>
<ul>
<li>a character variable called <code>subj_id</code> not to be used in our model except for identification of subjects,</li>
<li>our outcome (<code>sbp2</code>) and our key predictor (<code>sbp1</code>) that describe systolic blood pressure at two different times.</li>
<li>seven categorical candidate predictors, specifically <code>sex</code>, <code>diabetes</code>, <code>nses</code>, <code>insurance</code>, <code>tobacco</code>, <code>statin</code>, and <code>diuretic</code>, each specified here in R as either a factor or a 1/0 numeric variable (<code>statin</code> and <code>diuretic</code>),</li>
<li>three quantitative candidate predictors, specifically <code>age</code>, <code>bmi1</code> and <code>sbp1</code>.</li>
</ul>
</section>
<section id="which-variables-should-be-included-in-the-tidy-data-set" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="which-variables-should-be-included-in-the-tidy-data-set"><span class="header-section-number">2.3</span> Which variables should be included in the tidy data set?</h2>
<p>In fitting my models, I actually plan only to use five predictors: <code>sbp1</code>, <code>age</code>, <code>bmi1</code>, <code>diabetes</code> and <code>tobacco</code> to model my outcome: <code>sbp2</code>. Even though I’m not planning to use all of these predictors in my models, I’m going to build a tidy data set including all of them anyway, so I can demonstrate solutions to some problems you might have.</p>
<p>When you build your tidy data set in the next section, restrict it to the variables (outcomes, predictors and <code>subj_id</code>) that you will actually use in your modeling.</p>
<p>In building our tidy version of these data, we must:</p>
<ul>
<li>deal with the ordering of levels in the multi-categorical variables <code>nses</code>, <code>insurance</code> and <code>tobacco</code>,</li>
<li>change the name of <code>nses</code> to something more helpful - I’ll use <code>nbhd_ses</code> as the new name<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>.</li>
</ul>
</section>
<section id="checking-our-outcome-and-key-predictor" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="checking-our-outcome-and-key-predictor"><span class="header-section-number">2.4</span> Checking our Outcome and Key Predictor</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">df_stats</span>(<span class="sc">~</span> sbp2 <span class="sc">+</span> sbp1, <span class="at">data =</span> hbp_study)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  response min  Q1 median  Q3 max     mean       sd   n missing
1     sbp2  77 121    133 144 203 133.7427 17.93623 999       0
2     sbp1  81 124    136 147 205 136.5185 18.34717 999       0</code></pre>
</div>
</div>
<p>We have no missing values in our outcome or our key predictor, and each of the values look plausible, so we’ll move on.</p>
</section>
<section id="checking-the-quantitative-predictors" class="level2" data-number="2.5">
<h2 data-number="2.5" class="anchored" data-anchor-id="checking-the-quantitative-predictors"><span class="header-section-number">2.5</span> Checking the Quantitative Predictors</h2>
<p>Besides <code>sbp1</code> we have two other quantitative predictor candidates, <code>age</code> and <code>bmi1</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">df_stats</span>(<span class="sc">~</span> age <span class="sc">+</span> bmi1, <span class="at">data =</span> hbp_study)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  response   min     Q1 median     Q3   max     mean       sd   n missing
1      age 33.00 52.000 59.000 66.000 83.00 58.68669 10.47551 999       0
2     bmi1 16.72 27.865 32.145 38.365 74.65 33.72258  8.36090 994       5</code></pre>
</div>
</div>
<p>We know that all subjects in these data had to be between 33 and 83 years of age in order to be included, so we’re happy to see that they are. We have five missing values (appropriately specified with NA) and no implausible values in our BMI values (I would use 16-80 as a plausible range of BMI values for adults.) Things look OK for now, as we’ll deal with the missing values last.</p>
</section>
<section id="checking-the-categorical-variables" class="level2" data-number="2.6">
<h2 data-number="2.6" class="anchored" data-anchor-id="checking-the-categorical-variables"><span class="header-section-number">2.6</span> Checking the Categorical Variables</h2>
<p>For categorical variables, it’s always worth it to check to see whether the existing orders of the factor levels match the inherent order of the information, as well as whether there are any levels which we might want to collapse due to insufficient data, and whether there are any missing values.</p>
<section id="nses-home-neighborhoods-socio-economic-status" class="level3" data-number="2.6.1">
<h3 data-number="2.6.1" class="anchored" data-anchor-id="nses-home-neighborhoods-socio-economic-status"><span class="header-section-number">2.6.1</span> <code>nses</code>: home neighborhood’s socio-economic status</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>hbp_study <span class="sc">|&gt;</span> <span class="fu">tabyl</span>(nses)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     nses   n     percent valid_percent
     High 154 0.154154154     0.1553986
      Low 336 0.336336336     0.3390515
   Middle 281 0.281281281     0.2835520
 Very Low 220 0.220220220     0.2219980
     &lt;NA&gt;   8 0.008008008            NA</code></pre>
</div>
</div>
<ul>
<li>The order of <code>nses</code>, instead of the alphabetical (“High”, “Low”, “Middle”, “Very Low”), should go from “Very Low” to “Low” to “Middle” to “High”, or perhaps its reverse.</li>
<li>Let’s fix that using the <code>fct_relevel</code> function from the <code>forcats</code> package, which is part of the <code>tidyverse</code>. While we’re at it, we’ll rename the variable <code>nbhd_ses</code> which is more helpful to me.</li>
<li>Then we’ll see how many subjects fall in each category.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>hbp_study <span class="ot">&lt;-</span> hbp_study <span class="sc">|&gt;</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">nbhd_ses =</span> nses) <span class="sc">|&gt;</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">nbhd_ses =</span> <span class="fu">fct_relevel</span>(nbhd_ses, <span class="st">"Very Low"</span>, <span class="st">"Low"</span>, </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"Middle"</span>, <span class="st">"High"</span>))</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>hbp_study <span class="sc">|&gt;</span> <span class="fu">tabyl</span>(nbhd_ses)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> nbhd_ses   n     percent valid_percent
 Very Low 220 0.220220220     0.2219980
      Low 336 0.336336336     0.3390515
   Middle 281 0.281281281     0.2835520
     High 154 0.154154154     0.1553986
     &lt;NA&gt;   8 0.008008008            NA</code></pre>
</div>
</div>
<p>We have 8 missing values of <code>nbhd_ses</code>. We’ll deal with that later.</p>
</section>
<section id="tobacco-tobacco-use-history" class="level3" data-number="2.6.2">
<h3 data-number="2.6.2" class="anchored" data-anchor-id="tobacco-tobacco-use-history"><span class="header-section-number">2.6.2</span> <code>tobacco</code>: tobacco use history</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>hbp_study <span class="sc">|&gt;</span> <span class="fu">tabyl</span>(tobacco)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> tobacco   n    percent valid_percent
 current 295 0.29529530     0.3022541
   never 319 0.31931932     0.3268443
    quit 362 0.36236236     0.3709016
    &lt;NA&gt;  23 0.02302302            NA</code></pre>
</div>
</div>
<ul>
<li>For <code>tobacco</code>, instead of (“current”, “never”, “quit”), we want a new order: (“never”, “quit”, “current”).</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>hbp_study <span class="ot">&lt;-</span> hbp_study <span class="sc">|&gt;</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tobacco =</span> <span class="fu">fct_relevel</span>(tobacco, <span class="st">"never"</span>, <span class="st">"quit"</span>, </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"current"</span>))</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>hbp_study <span class="sc">|&gt;</span> <span class="fu">count</span>(tobacco)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 2
  tobacco     n
  &lt;fct&gt;   &lt;int&gt;
1 never     319
2 quit      362
3 current   295
4 &lt;NA&gt;       23</code></pre>
</div>
</div>
<p>We have 23 missing values of <code>tobacco</code>. Again, we’ll deal with that later.</p>
</section>
<section id="insurance-primary-insurance-type" class="level3" data-number="2.6.3">
<h3 data-number="2.6.3" class="anchored" data-anchor-id="insurance-primary-insurance-type"><span class="header-section-number">2.6.3</span> <code>insurance</code>: primary insurance type</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>hbp_study <span class="sc">|&gt;</span> <span class="fu">tabyl</span>(insurance)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> insurance   n    percent
  Medicaid 398 0.39839840
  Medicare 402 0.40240240
   Private 160 0.16016016
 Uninsured  39 0.03903904</code></pre>
</div>
</div>
<ul>
<li>For <code>insurance</code>, we’ll change the order to (“Medicare”, “Private”, “Medicaid”, “Uninsured”)</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>hbp_study <span class="ot">&lt;-</span> hbp_study <span class="sc">|&gt;</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">insurance =</span> <span class="fu">fct_relevel</span>(insurance, <span class="st">"Medicare"</span>, </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">"Private"</span>, <span class="st">"Medicaid"</span>, </span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">"Uninsured"</span>))</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>hbp_study <span class="sc">|&gt;</span> <span class="fu">tabyl</span>(insurance)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> insurance   n    percent
  Medicare 402 0.40240240
   Private 160 0.16016016
  Medicaid 398 0.39839840
 Uninsured  39 0.03903904</code></pre>
</div>
</div>
<p>Note that any levels left out of a <code>fct_relevel</code> statement get included in their current order, after whatever levels have been specified.</p>
</section>
<section id="what-about-the-subjects" class="level3" data-number="2.6.4">
<h3 data-number="2.6.4" class="anchored" data-anchor-id="what-about-the-subjects"><span class="header-section-number">2.6.4</span> What about the subjects?</h3>
<p>It is important to make sure that we have a unique (distinct) code (here, <code>subj_id</code>) for each row in the raw data set.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(hbp_study)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 999</code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">n_distinct</span>(hbp_study <span class="sc">|&gt;</span> <span class="fu">select</span>(subj_id))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 999</code></pre>
</div>
</div>
<p>OK, that’s fine.</p>
</section>
</section>
<section id="dealing-with-missingness" class="level2" data-number="2.7">
<h2 data-number="2.7" class="anchored" data-anchor-id="dealing-with-missingness"><span class="header-section-number">2.7</span> Dealing with Missingness</h2>
<p>Note that you will need to ensure that any <em>missing</em> values are appropriately specified using <code>NA</code>.</p>
<ul>
<li>In this data set, we’re all set on that issue.
<ul>
<li>There are missing data in <code>nses</code> (8 NA), <code>bmi1</code> (5 NA) and <code>tobacco</code> (23 NA).</li>
</ul></li>
<li><strong>Missing Outcomes</strong>. In building your tidy data set, delete any subjects with missing values of your outcome variable. I’d also probably drop any subjects missing the key predictor, too.
<ul>
<li>If we needed to delete the rows with missing values of an outcome, I would use code of the form <code>data_fixed &lt;- data_original |&gt; filter(complete.cases(outcomevariablename))</code> to accomplish that.</li>
<li>The elements (<code>sbp1</code> and <code>sbp2</code>) that form our outcome and key predictor have no missing values, though, so we’ll be OK in that regard.</li>
</ul></li>
</ul>
<p>In building the tidy data set, leave all missing values for candidate predictors as <code>NA</code>.</p>
<section id="assume-mcar-and-build-tibble-of-complete-cases" class="level3" data-number="2.7.1">
<h3 data-number="2.7.1" class="anchored" data-anchor-id="assume-mcar-and-build-tibble-of-complete-cases"><span class="header-section-number">2.7.1</span> Assume MCAR and Build Tibble of Complete Cases</h3>
<p>For your project, I expect a complete case analysis, where you drop all observations with missing data from your data set before creating your codebook. Let’s do that here.</p>
</section>
<section id="identifying-missing-data" class="level3" data-number="2.7.2">
<h3 data-number="2.7.2" class="anchored" data-anchor-id="identifying-missing-data"><span class="header-section-number">2.7.2</span> Identifying Missing Data</h3>
<p>There are 23 subjects missing <code>tobacco</code>, 8 missing <code>nbhd_ses</code> and 5 missing <code>bmi1</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">miss_var_summary</span>(hbp_study)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 3
   variable  n_miss pct_miss
   &lt;chr&gt;      &lt;int&gt;    &lt;num&gt;
 1 tobacco       23    2.30 
 2 nbhd_ses       8    0.801
 3 bmi1           5    0.501
 4 subj_id        0    0    
 5 age            0    0    
 6 sex            0    0    
 7 diabetes       0    0    
 8 sbp1           0    0    
 9 insurance      0    0    
10 statin         0    0    
11 diuretic       0    0    
12 sbp2           0    0    </code></pre>
</div>
</div>
<p>No subject is missing more than one variable, as we can tell from the table below, sorted by <code>n_miss</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">miss_case_summary</span>(hbp_study)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 999 × 3
    case n_miss pct_miss
   &lt;int&gt;  &lt;int&gt;    &lt;dbl&gt;
 1    10      1     8.33
 2    26      1     8.33
 3    31      1     8.33
 4    33      1     8.33
 5    42      1     8.33
 6    66      1     8.33
 7    67      1     8.33
 8    77      1     8.33
 9    85      1     8.33
10   161      1     8.33
# ℹ 989 more rows</code></pre>
</div>
</div>
<p>So we’ll lose 23 + 8 + 5 = 36 observations from our sample of 999 in dropping all cases with missing values, leaving us with a complete cases tibble of 963 rows.</p>
</section>
<section id="the-complete-cases-tibble" class="level3" data-number="2.7.3">
<h3 data-number="2.7.3" class="anchored" data-anchor-id="the-complete-cases-tibble"><span class="header-section-number">2.7.3</span> The Complete Cases Tibble</h3>
<p>My complete case data set would then be something like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>hbp_cc <span class="ot">&lt;-</span> hbp_study <span class="sc">|&gt;</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(subj_id, sbp2, sbp1, age, sex, </span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>         diabetes, nbhd_ses, bmi1, insurance, </span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>         tobacco, statin, diuretic) <span class="sc">|&gt;</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>()</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>hbp_cc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 963 × 12
   subj_id  sbp2  sbp1   age sex   diabetes nbhd_ses  bmi1 insurance tobacco
   &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;fct&gt; &lt;fct&gt;    &lt;fct&gt;    &lt;dbl&gt; &lt;fct&gt;     &lt;fct&gt;  
 1 A0001     138   147    58 F     No       Low       24.4 Medicaid  never  
 2 A0004     134   134    65 F     No       Very Low  50.5 Medicaid  never  
 3 A0005     140   170    61 F     Yes      Very Low  29.8 Medicaid  current
 4 A0013     143   118    51 M     No       Very Low  41.8 Medicaid  quit   
 5 A0015     162   132    61 F     No       Very Low  31.0 Medicaid  never  
 6 A0017     141   110    45 F     No       Low       33.0 Medicaid  current
 7 A0018     101   127    40 F     Yes      Very Low  36.3 Medicaid  never  
 8 A0019     154   152    50 F     Yes      Middle    30.8 Medicaid  never  
 9 A0020     111   125    43 M     No       Low       23.1 Medicaid  current
10 A0028     154   140    56 F     No       Low       36.5 Medicaid  quit   
# ℹ 953 more rows
# ℹ 2 more variables: statin &lt;dbl&gt;, diuretic &lt;dbl&gt;</code></pre>
</div>
</div>
<p>That’s fine for Project B.</p>
</section>
<section id="what-if-we-instead-did-imputation" class="level3" data-number="2.7.4">
<h3 data-number="2.7.4" class="anchored" data-anchor-id="what-if-we-instead-did-imputation"><span class="header-section-number">2.7.4</span> What if we instead did imputation?</h3>
<p>As an alternative (NOT expected in any way for Project B), we could use the <code>simputation</code> package to impute missing values of <code>tobacco</code>, <code>bmi1</code> and <code>nbhd_ses</code>. For each of these, we need to specify the approach we will use to do the imputation, and the variables we plan to use as predictors in our imputation model (the variables we plan to use to help predict the missing values). Some of these choices will be a little arbitrary, but I’m mostly demonstrating options here.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 11%">
<col style="width: 5%">
<col style="width: 17%">
<col style="width: 37%">
<col style="width: 27%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">Variable</th>
<th style="text-align: right;">NAs</th>
<th style="text-align: right;">Class</th>
<th>Imputation Approach</th>
<th>Imputation Model Predictors</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;"><code>nbhd_ses</code></td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">factor</td>
<td>CART (decision tree)</td>
<td><code>age</code>, <code>sex</code>, <code>insurance</code></td>
</tr>
<tr class="even">
<td style="text-align: right;"><code>tobacco</code></td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">factor</td>
<td>CART (decision tree)</td>
<td><code>age</code>, <code>sex</code>, <code>insurance</code>, <code>nbhd_ses</code></td>
</tr>
<tr class="odd">
<td style="text-align: right;"><code>bmi1</code></td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">numeric</td>
<td>Robust Linear Model</td>
<td><code>age</code>, <code>sex</code>, <code>diabetes</code>, <code>sbp1</code></td>
</tr>
</tbody>
</table>
<p>Here’s the actual set of imputation commands, to create an imputed data set named <code>hbp_imputed</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>hbp_imputed <span class="ot">&lt;-</span> hbp_study <span class="sc">|&gt;</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">impute_cart</span>(nbhd_ses <span class="sc">~</span> age <span class="sc">+</span> sex <span class="sc">+</span> insurance) <span class="sc">|&gt;</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">impute_cart</span>(tobacco <span class="sc">~</span> age <span class="sc">+</span> sex <span class="sc">+</span> insurance <span class="sc">+</span> nbhd_ses) <span class="sc">|&gt;</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">impute_rlm</span>(bmi1 <span class="sc">~</span> age <span class="sc">+</span> sex <span class="sc">+</span> diabetes <span class="sc">+</span> sbp1)</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(hbp_imputed)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   subj_id               age        sex     diabetes      nbhd_ses  
 Length:999         Min.   :33.00   F:655   No :668   Very Low:220  
 Class :character   1st Qu.:52.00   M:344   Yes:331   Low     :343  
 Mode  :character   Median :59.00                     Middle  :282  
                    Mean   :58.69                     High    :154  
                    3rd Qu.:66.00                                   
                    Max.   :83.00                                   
      bmi1            sbp1           insurance      tobacco        statin      
 Min.   :16.72   Min.   : 81.0   Medicare :402   never  :319   Min.   :0.0000  
 1st Qu.:27.91   1st Qu.:124.0   Private  :160   quit   :374   1st Qu.:0.0000  
 Median :32.18   Median :136.0   Medicaid :398   current:306   Median :1.0000  
 Mean   :33.74   Mean   :136.5   Uninsured: 39                 Mean   :0.5566  
 3rd Qu.:38.33   3rd Qu.:147.0                                 3rd Qu.:1.0000  
 Max.   :74.65   Max.   :205.0                                 Max.   :1.0000  
    diuretic           sbp2      
 Min.   :0.0000   Min.   : 77.0  
 1st Qu.:0.0000   1st Qu.:121.0  
 Median :1.0000   Median :133.0  
 Mean   :0.6657   Mean   :133.7  
 3rd Qu.:1.0000   3rd Qu.:144.0  
 Max.   :1.0000   Max.   :203.0  </code></pre>
</div>
</div>
<p>Note that I imputed <code>tobacco</code> after <code>nbhd_ses</code> largely because I wanted to use the <code>nbhd_ses</code> results to aid in my imputation of <code>tobacco</code>.</p>
</section>
</section>
</section>
<section id="codebook-and-data-description" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Codebook and Data Description</h1>
<section id="the-codebook" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="the-codebook"><span class="header-section-number">3.1</span> The Codebook</h2>
<p>The 12 variables in the <code>hbp_cc</code> tidy data set for this demonstration are as follows.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 14%">
<col style="width: 21%">
<col style="width: 63%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">Variable</th>
<th style="text-align: center;">Type</th>
<th>Description / Levels</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;"><code>subj_id</code></td>
<td style="text-align: center;">Character</td>
<td>subject code (A001-A999)</td>
</tr>
<tr class="even">
<td style="text-align: right;"><code>sbp2</code></td>
<td style="text-align: center;">Quantitative</td>
<td><strong>outcome</strong> variable, SBP after 18 months, in mm Hg</td>
</tr>
<tr class="odd">
<td style="text-align: right;"><code>sbp1</code></td>
<td style="text-align: center;">Quantitative</td>
<td><strong>key predictor</strong> baseline SBP (systolic blood pressure), in mm Hg</td>
</tr>
<tr class="even">
<td style="text-align: right;"><code>age</code></td>
<td style="text-align: center;">Quantitative</td>
<td>age of subject at baseline, in years</td>
</tr>
<tr class="odd">
<td style="text-align: right;"><code>sex</code></td>
<td style="text-align: center;">Binary</td>
<td>Male or Female</td>
</tr>
<tr class="even">
<td style="text-align: right;"><code>diabetes</code></td>
<td style="text-align: center;">Binary</td>
<td>Does subject have a diabetes diagnosis: No or Yes</td>
</tr>
<tr class="odd">
<td style="text-align: right;"><code>nbhd_ses</code></td>
<td style="text-align: center;">4 level Cat.</td>
<td>Socio-economic status of subject’s home neighborhood: Very Low, Low, Middle and High</td>
</tr>
<tr class="even">
<td style="text-align: right;"><code>bmi1</code></td>
<td style="text-align: center;">Quantitative</td>
<td>subject’s body-mass index at baseline</td>
</tr>
<tr class="odd">
<td style="text-align: right;"><code>insurance</code></td>
<td style="text-align: center;">4 level Cat.</td>
<td>subject’s insurance status at baseline: Medicare, Private, Medicaid, Uninsured</td>
</tr>
<tr class="even">
<td style="text-align: right;"><code>tobacco</code></td>
<td style="text-align: center;">3 level Cat.</td>
<td>subject’s tobacco use at baseline: never, quit (former), current</td>
</tr>
<tr class="odd">
<td style="text-align: right;"><code>statin</code></td>
<td style="text-align: center;">Binary</td>
<td>1 = statin prescription at baseline, else 0</td>
</tr>
<tr class="even">
<td style="text-align: right;"><code>diuretic</code></td>
<td style="text-align: center;">Binary</td>
<td>1 = diuretic prescription at baseline, else 0</td>
</tr>
</tbody>
</table>
<p><strong>Note</strong>: I’ve demonstrated this task for a larger set of predictors than I actually intend to use. In fitting my models, I actually plan only to use five predictors: <code>sbp1</code>, <code>age</code>, <code>bmi1</code>, <code>diabetes</code> and <code>tobacco</code> to model my outcome: <code>sbp2</code>.</p>
<p>For what follows, I’ll focus only on the variables I actually will use in the analyses.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>hbp_analytic <span class="ot">&lt;-</span> hbp_cc <span class="sc">|&gt;</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(subj_id, sbp2, sbp1, age, bmi1, diabetes, tobacco) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="analytic-tibble" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="analytic-tibble"><span class="header-section-number">3.2</span> Analytic Tibble</h2>
<p>First, we’ll provide a printout of the tibble, which will confirm that we have one.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>hbp_analytic</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 963 × 7
   subj_id  sbp2  sbp1   age  bmi1 diabetes tobacco
   &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;fct&gt;    &lt;fct&gt;  
 1 A0001     138   147    58  24.4 No       never  
 2 A0004     134   134    65  50.5 No       never  
 3 A0005     140   170    61  29.8 Yes      current
 4 A0013     143   118    51  41.8 No       quit   
 5 A0015     162   132    61  31.0 No       never  
 6 A0017     141   110    45  33.0 No       current
 7 A0018     101   127    40  36.3 Yes      never  
 8 A0019     154   152    50  30.8 Yes      never  
 9 A0020     111   125    43  23.1 No       current
10 A0028     154   140    56  36.5 No       quit   
# ℹ 953 more rows</code></pre>
</div>
</div>
<p>Since we’re using <code>df_print: paged</code> in our YAML, we need also to demonstrate that we have a tibble.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">is_tibble</span>(hbp_analytic)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
<p>OK. All set.</p>
</section>
<section id="numerical-data-description" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="numerical-data-description"><span class="header-section-number">3.3</span> Numerical Data Description</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">describe</span>(hbp_analytic <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="sc">-</span>subj_id)) <span class="sc">|&gt;</span> <span class="fu">html</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">

<style>
.earrows {color:silver;font-size:11px;}

fcap {
 font-family: Verdana;
 font-size: 12px;
 color: MidnightBlue
 }

smg {
 font-family: Verdana;
 font-size: 10px;
 color: 󅒐
}

hr.thinhr { margin-top: 0.15em; margin-bottom: 0.15em; }

span.xscript {
position: relative;
}
span.xscript sub {
position: absolute;
left: 0.1em;
bottom: -1ex;
}
</style>

<title>select(hbp_analytic, -subj_id) Descriptives</title>
<font color="MidnightBlue"><div align="center"><span style="font-weight:bold">select(hbp_analytic, -subj_id) <br><br> 6  Variables   963  Observations</span></div></font>
<hr class="thinhr">
<span style="font-weight:bold">sbp2</span><div style="float: right; text-align: right;"><img src="data:image/png;base64,
iVBORw0KGgoAAAANSUhEUgAAAJcAAAANCAMAAACTvAxuAAAACVBMVEUAAADMzMz////1iUV5AAAAjElEQVQ4je2TUQ6AMAhDi/c/tNlEYEqcCCZ+2MSsfsAeZAWVCajrRVhyAsQg22vom63/uQLFYK5uvsQlslwVgPEMMYiYQWXBjI/m4ejahn0lFhepbNdcUjEaA8pRzqUt5zgGzHBJMt7gikB5lJOZQ1xm4rT2hvpzg6u9/WPgOHVu4h6KTqb77W4GgPlWvU0Kcr28OJ8AAAAASUVORK5CYII=" alt="image"></div>
<style>
 .hmisctable958022 {
 border: none;
 font-size: 74%;
 }
 .hmisctable958022 td {
 text-align: center;
 padding: 0 1ex 0 1ex;
 }
 .hmisctable958022 th {
 color: MidnightBlue;
 text-align: center;
 padding: 0 1ex 0 1ex;
 font-weight: normal;
 }
 </style>
 <table data-quarto-disable-processing="true" class="hmisctable958022">
 <tbody><tr><th>n</th><th>missing</th><th>distinct</th><th>Info</th><th>Mean</th><th>pMedian</th><th>Gmd</th><th>.05</th><th>.10</th><th>.25</th><th>.50</th><th>.75</th><th>.90</th><th>.95</th></tr>
 <tr><td>963</td><td>0</td><td>95</td><td>1</td><td>133.8</td><td>133.5</td><td>20.1</td><td>106.0</td><td>111.0</td><td>121.0</td><td>133.0</td><td>144.0</td><td>156.0</td><td>165.8</td></tr>
 </tbody></table>

<span style="font-size: 85%;"><font color="MidnightBlue">lowest</font>&nbsp;:  77  90  91  94  95 ,  <font color="MidnightBlue">highest</font>: 186 190 196 200 203</span>
<hr class="thinhr">
<span style="font-weight:bold">sbp1</span><div style="float: right; text-align: right;"><img src="data:image/png;base64,
iVBORw0KGgoAAAANSUhEUgAAAJcAAAANCAMAAACTvAxuAAAACVBMVEUAAADMzMz////1iUV5AAAAlklEQVQ4je2TWQ6AIAxEh97/0CJLF0IiLUR/HEFoIvJaGKS4gPn8hEBxAfP5Cf1czn/vrAUx0Ndcsj/AXLm3yH6yw+X1CeTFQ5604Zg1fbmpGhG0enSuXm6uCjFwWcS3uPhuL6tfu3D1HlfJATmwzPHq1Pa5erJ2j5iItF+XKIulSut+Q3FXgvRtDa4Fe/lu9UktRIO5AM7GCsjcN97BAAAAAElFTkSuQmCC" alt="image"></div>
<style>
 .hmisctable538450 {
 border: none;
 font-size: 85%;
 }
 .hmisctable538450 td {
 text-align: center;
 padding: 0 1ex 0 1ex;
 }
 .hmisctable538450 th {
 color: MidnightBlue;
 text-align: center;
 padding: 0 1ex 0 1ex;
 font-weight: normal;
 }
 </style>
 <table data-quarto-disable-processing="true" class="hmisctable538450">
 <tbody><tr><th>n</th><th>missing</th><th>distinct</th><th>Info</th><th>Mean</th><th>pMedian</th><th>Gmd</th><th>.05</th><th>.10</th><th>.25</th><th>.50</th><th>.75</th><th>.90</th><th>.95</th></tr>
 <tr><td>963</td><td>0</td><td>100</td><td>1</td><td>136.5</td><td>136</td><td>20.43</td><td>108</td><td>115</td><td>124</td><td>136</td><td>147</td><td>160</td><td>168</td></tr>
 </tbody></table>

<span style="font-size: 85%;"><font color="MidnightBlue">lowest</font>&nbsp;:  81  83  91  92  93 ,  <font color="MidnightBlue">highest</font>: 198 201 202 203 205</span>
<hr class="thinhr">
<span style="font-weight:bold">age</span><div style="float: right; text-align: right;"><img src="data:image/png;base64,
iVBORw0KGgoAAAANSUhEUgAAAJcAAAANCAMAAACTvAxuAAAACVBMVEUAAADMzMz////1iUV5AAAAjklEQVQ4jbXTiwqAIAwF0Ln//+hQUNacj3ZvMaiEbsfHpDAvEVqSMi+hxf3hYujwiGGxhacingZwIuNCiKhLJHLZNUymI73Xqt9t2bdcm36bz2JttmP62nIbtf3TWdIfwoN0dkXD6lt3Ui5chjMmTHQ53ZWrf65+2+iuaBknF57KddWzX2vRTbnhZEIZVR4QVgnRK4YMTgAAAABJRU5ErkJggg==" alt="image"></div>
<style>
 .hmisctable291870 {
 border: none;
 font-size: 85%;
 }
 .hmisctable291870 td {
 text-align: center;
 padding: 0 1ex 0 1ex;
 }
 .hmisctable291870 th {
 color: MidnightBlue;
 text-align: center;
 padding: 0 1ex 0 1ex;
 font-weight: normal;
 }
 </style>
 <table data-quarto-disable-processing="true" class="hmisctable291870">
 <tbody><tr><th>n</th><th>missing</th><th>distinct</th><th>Info</th><th>Mean</th><th>pMedian</th><th>Gmd</th><th>.05</th><th>.10</th><th>.25</th><th>.50</th><th>.75</th><th>.90</th><th>.95</th></tr>
 <tr><td>963</td><td>0</td><td>51</td><td>0.999</td><td>58.75</td><td>58.5</td><td>11.97</td><td>40.1</td><td>45.0</td><td>52.0</td><td>59.0</td><td>66.0</td><td>74.0</td><td>76.0</td></tr>
 </tbody></table>

<span style="font-size: 85%;"><font color="MidnightBlue">lowest</font>&nbsp;: 33 34 35 36 37 ,  <font color="MidnightBlue">highest</font>: 79 80 81 82 83</span>
<hr class="thinhr">
<span style="font-weight:bold">bmi1</span><div style="float: right; text-align: right;"><img src="data:image/png;base64,
iVBORw0KGgoAAAANSUhEUgAAAJcAAAANCAMAAACTvAxuAAAACVBMVEUAAADMzMz////1iUV5AAAAnklEQVQ4jc2TUQ7AIAhDq/c/9ERFZiIEMyXrMj6mk5dKkRwCPLuOCtkWwCVWZsfCA2LqJYqptjYXK1fVj7gqDiblMDylS7+9pQbcTUQlaZRAjQu0wpvi8siDrmKJaRcNW3LZSBIEYbzMZY2V6d1x995n7ROJdXl27nN0+Vc4r8/FOcqg3uei2W/Z0wO4qfm0HmxKLz2pNUztyzqL5X0A/isKHBh5tRUAAAAASUVORK5CYII=" alt="image"></div>
<style>
 .hmisctable591004 {
 border: none;
 font-size: 74%;
 }
 .hmisctable591004 td {
 text-align: center;
 padding: 0 1ex 0 1ex;
 }
 .hmisctable591004 th {
 color: MidnightBlue;
 text-align: center;
 padding: 0 1ex 0 1ex;
 font-weight: normal;
 }
 </style>
 <table data-quarto-disable-processing="true" class="hmisctable591004">
 <tbody><tr><th>n</th><th>missing</th><th>distinct</th><th>Info</th><th>Mean</th><th>pMedian</th><th>Gmd</th><th>.05</th><th>.10</th><th>.25</th><th>.50</th><th>.75</th><th>.90</th><th>.95</th></tr>
 <tr><td>963</td><td>0</td><td>807</td><td>1</td><td>33.68</td><td>32.98</td><td>9.065</td><td>22.76</td><td>24.51</td><td>27.91</td><td>32.13</td><td>38.30</td><td>44.86</td><td>49.88</td></tr>
 </tbody></table>

<span style="font-size: 85%;"><font color="MidnightBlue">lowest</font>&nbsp;: 16.72 17.79 18    18.44 18.54 ,  <font color="MidnightBlue">highest</font>: 64.3  65.43 65.46 65.95 74.65</span>
<hr class="thinhr">
<span style="font-weight:bold">diabetes</span>
<style>
 .hmisctable554108 {
 border: none;
 font-size: 85%;
 }
 .hmisctable554108 td {
 text-align: center;
 padding: 0 1ex 0 1ex;
 }
 .hmisctable554108 th {
 color: MidnightBlue;
 text-align: center;
 padding: 0 1ex 0 1ex;
 font-weight: normal;
 }
 </style>
 <table data-quarto-disable-processing="true" class="hmisctable554108">
 <tbody><tr><th>n</th><th>missing</th><th>distinct</th></tr>
 <tr><td>963</td><td>0</td><td>2</td></tr>
 </tbody></table>

<pre style="font-size:85%;"> Value         No   Yes
 Frequency    644   319
 Proportion 0.669 0.331 </pre>

<hr class="thinhr">
<span style="font-weight:bold">tobacco</span><div style="float: right; text-align: right;"><img src="data:image/png;base64,
iVBORw0KGgoAAAANSUhEUgAAAAoAAAANCAMAAACn6Q83AAAACVBMVEUAAADMzMz////1iUV5AAAAJElEQVQImWNgZGRkYGBkBFNMTCDMBKHATAYGIphQE4hSS8AEACRTAHtP1z70AAAAAElFTkSuQmCC" alt="image"></div>
<style>
 .hmisctable444312 {
 border: none;
 font-size: 85%;
 }
 .hmisctable444312 td {
 text-align: center;
 padding: 0 1ex 0 1ex;
 }
 .hmisctable444312 th {
 color: MidnightBlue;
 text-align: center;
 padding: 0 1ex 0 1ex;
 font-weight: normal;
 }
 </style>
 <table data-quarto-disable-processing="true" class="hmisctable444312">
 <tbody><tr><th>n</th><th>missing</th><th>distinct</th></tr>
 <tr><td>963</td><td>0</td><td>3</td></tr>
 </tbody></table>

<pre style="font-size:85%;"> Value        never    quit current
 Frequency      316     356     291
 Proportion   0.328   0.370   0.302 </pre>

<hr class="thinhr">
</div>
</div>
<p>We should (and do) see no missing or implausible values here, and our categorical variables are treated as factors with a rational ordering for the levels.</p>
</section>
</section>
<section id="my-research-question" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> My Research Question</h1>
<p>Here you should provide background information on the study, and the subjects, so that we understand what you’re talking about in your research question. I’ll skip that in the demo, because I’ve done it already in introducing the data set, but you’ll need that here.</p>
<p>A natural research question here would be something like:</p>
<blockquote class="blockquote">
<p>How effectively can we predict systolic BP 18 months after baseline using baseline systolic BP, and is the quality of prediction meaningfully improved when I adjust for four other predictors (baseline age, body-mass index, diabetes diagnosis and tobacco use) in the <code>hbp_study</code> data?</p>
</blockquote>
<p>Please don’t feel obliged to follow this format precisely in stating your question.</p>
</section>
<section id="partitioning-the-data" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Partitioning the Data</h1>
<p>Here, we will obtain a training sample with a randomly selected 70% of the data (after imputing), and have the remaining 30% in a test sample, properly labeled, and using <code>set.seed</code> so that the results can be replicated later.</p>
<p>I will call the training sample <code>hbp_training</code> and the test sample <code>hbp_test</code>.</p>
<ul>
<li>The <code>slice_sample</code> function will sample the specified proportion of the data.</li>
<li>Your training sample should contain a randomly selected 60-80% of your data.</li>
<li>The <code>anti_join</code> function returns all rows in the first data frame (here specified as <code>hbp_analytic</code>) that are not in the second data frame (here specified as <code>hbp_training</code>) as assessed by the row-specific identification code (here <code>subj_id</code>)).</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">431</span>) <span class="co"># set your own seed, don't use this one</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>hbp_training <span class="ot">&lt;-</span> hbp_analytic <span class="sc">|&gt;</span> <span class="fu">slice_sample</span>(<span class="at">prop =</span> .<span class="dv">70</span>)</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>hbp_test <span class="ot">&lt;-</span> <span class="fu">anti_join</span>(hbp_analytic, hbp_training, <span class="at">by =</span> <span class="st">"subj_id"</span>)</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(hbp_analytic) <span class="co"># number of rows and columns in hbp_analytic</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 963   7</code></pre>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(hbp_training) <span class="co"># check to be sure we have 70% of hbp_analytic here</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 674   7</code></pre>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(hbp_test) <span class="co"># check to be sure we have the rest of hbp_analytic here</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 289   7</code></pre>
</div>
</div>
<p>Since 674 + 289 = 963, we should be OK.</p>
</section>
<section id="transforming-the-outcome" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Transforming the Outcome</h1>
<section id="visualizing-the-outcome-distribution" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="visualizing-the-outcome-distribution"><span class="header-section-number">6.1</span> Visualizing the Outcome Distribution</h2>
<p>I see at least three potential graphs to use to describe the distribution of our outcome variable, <code>sbp2</code>. Again, remember we’re using only the <strong>training</strong> sample here.</p>
<ul>
<li>A boxplot, probably accompanied by a violin plot to show the shape of the distribution more honestly.</li>
<li>A histogram, which could perhaps be presented as a density plot with a Normal distribution superimposed.</li>
<li>A Normal Q-Q plot to directly assess Normality.</li>
</ul>
<p>I expect you to show at least two of these three, but I will display all three here. Should we see substantial skew in the outcome data, we will want to consider an appropriate transformation, and then display the results of that transformation, as well.</p>
<p><strong>WARNING</strong>: Please note that I am deliberately showing you plots that are less finished than I hope you will provide.</p>
<ul>
<li>The coloring is dull or non-existent.</li>
<li>The theme is the default gray and white grid that lots of people dislike.</li>
<li>There are no meaningful titles or subtitles.</li>
<li>The axis labels select the default settings, and use incomprehensible variable names.</li>
<li>The coordinates aren’t flipped when that might be appropriate.</li>
<li>I expect a much nicer presentation in your final work. Use the class slides and Lab answer sketches as a model for better plotting.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>viz1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(hbp_training, <span class="fu">aes</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> sbp2)) <span class="sc">+</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_violin</span>() <span class="sc">+</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">width =</span> <span class="fl">0.25</span>)</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>viz2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(hbp_training, <span class="fu">aes</span>(<span class="at">x =</span> sbp2)) <span class="sc">+</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">30</span>, <span class="at">col =</span> <span class="st">"white"</span>)</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>viz3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(hbp_training, <span class="fu">aes</span>(<span class="at">sample =</span> sbp2)) <span class="sc">+</span></span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_qq</span>() <span class="sc">+</span> <span class="fu">geom_qq_line</span>()</span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>viz1 <span class="sc">+</span> viz2 <span class="sc">+</span> viz3 <span class="sc">+</span></span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(<span class="at">title =</span> <span class="st">"Less-Than-Great Plots of My Outcome's Distribution"</span>,</span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>                  <span class="at">subtitle =</span> <span class="st">"complete with a rotten title, default axis labels and bad captions"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="sample-study2_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Later, we’ll augment this initial look at the outcome data with a Box-Cox plot to suggest a potential transformation. Should you decide to make such a transformation, remember to return here to plot the results for your new and transformed outcome.</p>
</section>
<section id="numerical-summary-of-the-outcome" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="numerical-summary-of-the-outcome"><span class="header-section-number">6.2</span> Numerical Summary of the Outcome</h2>
<p>Assuming you plan no transformation of the outcome (and in our case, I am happy that the outcome data appear reasonably well-modeled by the Normal distribution) then you should just summarize the training data, with your favorite tool for that task. That might be:</p>
<ul>
<li><code>favstats</code> from the <code>mosaic</code> package, as shown below, or</li>
<li><code>describe</code> from the <code>Hmisc</code> package, or</li>
<li>something else, I guess.</li>
</ul>
<p>But show <strong>ONE</strong> of these choices, and not all of them. Make a decision and go with it!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">favstats</span>(<span class="sc">~</span> sbp2, <span class="at">data =</span> hbp_training)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> min  Q1 median  Q3 max     mean       sd   n missing
  90 122    134 144 203 133.9852 17.83888 674       0</code></pre>
</div>
</div>
</section>
<section id="numerical-summaries-of-the-predictors" class="level2" data-number="6.3">
<h2 data-number="6.3" class="anchored" data-anchor-id="numerical-summaries-of-the-predictors"><span class="header-section-number">6.3</span> Numerical Summaries of the Predictors</h2>
<p>We also need an appropriate set of numerical summaries of each predictor variable, in the training data. I see at least two potential options here:</p>
<ol type="1">
<li>Use <code>inspect</code> from the <code>mosaic</code> package to describe the predictors of interest briefly.</li>
<li>Use <code>describe</code> from the <code>Hmisc</code> package for a more detailed description of the entire data set.</li>
</ol>
<p>Again, <strong>DO NOT</strong> do all of these. Pick one that works for you. I’m just demonstrating possible choices here.</p>
<section id="using-the-inspect-function-from-mosaic" class="level3" data-number="6.3.1">
<h3 data-number="6.3.1" class="anchored" data-anchor-id="using-the-inspect-function-from-mosaic"><span class="header-section-number">6.3.1</span> Using the <code>inspect</code> function from <code>mosaic</code></h3>
<p>The <code>inspect</code> function provides a way to get results like <code>favstats</code>, but for an entire data frame.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>hbp_training <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="sc">-</span>subj_id, <span class="sc">-</span>sbp2) <span class="sc">|&gt;</span> </span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inspect</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
categorical variables:  
      name  class levels   n missing
1 diabetes factor      2 674       0
2  tobacco factor      3 674       0
                                   distribution
1 No (69%), Yes (31%)                          
2 quit (38.4%), never (32.9%) ...              

quantitative variables:  
  name   class   min     Q1  median      Q3    max      mean        sd   n
1 sbp1 numeric 91.00 124.00 135.000 146.000 205.00 136.02226 18.059200 674
2  age numeric 33.00  52.00  59.000  66.000  82.00  58.70030 10.836723 674
3 bmi1 numeric 16.72  27.69  31.915  38.365  74.65  33.57628  8.318113 674
  missing
1       0
2       0
3       0</code></pre>
</div>
</div>
<p>Next, we will build and interpret a scatterplot matrix to describe the associations (both numerically and graphically) between the outcome and all predictors.</p>
<ul>
<li>We’ll also use a Box-Cox plot to investigate whether a transformation of our outcome is suggested, and</li>
<li>describe what a correlation matrix suggests about collinearity between candidate predictors.</li>
</ul>
</section>
</section>
<section id="scatterplot-matrix" class="level2" data-number="6.4">
<h2 data-number="6.4" class="anchored" data-anchor-id="scatterplot-matrix"><span class="header-section-number">6.4</span> Scatterplot Matrix</h2>
<p>Here, we will build a scatterplot matrix (or two) to show the relationship between our outcome and the predictors. I’ll demonstrate the use of <code>ggpairs</code> from the <code>GGally</code> package.</p>
<ul>
<li>If you have more than five predictors (as we do in our case) you should build two scatterplot matrices, each ending with the outcome. Anything more than one outcome and five predictors becomes unreadable in Professor Love’s view.</li>
<li>If you have a multi-categorical predictor with more than four categories, that predictor will be very difficult to see and explore in the scatterplot matrix produced.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> hbp_training <span class="sc">|&gt;</span> </span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(sbp1, age, bmi1, diabetes, tobacco, sbp2) </span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggpairs</span>(temp, <span class="at">title =</span> <span class="st">"Scatterplot Matrix"</span>,</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">lower =</span> <span class="fu">list</span>(<span class="at">combo =</span> <span class="fu">wrap</span>(<span class="st">"facethist"</span>, <span class="at">bins =</span> <span class="dv">20</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="sample-study2_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>At the end of this section, you should provide some discussion of the distribution of any key predictors, and their relationship to the outcome (all of that is provided in the bottom row if you place the outcome last, as you should, in selecting variables for the plot.)</p>
<p><strong>HINT</strong>: For categorical variables, your efforts in this regard to summarize the relationships you see may be challenging. Your comments would be aided by the judicious use of numerical summaries. For example, suppose you want to study the relationship between tobacco use and <code>sbp2</code>, then you probably want to run and discuss the following results, in addition to the scatterplot matrix above.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">favstats</span>(sbp2 <span class="sc">~</span> tobacco, <span class="at">data =</span> hbp_training)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  tobacco min  Q1 median     Q3 max     mean       sd   n missing
1   never  95 126    135 145.75 180 135.5405 17.02980 222       0
2    quit  91 120    132 142.00 182 132.3359 16.62022 259       0
3 current  90 120    135 147.00 203 134.4093 20.09465 193       0</code></pre>
</div>
</div>
</section>
<section id="collinearity-checking" class="level2" data-number="6.5">
<h2 data-number="6.5" class="anchored" data-anchor-id="collinearity-checking"><span class="header-section-number">6.5</span> Collinearity Checking</h2>
<p>Next, we’ll take a brief look at potential collinearity. Remember that we want to see strong correlations between our <strong>outcome</strong> and the predictors, but relatively modest correlations between the predictors.</p>
<p>None of the numeric candidate predictors show any substantial correlation with each other. The largest Pearson correlation (in absolute value) between predictors is (-0.239) for <code>age</code> and <code>bmi1</code>, and that’s not strong. If we did see signs of meaningful collinearity, we might rethink our selected set of predictors.</p>
<p>I’ll recommend later that you run a generalized VIF (variance inflation factor) calculation<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> after fitting your kitchen sink model just to see if anything pops up (in my case, it won’t.)</p>
</section>
<section id="boxcox-function-to-assess-need-for-transformation-of-our-outcome" class="level2" data-number="6.6">
<h2 data-number="6.6" class="anchored" data-anchor-id="boxcox-function-to-assess-need-for-transformation-of-our-outcome"><span class="header-section-number">6.6</span> <code>boxCox</code> function to assess need for transformation of our outcome</h2>
<p>To use the <code>boxCox</code> approach here, we need to ensure that the distribution of our outcome, <code>sbp2</code>, includes strictly positive values. We can see from our numerical summary earlier that the minimum <code>sbp2</code> in our <code>hbp_training</code> sample is 90, so we’re OK.</p>
<ul>
<li>Note that I am restricting myself here to the five predictors I actually intend to use in building models.</li>
<li>Although we’re generally using a 90% confidence interval in this project, we won’t worry about that issue in the <code>boxCox</code> plot, and instead just look at the point estimate from <code>powerTransform</code>.</li>
<li>These commands (<code>boxCox</code> and <code>powerTransform</code>) come from the <code>car</code> package.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>model_temp <span class="ot">&lt;-</span> <span class="fu">lm</span>(sbp2 <span class="sc">~</span> sbp1 <span class="sc">+</span> age <span class="sc">+</span> bmi1 <span class="sc">+</span> diabetes <span class="sc">+</span> tobacco,</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data =</span> hbp_training)</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a><span class="fu">boxCox</span>(model_temp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="sample-study2_files/figure-html/boxCox_plot-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">powerTransform</span>(model_temp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Estimated transformation parameter 
       Y1 
0.4913275 </code></pre>
</div>
</div>
<p>The estimated power transformation is about 0.5, which looks like a square root transformation of <code>sbp2</code> is useful. Given that I’m using another measure of <code>sbp</code>, specifically, <code>sbp1</code> to predict <code>sbp2</code>, perhaps I want to transform that, too?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(hbp_training, <span class="fu">aes</span>(<span class="at">x =</span> sbp1, <span class="at">y =</span> <span class="fu">sqrt</span>(sbp2))) <span class="sc">+</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"loess"</span>, <span class="at">formula =</span> y <span class="sc">~</span> x, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> </span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">formula =</span> y <span class="sc">~</span> x, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"SQRT(sbp2) vs. SBP1"</span>)</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(hbp_training, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">sqrt</span>(sbp1), <span class="at">y =</span> <span class="fu">sqrt</span>(sbp2))) <span class="sc">+</span></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"loess"</span>, <span class="at">formula =</span> y <span class="sc">~</span> x, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> </span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">formula =</span> y <span class="sc">~</span> x, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> </span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"SQRT(sbp2) vs. SQRT(sbp1)"</span>)</span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="sample-study2_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>I don’t see an especially large difference between these two plots. It is up to you to decide whether a transformation suggested by <code>boxCox</code> should be applied to your data.</p>
<ul>
<li>For the purposes of this project, you should stick to transformations of strictly positive outcomes, and to the square root (power = 0.5), square (power = 2), logarithm (power = 0) and inverse (power = -1) transformations. Don’t make the transformation without being able to interpret the result well.</li>
<li>If you do decide to include a transformation of your outcome in fitting models, be sure to back-transform any predictions you make at the end of the study so that we can understand the prediction error results.</li>
<li>If your outcome data are substantially multimodal, I wouldn’t treat the <code>boxCox</code> results as meaningful.</li>
</ul>
<p>I’m going to use the square root transformation for both my outcome and for the key predictor, but I don’t think it makes a big difference. I’m doing it mostly so that I can show you how to back-transform later.</p>
</section>
</section>
<section id="the-big-model" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> The Big Model</h1>
<p>We will specify a “kitchen sink” linear regression model to describe the relationship between our outcome (potentially after transformation) and the main effects of each of our predictors. We’ll need to:</p>
<ul>
<li>We’ll assess the overall effectiveness, within your training sample, of your model, by specifying and interpreting the R<sup>2</sup>, adjusted R<sup>2</sup> (especially in light of our collinearity conclusions, below), the residual standard error, and the ANOVA F test.</li>
<li>We’ll need to specify the size, magnitude and meaning of all coefficients, and identify appropriate conclusions regarding effect sizes with 90% confidence intervals.</li>
<li>Finally, we’ll assess whether collinearity in the kitchen sink model has a meaningful impact, and describe how we know that.</li>
</ul>
<section id="fittingsummarizing-the-kitchen-sink-model" class="level2" data-number="7.1">
<h2 data-number="7.1" class="anchored" data-anchor-id="fittingsummarizing-the-kitchen-sink-model"><span class="header-section-number">7.1</span> Fitting/Summarizing the Kitchen Sink model</h2>
<p>Our “kitchen sink” or “big” model predicts the square root of <code>sbp2</code> using the predictors (square root of <code>sbp1</code>), <code>age</code>, <code>bmi1</code>, <code>diabetes</code> and <code>tobacco</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>model_big <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">sqrt</span>(sbp2) <span class="sc">~</span> <span class="fu">sqrt</span>(sbp1) <span class="sc">+</span> age <span class="sc">+</span> bmi1 <span class="sc">+</span> diabetes <span class="sc">+</span> tobacco, </span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> hbp_training)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_big)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = sqrt(sbp2) ~ sqrt(sbp1) + age + bmi1 + diabetes + 
    tobacco, data = hbp_training)

Residuals:
     Min       1Q   Median       3Q      Max 
-2.13388 -0.45071 -0.00603  0.45391  2.28459 

Coefficients:
                Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)     6.917075   0.466656  14.823   &lt;2e-16 ***
sqrt(sbp1)      0.367990   0.036014  10.218   &lt;2e-16 ***
age             0.004754   0.002731   1.741   0.0822 .  
bmi1            0.002874   0.003571   0.805   0.4211    
diabetesYes     0.052141   0.060626   0.860   0.3901    
tobaccoquit    -0.119091   0.065962  -1.805   0.0715 .  
tobaccocurrent  0.014155   0.073194   0.193   0.8467    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.7136 on 667 degrees of freedom
Multiple R-squared:  0.1478,    Adjusted R-squared:  0.1402 
F-statistic: 19.29 on 6 and 667 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
</section>
<section id="effect-sizes-coefficient-estimates" class="level2" data-number="7.2">
<h2 data-number="7.2" class="anchored" data-anchor-id="effect-sizes-coefficient-estimates"><span class="header-section-number">7.2</span> Effect Sizes: Coefficient Estimates</h2>
<p>Specify the size and magnitude of all coefficients, providing estimated effect sizes with 90% confidence intervals.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(model_big, <span class="at">conf.int =</span> <span class="cn">TRUE</span>, <span class="at">conf.level =</span> <span class="fl">0.90</span>) <span class="sc">|&gt;</span> </span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(term, estimate, std.error, conf.low, conf.high, p.value) <span class="sc">|&gt;</span> </span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">dig =</span> <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">term</th>
<th style="text-align: right;">estimate</th>
<th style="text-align: right;">std.error</th>
<th style="text-align: right;">conf.low</th>
<th style="text-align: right;">conf.high</th>
<th style="text-align: right;">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">6.9171</td>
<td style="text-align: right;">0.4667</td>
<td style="text-align: right;">6.1484</td>
<td style="text-align: right;">7.6857</td>
<td style="text-align: right;">0.0000</td>
</tr>
<tr class="even">
<td style="text-align: left;">sqrt(sbp1)</td>
<td style="text-align: right;">0.3680</td>
<td style="text-align: right;">0.0360</td>
<td style="text-align: right;">0.3087</td>
<td style="text-align: right;">0.4273</td>
<td style="text-align: right;">0.0000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">age</td>
<td style="text-align: right;">0.0048</td>
<td style="text-align: right;">0.0027</td>
<td style="text-align: right;">0.0003</td>
<td style="text-align: right;">0.0093</td>
<td style="text-align: right;">0.0822</td>
</tr>
<tr class="even">
<td style="text-align: left;">bmi1</td>
<td style="text-align: right;">0.0029</td>
<td style="text-align: right;">0.0036</td>
<td style="text-align: right;">-0.0030</td>
<td style="text-align: right;">0.0088</td>
<td style="text-align: right;">0.4211</td>
</tr>
<tr class="odd">
<td style="text-align: left;">diabetesYes</td>
<td style="text-align: right;">0.0521</td>
<td style="text-align: right;">0.0606</td>
<td style="text-align: right;">-0.0477</td>
<td style="text-align: right;">0.1520</td>
<td style="text-align: right;">0.3901</td>
</tr>
<tr class="even">
<td style="text-align: left;">tobaccoquit</td>
<td style="text-align: right;">-0.1191</td>
<td style="text-align: right;">0.0660</td>
<td style="text-align: right;">-0.2277</td>
<td style="text-align: right;">-0.0104</td>
<td style="text-align: right;">0.0715</td>
</tr>
<tr class="odd">
<td style="text-align: left;">tobaccocurrent</td>
<td style="text-align: right;">0.0142</td>
<td style="text-align: right;">0.0732</td>
<td style="text-align: right;">-0.1064</td>
<td style="text-align: right;">0.1347</td>
<td style="text-align: right;">0.8467</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>I wanted to get at least two significant figures in my coefficient and standard error estimates for all of the predictors in this model, so that’s why I had to go out to 4 decimal places.</p>
</section>
<section id="describing-the-equation" class="level2" data-number="7.3">
<h2 data-number="7.3" class="anchored" data-anchor-id="describing-the-equation"><span class="header-section-number">7.3</span> Describing the Equation</h2>
<p>This model implies for the key predictor that:</p>
<ul>
<li>for every increase of one point in the square root of <code>sbp1</code>, we anticipate an increase in the outcome (square root of sbp2) of 0.37 mm Hg (90% confidence interval: 0.31, 0.43). If we had two subjects with the same values of all other variables, but A had a baseline square root of SBP of 12 (so an SBP at baseline of 144) and B had a baseline square root of SBP of 11 (so an SBP at baseline of 121) then if all other variables are kept at the same value, our model predicts that the square root of subject A’s SBP at 18 months will be 0.37 points higher (90% CI: 0.31, 0.43) than that of subject B.</li>
</ul>
<p>You should provide a (briefer) description of the meaning (especially the direction) of the other coefficients in your model being sure only to interpret the coefficients as having meaning <em>holding all other predictors constant</em>, but I’ll skip that in the demo.</p>
</section>
</section>
<section id="the-smaller-model" class="level1" data-number="8">
<h1 data-number="8"><span class="header-section-number">8</span> The Smaller Model</h1>
<p>Here, we will build a second linear regression model using a subset of our “kitchen sink” model predictors, chosen to maximize predictive value within our training sample.</p>
<ul>
<li>We’ll specify the method you used to obtain this new model. (Backwards stepwise elimination is appealing but not great. It’s perfectly fine to just include the key predictor as the subset for this new model.)</li>
</ul>
<section id="backwards-stepwise-elimination" class="level2" data-number="8.1">
<h2 data-number="8.1" class="anchored" data-anchor-id="backwards-stepwise-elimination"><span class="header-section-number">8.1</span> Backwards Stepwise Elimination</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">step</span>(model_big)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Start:  AIC=-447.95
sqrt(sbp2) ~ sqrt(sbp1) + age + bmi1 + diabetes + tobacco

             Df Sum of Sq    RSS     AIC
- bmi1        1     0.330 339.96 -449.30
- diabetes    1     0.377 340.00 -449.20
&lt;none&gt;                    339.63 -447.95
- tobacco     2     2.406 342.03 -447.19
- age         1     1.543 341.17 -446.89
- sqrt(sbp1)  1    53.163 392.79 -351.93

Step:  AIC=-449.3
sqrt(sbp2) ~ sqrt(sbp1) + age + diabetes + tobacco

             Df Sum of Sq    RSS     AIC
- diabetes    1     0.521 340.48 -450.26
&lt;none&gt;                    339.96 -449.30
- age         1     1.267 341.22 -448.79
- tobacco     2     2.344 342.30 -448.66
- sqrt(sbp1)  1    54.053 394.01 -351.84

Step:  AIC=-450.26
sqrt(sbp2) ~ sqrt(sbp1) + age + tobacco

             Df Sum of Sq    RSS     AIC
&lt;none&gt;                    340.48 -450.26
- tobacco     2     2.191 342.67 -449.94
- age         1     1.238 341.71 -449.82
- sqrt(sbp1)  1    53.805 394.28 -353.37</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = sqrt(sbp2) ~ sqrt(sbp1) + age + tobacco, data = hbp_training)

Coefficients:
   (Intercept)      sqrt(sbp1)             age     tobaccoquit  tobaccocurrent  
      7.062241        0.369099        0.004084       -0.121333       -0.004054  </code></pre>
</div>
</div>
<p>The backwards selection stepwise approach suggests a model with <code>sqrt(sbp1)</code> and age and tobacco, but not <code>bmi1</code> or <code>diabetes</code>.</p>
<ol type="1">
<li>If stepwise regression retains the kitchen sink model or if you don’t want to use stepwise regression, develop an alternate model by selecting a subset of the Big model predictors (including the key predictor) on your own. A simple regression on the key predictor is a perfectly reasonable choice.</li>
<li>If stepwise regression throws out the key predictor in your kitchen sink model, then I suggest not using stepwise regression.</li>
<li>We will learn several other methods for variable selection in 432. If you want to use one of them (for instance, a C_p_ plot) here, that’s OK, but I will hold you to high expectations for getting that done correctly, and it’s worth remembering that none of them work very well at identifying the “best” model.</li>
</ol>
</section>
<section id="fitting-the-small-model" class="level2" data-number="8.2">
<h2 data-number="8.2" class="anchored" data-anchor-id="fitting-the-small-model"><span class="header-section-number">8.2</span> Fitting the “small” model</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>model_small <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">sqrt</span>(sbp2) <span class="sc">~</span> <span class="fu">sqrt</span>(sbp1) <span class="sc">+</span> age <span class="sc">+</span> tobacco, <span class="at">data =</span> hbp_training)</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_small)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = sqrt(sbp2) ~ sqrt(sbp1) + age + tobacco, data = hbp_training)

Residuals:
     Min       1Q   Median       3Q      Max 
-2.15438 -0.46050  0.00618  0.45691  2.26418 

Coefficients:
                Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)     7.062241   0.444201  15.899   &lt;2e-16 ***
sqrt(sbp1)      0.369099   0.035897  10.282   &lt;2e-16 ***
age             0.004084   0.002618   1.560    0.119    
tobaccoquit    -0.121333   0.065641  -1.848    0.065 .  
tobaccocurrent -0.004054   0.071059  -0.057    0.955    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.7134 on 669 degrees of freedom
Multiple R-squared:  0.1457,    Adjusted R-squared:  0.1406 
F-statistic: 28.53 on 4 and 669 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
</section>
<section id="effect-sizes-coefficient-estimates-1" class="level2" data-number="8.3">
<h2 data-number="8.3" class="anchored" data-anchor-id="effect-sizes-coefficient-estimates-1"><span class="header-section-number">8.3</span> Effect Sizes: Coefficient Estimates</h2>
<p>Here, we specify the size and magnitude of all coefficients, providing estimated effect sizes with 90% confidence intervals.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(model_small, <span class="at">conf.int =</span> <span class="cn">TRUE</span>, <span class="at">conf.level =</span> <span class="fl">0.90</span>) <span class="sc">|&gt;</span> </span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(term, estimate, std.error, conf.low, conf.high, p.value) <span class="sc">|&gt;</span> </span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">dig =</span> <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">term</th>
<th style="text-align: right;">estimate</th>
<th style="text-align: right;">std.error</th>
<th style="text-align: right;">conf.low</th>
<th style="text-align: right;">conf.high</th>
<th style="text-align: right;">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">7.0622</td>
<td style="text-align: right;">0.4442</td>
<td style="text-align: right;">6.3306</td>
<td style="text-align: right;">7.7939</td>
<td style="text-align: right;">0.0000</td>
</tr>
<tr class="even">
<td style="text-align: left;">sqrt(sbp1)</td>
<td style="text-align: right;">0.3691</td>
<td style="text-align: right;">0.0359</td>
<td style="text-align: right;">0.3100</td>
<td style="text-align: right;">0.4282</td>
<td style="text-align: right;">0.0000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">age</td>
<td style="text-align: right;">0.0041</td>
<td style="text-align: right;">0.0026</td>
<td style="text-align: right;">-0.0002</td>
<td style="text-align: right;">0.0084</td>
<td style="text-align: right;">0.1193</td>
</tr>
<tr class="even">
<td style="text-align: left;">tobaccoquit</td>
<td style="text-align: right;">-0.1213</td>
<td style="text-align: right;">0.0656</td>
<td style="text-align: right;">-0.2295</td>
<td style="text-align: right;">-0.0132</td>
<td style="text-align: right;">0.0650</td>
</tr>
<tr class="odd">
<td style="text-align: left;">tobaccocurrent</td>
<td style="text-align: right;">-0.0041</td>
<td style="text-align: right;">0.0711</td>
<td style="text-align: right;">-0.1211</td>
<td style="text-align: right;">0.1130</td>
<td style="text-align: right;">0.9545</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="interpreting-the-small-model-regression-equation" class="level2" data-number="8.4">
<h2 data-number="8.4" class="anchored" data-anchor-id="interpreting-the-small-model-regression-equation"><span class="header-section-number">8.4</span> Interpreting the Small Model Regression Equation</h2>
<p>I’ll skip the necessary English sentences here in the demo that explain the meaning of the estimates in our model.</p>
</section>
</section>
<section id="in-sample-comparison" class="level1" data-number="9">
<h1 data-number="9"><span class="header-section-number">9</span> In-Sample Comparison</h1>
<section id="quality-of-fit" class="level2" data-number="9.1">
<h2 data-number="9.1" class="anchored" data-anchor-id="quality-of-fit"><span class="header-section-number">9.1</span> Quality of Fit</h2>
<p>We will compare the small model to the big model in our training sample using adjusted R<sup>2</sup>, the residual standard error, AIC and BIC. We’ll be a little bit slick here.</p>
<ul>
<li>First, we’ll use <code>glance</code> to build a tibble of key results for the kitchen sink model, and append to that a description of the model. We’ll toss that in a temporary tibble called <code>temp_a</code>.</li>
<li>Next we do the same for the smaller model, and put that in <code>temp_b</code>.</li>
<li>Finally, we put the temp files together into a new tibble, called <code>training_comp</code>, and examine that.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>temp_a <span class="ot">&lt;-</span> <span class="fu">glance</span>(model_big) <span class="sc">|&gt;</span> </span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>logLik, <span class="sc">-</span>deviance) <span class="sc">|&gt;</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">3</span>) <span class="sc">|&gt;</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">modelname =</span> <span class="st">"big"</span>)</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>temp_b <span class="ot">&lt;-</span> <span class="fu">glance</span>(model_small) <span class="sc">|&gt;</span></span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>logLik, <span class="sc">-</span>deviance) <span class="sc">|&gt;</span></span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">3</span>) <span class="sc">|&gt;</span></span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">modelname =</span> <span class="st">"small"</span>)</span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a>training_comp <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(temp_a, temp_b) <span class="sc">|&gt;</span></span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(modelname, nobs, df, AIC, BIC, <span class="fu">everything</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>training_comp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 11
  modelname  nobs    df   AIC   BIC r.squared adj.r.squared sigma statistic
  &lt;chr&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;         &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;
1 big         674     6 1467. 1503.     0.148         0.14  0.714      19.3
2 small       674     4 1464. 1492.     0.146         0.141 0.713      28.5
# ℹ 2 more variables: p.value &lt;dbl&gt;, df.residual &lt;dbl&gt;</code></pre>
</div>
</div>
<p>It looks like the smaller model with 3 predictors: <code>sqrt(sbp1)</code>, <code>age</code> and <code>tobacco</code>, performs slightly better in the training sample.</p>
<ul>
<li>The AIC and BIC for the smaller model are each a little smaller than for the big model.</li>
<li>The adjusted R<sup>2</sup> and residual standard deviation (<code>sigma</code>) is essentially identical in the two models.</li>
</ul>
</section>
<section id="assessing-assumptions" class="level2" data-number="9.2">
<h2 data-number="9.2" class="anchored" data-anchor-id="assessing-assumptions"><span class="header-section-number">9.2</span> Assessing Assumptions</h2>
<p>Here, we should run a set of residual plots for each model. If you want to impress me a little, you’ll use the <code>ggplot</code> versions I introduced in the slides for Classes 22-24. Otherwise, it’s perfectly fine just to show the plots available in base R.</p>
<section id="residual-plots-for-the-big-model" class="level3" data-number="9.2.1">
<h3 data-number="9.2.1" class="anchored" data-anchor-id="residual-plots-for-the-big-model"><span class="header-section-number">9.2.1</span> Residual Plots for the Big Model</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>)); <span class="fu">plot</span>(model_big); <span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="sample-study2_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>I see no serious problems with the assumptions of linearity, Normality and constant variance, nor do I see any highly influential points in our big model.</p>
</section>
<section id="residual-plots-for-the-small-model" class="level3" data-number="9.2.2">
<h3 data-number="9.2.2" class="anchored" data-anchor-id="residual-plots-for-the-small-model"><span class="header-section-number">9.2.2</span> Residual Plots for the Small Model</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>)); <span class="fu">plot</span>(model_small); <span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="sample-study2_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>I see no serious problems with the assumptions of linearity, Normality and constant variance, nor do I see any highly influential points in our small model.</p>
</section>
<section id="does-collinearity-have-a-meaningful-impact" class="level3" data-number="9.2.3">
<h3 data-number="9.2.3" class="anchored" data-anchor-id="does-collinearity-have-a-meaningful-impact"><span class="header-section-number">9.2.3</span> Does collinearity have a meaningful impact?</h3>
<p>If we fit models with multiple predictors, then we might want to assess the potential impact of collinearity.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>car<span class="sc">::</span><span class="fu">vif</span>(model_big)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>               GVIF Df GVIF^(1/(2*Df))
sqrt(sbp1) 1.010439  1        1.005206
age        1.157633  1        1.075934
bmi1       1.166054  1        1.079840
diabetes   1.040850  1        1.020221
tobacco    1.138000  2        1.032846</code></pre>
</div>
</div>
<p>We’d need to see a generalized variance inflation factor above 5 for collinearity to be a meaningful concern, so we should be fine in our big model. Our small model also has multiple predictors, but it cannot be an issue, since it’s just a subset of our big model, which didn’t have a collinearity problem.</p>
</section>
</section>
<section id="comparing-the-models" class="level2" data-number="9.3">
<h2 data-number="9.3" class="anchored" data-anchor-id="comparing-the-models"><span class="header-section-number">9.3</span> Comparing the Models</h2>
<p>Based on the training sample, my conclusions so far is to support the smaller model. It has (slightly) better performance on the fit quality measures, and each model shows no serious problems with regression assumptions.</p>
</section>
</section>
<section id="model-validation" class="level1" data-number="10">
<h1 data-number="10"><span class="header-section-number">10</span> Model Validation</h1>
<p>Now, we will use our two regression models to predict the value of our outcome using the predictor values in the test sample.</p>
<ul>
<li>We may need to back-transform the predictions to the original units if we wind up fitting a model to a transformed outcome.</li>
<li>We’ll definitely need to compare the two models in terms of mean squared prediction error and mean absolute prediction error in a Table, which I will definitely want to see in your portfolio.</li>
<li>We’ll have to specify which model appears better at out-of-sample prediction according to these comparisons, and how we know that.</li>
</ul>
<section id="calculating-prediction-errors" class="level2" data-number="10.1">
<h2 data-number="10.1" class="anchored" data-anchor-id="calculating-prediction-errors"><span class="header-section-number">10.1</span> Calculating Prediction Errors</h2>
<section id="big-model-back-transformation-and-calculating-fitsresiduals" class="level3" data-number="10.1.1">
<h3 data-number="10.1.1" class="anchored" data-anchor-id="big-model-back-transformation-and-calculating-fitsresiduals"><span class="header-section-number">10.1.1</span> Big Model: Back-Transformation and Calculating Fits/Residuals</h3>
<p>We’ll use the <code>augment</code> function from the <code>broom</code> package to help us here, and create <code>sbp2_fit</code> to hold the fitted values on the original <code>sbp2</code> scale after back-transformation (by squaring the predictions on the square root scale) and then <code>sbp2_res</code> to hold the residuals (prediction errors) we observe using the big model on the <code>hbp_test</code> data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>aug_big <span class="ot">&lt;-</span> <span class="fu">augment</span>(model_big, <span class="at">newdata =</span> hbp_test) <span class="sc">|&gt;</span> </span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mod_name =</span> <span class="st">"big"</span>,</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">sbp2_fit =</span> .fitted<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">sbp2_res =</span> sbp2 <span class="sc">-</span> sbp2_fit) <span class="sc">|&gt;</span></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(subj_id, mod_name, sbp2, sbp2_fit, sbp2_res, <span class="fu">everything</span>())</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(aug_big,<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 12
  subj_id mod_name  sbp2 sbp2_fit sbp2_res  sbp1   age  bmi1 diabetes tobacco
  &lt;chr&gt;   &lt;chr&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;fct&gt;    &lt;fct&gt;  
1 A0004   big        134     135.    -1.28   134    65  50.5 No       never  
2 A0015   big        162     133.    29.2    132    61  31.0 No       never  
3 A0020   big        111     128.   -17.1    125    43  23.1 No       current
# ℹ 2 more variables: .fitted &lt;dbl&gt;, .resid &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
<section id="small-model-back-transformation-and-calculating-fitsresiduals" class="level3" data-number="10.1.2">
<h3 data-number="10.1.2" class="anchored" data-anchor-id="small-model-back-transformation-and-calculating-fitsresiduals"><span class="header-section-number">10.1.2</span> Small Model: Back-Transformation and Calculating Fits/Residuals</h3>
<p>We’ll do the same thing, but using the small model in the <code>hbp_test</code> data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>aug_small <span class="ot">&lt;-</span> <span class="fu">augment</span>(model_small, <span class="at">newdata =</span> hbp_test) <span class="sc">|&gt;</span> </span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mod_name =</span> <span class="st">"small"</span>,</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">sbp2_fit =</span> .fitted<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">sbp2_res =</span> sbp2 <span class="sc">-</span> sbp2_fit) <span class="sc">|&gt;</span></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(subj_id, mod_name, sbp2, sbp2_fit, sbp2_res, <span class="fu">everything</span>())</span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(aug_small,<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 12
  subj_id mod_name  sbp2 sbp2_fit sbp2_res  sbp1   age  bmi1 diabetes tobacco
  &lt;chr&gt;   &lt;chr&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;fct&gt;    &lt;fct&gt;  
1 A0004   small      134     135.   -0.568   134    65  50.5 No       never  
2 A0015   small      162     133.   28.6     132    61  31.0 No       never  
3 A0020   small      111     129.  -18.1     125    43  23.1 No       current
# ℹ 2 more variables: .fitted &lt;dbl&gt;, .resid &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
<section id="combining-the-results" class="level3" data-number="10.1.3">
<h3 data-number="10.1.3" class="anchored" data-anchor-id="combining-the-results"><span class="header-section-number">10.1.3</span> Combining the Results</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>test_comp <span class="ot">&lt;-</span> <span class="fu">union</span>(aug_big, aug_small) <span class="sc">|&gt;</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(subj_id, mod_name)</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>test_comp <span class="sc">|&gt;</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 12
  subj_id mod_name  sbp2 sbp2_fit sbp2_res  sbp1   age  bmi1 diabetes tobacco
  &lt;chr&gt;   &lt;chr&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;fct&gt;    &lt;fct&gt;  
1 A0004   big        134     135.   -1.28    134    65  50.5 No       never  
2 A0004   small      134     135.   -0.568   134    65  50.5 No       never  
3 A0009   big        139     133.    5.94    133    57  31.0 No       current
4 A0009   small      139     133.    5.65    133    57  31.0 No       current
5 A0010   big        134     138.   -3.86    150    72  32.8 No       quit   
6 A0010   small      134     138.   -4.19    150    72  32.8 No       quit   
# ℹ 2 more variables: .fitted &lt;dbl&gt;, .resid &lt;dbl&gt;</code></pre>
</div>
</div>
<p>Given this <code>test_comp</code> tibble, including predictions and residuals from the kitchen sink model on our test data, we can now:</p>
<ol type="1">
<li>Visualize the prediction errors from each model.</li>
<li>Summarize those errors across each model.</li>
<li>Identify the “worst fitting” subject for each model in the test sample.</li>
</ol>
<p>The next few subsections actually do these things.</p>
</section>
</section>
<section id="visualizing-the-predictions" class="level2" data-number="10.2">
<h2 data-number="10.2" class="anchored" data-anchor-id="visualizing-the-predictions"><span class="header-section-number">10.2</span> Visualizing the Predictions</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(test_comp, <span class="fu">aes</span>(<span class="at">x =</span> sbp2_fit, <span class="at">y =</span> sbp2)) <span class="sc">+</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">1</span>, <span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">lty =</span> <span class="st">"dashed"</span>) <span class="sc">+</span> </span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"loess"</span>, <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">formula =</span> y <span class="sc">~</span> x) <span class="sc">+</span></span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>( <span class="sc">~</span> mod_name, <span class="at">labeller =</span> <span class="st">"label_both"</span>) <span class="sc">+</span></span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Predicted sbp2"</span>,</span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Observed sbp2"</span>,</span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Observed vs. Predicted sbp2"</span>,</span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Comparing Big to Small Model in Test Sample"</span>,</span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">"Dashed line is where Observed = Predicted"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="sample-study2_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>I’m not seeing a lot of difference between the models in terms of the adherence of the points to the dashed line. The models seem to be making fairly similar errors.</p>
</section>
<section id="summarizing-the-errors" class="level2" data-number="10.3">
<h2 data-number="10.3" class="anchored" data-anchor-id="summarizing-the-errors"><span class="header-section-number">10.3</span> Summarizing the Errors</h2>
<p>Calculate the mean absolute prediction error (MAPE), the root mean squared prediction error (RMSPE) and the maximum absolute error across the predictions made by each model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>test_comp <span class="sc">|&gt;</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(mod_name) <span class="sc">|&gt;</span></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">MAPE =</span> <span class="fu">mean</span>(<span class="fu">abs</span>(sbp2_res)), </span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">RMSPE =</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>(sbp2_res<span class="sc">^</span><span class="dv">2</span>)),</span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">max_error =</span> <span class="fu">max</span>(<span class="fu">abs</span>(sbp2_res)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 5
  mod_name     n  MAPE RMSPE max_error
  &lt;chr&gt;    &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;
1 big        289  13.7  17.4      53.6
2 small      289  13.7  17.4      52.9</code></pre>
</div>
</div>
<p>This is a table Dr.&nbsp;Love will <strong>definitely</strong> need to see during your presentation.</p>
<p>In this case, two of these summaries are better (smaller) for the small model (RMSPE and max_error), suggesting (gently) that it is the better choice. The MAPE is the exception.</p>
<p>These models suggest an average error in predicting systolic blood pressure (using MAPE) of more than 13 mm Hg. That’s not great on the scale of systolic blood pressure, I think.</p>
<section id="identify-the-largest-errors" class="level3" data-number="10.3.1">
<h3 data-number="10.3.1" class="anchored" data-anchor-id="identify-the-largest-errors"><span class="header-section-number">10.3.1</span> Identify the largest errors</h3>
<p>Identify the subject(s) where that maximum prediction error was made by each model, and the observed and model-fitted values of <code>sbp_diff</code> for that subject in each case.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>temp1 <span class="ot">&lt;-</span> aug_big <span class="sc">|&gt;</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">abs</span>(sbp2_res) <span class="sc">==</span> <span class="fu">max</span>(<span class="fu">abs</span>(sbp2_res)))</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>temp2 <span class="ot">&lt;-</span> aug_small <span class="sc">|&gt;</span></span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">abs</span>(sbp2_res) <span class="sc">==</span> <span class="fu">max</span>(<span class="fu">abs</span>(sbp2_res)))</span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(temp1, temp2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 12
  subj_id mod_name  sbp2 sbp2_fit sbp2_res  sbp1   age  bmi1 diabetes tobacco
  &lt;chr&gt;   &lt;chr&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;fct&gt;    &lt;fct&gt;  
1 A0513   big        200     146.     53.6   170    63  24.9 No       current
2 A0513   small      200     147.     52.9   170    63  24.9 No       current
# ℹ 2 more variables: .fitted &lt;dbl&gt;, .resid &lt;dbl&gt;</code></pre>
</div>
</div>
<ul>
<li>In our case, the same subject (<code>A0513</code>) was most poorly fit by each model.</li>
</ul>
</section>
<section id="validated-r-square-values" class="level3" data-number="10.3.2">
<h3 data-number="10.3.2" class="anchored" data-anchor-id="validated-r-square-values"><span class="header-section-number">10.3.2</span> Validated R-square values</h3>
<p>Here’s the squared correlation between our predicted <code>sbp2</code> and our actual <code>sbp2</code> in the test sample, using the big model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(aug_big<span class="sc">$</span>sbp2, aug_big<span class="sc">$</span>sbp2_fit)<span class="sc">^</span><span class="dv">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.1106822</code></pre>
</div>
</div>
<p>and here’s the R-square we obtained within the test sample for the small model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(aug_small<span class="sc">$</span>sbp2, aug_small<span class="sc">$</span>sbp2_fit)<span class="sc">^</span><span class="dv">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.1110652</code></pre>
</div>
</div>
<p>Not really much of a difference. Note that either of these results suggest our training sample <span class="math inline">\(R^2\)</span> (and even adjusted <span class="math inline">\(R^2\)</span> values) were a bit optimistic.</p>
</section>
</section>
<section id="comparing-the-models-1" class="level2" data-number="10.4">
<h2 data-number="10.4" class="anchored" data-anchor-id="comparing-the-models-1"><span class="header-section-number">10.4</span> Comparing the Models</h2>
<p>I would select the smaller model here, on the basis of the similar performance in terms of the visualization of errors, and the small improvements in RMSPE and maximum prediction error, as well as validated <span class="math inline">\(R^2\)</span>.</p>
</section>
</section>
<section id="discussion" class="level1" data-number="11">
<h1 data-number="11"><span class="header-section-number">11</span> Discussion</h1>
<section id="chosen-model" class="level2" data-number="11.1">
<h2 data-number="11.1" class="anchored" data-anchor-id="chosen-model"><span class="header-section-number">11.1</span> Chosen Model</h2>
<p>I chose the Small model. You’ll want to reiterate the reasons why in this subsection.</p>
</section>
<section id="answering-my-question" class="level2" data-number="11.2">
<h2 data-number="11.2" class="anchored" data-anchor-id="answering-my-question"><span class="header-section-number">11.2</span> Answering My Question</h2>
<p>Now use the Small model to answer the research question, in a complete sentence of two.</p>
</section>
<section id="next-steps" class="level2" data-number="11.3">
<h2 data-number="11.3" class="anchored" data-anchor-id="next-steps"><span class="header-section-number">11.3</span> Next Steps</h2>
<p>Describe an interesting next step, which might involve fitting a new model not available with your current cleaned data, or dealing with missing values differently, or obtaining new or better data, or something else. You should be able to describe why this might help.</p>
</section>
<section id="reflection" class="level2" data-number="11.4">
<h2 data-number="11.4" class="anchored" data-anchor-id="reflection"><span class="header-section-number">11.4</span> Reflection</h2>
<p>Tell us what you know now that would have changed your approach to Study 2 had you known it at the start.</p>
</section>
</section>
<section id="session-information" class="level1" data-number="12">
<h1 data-number="12"><span class="header-section-number">12</span> Session Information</h1>
<p>should be included at the end of your report.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">session_info</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>─ Session info ───────────────────────────────────────────────────────────────
 setting  value
 version  R version 4.4.1 (2024-06-14 ucrt)
 os       Windows 11 x64 (build 22631)
 system   x86_64, mingw32
 ui       RTerm
 language (EN)
 collate  English_United States.utf8
 ctype    English_United States.utf8
 tz       America/New_York
 date     2024-11-10
 pandoc   3.2 @ C:/Program Files/RStudio/resources/app/bin/quarto/bin/tools/ (via rmarkdown)

─ Packages ───────────────────────────────────────────────────────────────────
 package      * version date (UTC) lib source
 abind          1.4-8   2024-09-12 [1] CRAN (R 4.4.1)
 backports      1.5.0   2024-05-23 [1] CRAN (R 4.4.0)
 base64enc      0.1-3   2015-07-28 [1] CRAN (R 4.4.0)
 bit            4.5.0   2024-09-20 [1] CRAN (R 4.4.1)
 bit64          4.5.2   2024-09-22 [1] CRAN (R 4.4.1)
 broom        * 1.0.7   2024-09-26 [1] CRAN (R 4.4.1)
 car          * 3.1-3   2024-09-27 [1] CRAN (R 4.4.1)
 carData      * 3.0-5   2022-01-06 [1] CRAN (R 4.4.0)
 checkmate      2.3.2   2024-07-29 [1] CRAN (R 4.4.1)
 cli            3.6.3   2024-06-21 [1] CRAN (R 4.4.1)
 cluster        2.1.6   2023-12-01 [2] CRAN (R 4.4.1)
 colorspace     2.1-1   2024-07-26 [1] CRAN (R 4.4.1)
 crayon         1.5.3   2024-06-20 [1] CRAN (R 4.4.0)
 data.table     1.16.2  2024-10-10 [1] CRAN (R 4.4.1)
 digest         0.6.37  2024-08-19 [1] CRAN (R 4.4.1)
 dplyr        * 1.1.4   2023-11-17 [1] CRAN (R 4.4.0)
 evaluate       1.0.1   2024-10-10 [1] CRAN (R 4.4.1)
 fansi          1.0.6   2023-12-08 [1] CRAN (R 4.4.0)
 farver         2.1.2   2024-05-13 [1] CRAN (R 4.4.0)
 fastmap        1.2.0   2024-05-15 [1] CRAN (R 4.4.0)
 forcats      * 1.0.0   2023-01-29 [1] CRAN (R 4.4.0)
 foreign        0.8-87  2024-06-26 [1] CRAN (R 4.4.1)
 Formula        1.2-5   2023-02-24 [1] CRAN (R 4.4.0)
 generics       0.1.3   2022-07-05 [1] CRAN (R 4.4.0)
 GGally       * 2.2.1   2024-02-14 [1] CRAN (R 4.4.1)
 ggformula    * 0.12.0  2023-11-09 [1] CRAN (R 4.4.0)
 ggplot2      * 3.5.1   2024-04-23 [1] CRAN (R 4.4.0)
 ggridges       0.5.6   2024-01-23 [1] CRAN (R 4.4.0)
 ggstats        0.7.0   2024-09-22 [1] CRAN (R 4.4.1)
 glue           1.8.0   2024-09-30 [1] CRAN (R 4.4.1)
 gower          1.0.1   2022-12-22 [1] CRAN (R 4.4.0)
 gridExtra      2.3     2017-09-09 [1] CRAN (R 4.4.0)
 gtable         0.3.6   2024-10-25 [1] CRAN (R 4.4.1)
 haven          2.5.4   2023-11-30 [1] CRAN (R 4.4.1)
 Hmisc        * 5.2-0   2024-10-28 [1] CRAN (R 4.4.1)
 hms            1.1.3   2023-03-21 [1] CRAN (R 4.4.0)
 htmlTable      2.4.3   2024-07-21 [1] CRAN (R 4.4.1)
 htmltools      0.5.8.1 2024-04-04 [1] CRAN (R 4.4.0)
 htmlwidgets    1.6.4   2023-12-06 [1] CRAN (R 4.4.0)
 janitor      * 2.2.0   2023-02-02 [1] CRAN (R 4.4.1)
 jsonlite       1.8.9   2024-09-20 [1] CRAN (R 4.4.1)
 knitr        * 1.49    2024-11-08 [1] CRAN (R 4.4.1)
 labeling       0.4.3   2023-08-29 [1] CRAN (R 4.4.0)
 labelled       2.13.0  2024-04-23 [1] CRAN (R 4.4.0)
 lattice      * 0.22-6  2024-03-20 [1] CRAN (R 4.4.0)
 lifecycle      1.0.4   2023-11-07 [1] CRAN (R 4.4.0)
 lubridate    * 1.9.3   2023-09-27 [1] CRAN (R 4.4.0)
 magrittr       2.0.3   2022-03-30 [1] CRAN (R 4.4.0)
 MASS           7.3-61  2024-06-13 [1] CRAN (R 4.4.0)
 Matrix       * 1.7-0   2024-04-26 [2] CRAN (R 4.4.1)
 mgcv           1.9-1   2023-12-21 [1] CRAN (R 4.4.0)
 mosaic       * 1.9.1   2024-02-23 [1] CRAN (R 4.4.0)
 mosaicCore     0.9.4.0 2023-11-05 [1] CRAN (R 4.4.0)
 mosaicData   * 0.20.4  2023-11-05 [1] CRAN (R 4.4.0)
 munsell        0.5.1   2024-04-01 [1] CRAN (R 4.4.0)
 naniar       * 1.1.0   2024-03-05 [1] CRAN (R 4.4.1)
 nlme           3.1-164 2023-11-27 [2] CRAN (R 4.4.1)
 nnet           7.3-19  2023-05-03 [1] CRAN (R 4.4.0)
 patchwork    * 1.3.0   2024-09-16 [1] CRAN (R 4.4.1)
 pillar         1.9.0   2023-03-22 [1] CRAN (R 4.4.0)
 pkgconfig      2.0.3   2019-09-22 [1] CRAN (R 4.4.0)
 plyr           1.8.9   2023-10-02 [1] CRAN (R 4.4.0)
 purrr        * 1.0.2   2023-08-10 [1] CRAN (R 4.4.0)
 R6             2.5.1   2021-08-19 [1] CRAN (R 4.4.0)
 RColorBrewer   1.1-3   2022-04-03 [1] CRAN (R 4.4.0)
 Rcpp           1.0.13  2024-07-17 [1] CRAN (R 4.4.1)
 readr        * 2.1.5   2024-01-10 [1] CRAN (R 4.4.0)
 rlang          1.1.4   2024-06-04 [1] CRAN (R 4.4.0)
 rmarkdown      2.29    2024-11-04 [1] CRAN (R 4.4.2)
 rpart          4.1.23  2023-12-05 [1] CRAN (R 4.4.0)
 rstudioapi     0.17.1  2024-10-22 [1] CRAN (R 4.4.1)
 scales         1.3.0   2023-11-28 [1] CRAN (R 4.4.0)
 sessioninfo  * 1.2.2   2021-12-06 [1] CRAN (R 4.4.0)
 simputation  * 0.2.8   2022-06-16 [1] CRAN (R 4.4.0)
 snakecase      0.11.1  2023-08-27 [1] CRAN (R 4.4.0)
 stringi        1.8.4   2024-05-06 [1] CRAN (R 4.4.0)
 stringr      * 1.5.1   2023-11-14 [1] CRAN (R 4.4.0)
 tibble       * 3.2.1   2023-03-20 [1] CRAN (R 4.4.0)
 tidyr        * 1.3.1   2024-01-24 [1] CRAN (R 4.4.0)
 tidyselect     1.2.1   2024-03-11 [1] CRAN (R 4.4.0)
 tidyverse    * 2.0.0   2023-02-22 [1] CRAN (R 4.4.1)
 timechange     0.3.0   2024-01-18 [1] CRAN (R 4.4.0)
 tzdb           0.4.0   2023-05-12 [1] CRAN (R 4.4.0)
 utf8           1.2.4   2023-10-22 [1] CRAN (R 4.4.0)
 vctrs          0.6.5   2023-12-01 [1] CRAN (R 4.4.0)
 visdat         0.6.0   2023-02-02 [1] CRAN (R 4.4.0)
 vroom          1.6.5   2023-12-05 [1] CRAN (R 4.4.0)
 withr          3.0.2   2024-10-28 [1] CRAN (R 4.4.1)
 xfun           0.48    2024-10-03 [1] CRAN (R 4.4.1)
 yaml           2.3.10  2024-07-26 [1] CRAN (R 4.4.1)

 [1] C:/Users/thoma/AppData/Local/R/win-library/4.4
 [2] C:/Program Files/R/R-4.4.1/library

──────────────────────────────────────────────────────────────────────────────</code></pre>
</div>
</div>


<!-- -->

</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Admittedly, that’s not much better.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>As we’ll see in that setting, none of the generalized variance inflation factors will exceed 1.1, let alone the 5 or so that would cause us to be seriously concerned about collinearity.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
          // default icon
          link.classList.add("external");
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb91" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "431 Project B Sample Study 2 Report"</span></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Thomas E. Love"</span></span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> last-modified</span></span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a><span class="co">    theme: simplex</span></span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a><span class="co">    date-format: iso</span></span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb91-10"><a href="#cb91-10" aria-hidden="true" tabindex="-1"></a><span class="co">    number-sections: true</span></span>
<span id="cb91-11"><a href="#cb91-11" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb91-12"><a href="#cb91-12" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb91-13"><a href="#cb91-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-14"><a href="#cb91-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-15"><a href="#cb91-15" aria-hidden="true" tabindex="-1"></a><span class="fu"># Important Reminders from Dr. Love {-}</span></span>
<span id="cb91-16"><a href="#cb91-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-17"><a href="#cb91-17" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Remember that each subsection should include at least one complete sentence explaining what you are doing, specifying the variables you are using and how you are using them, and then conclude with at least one complete sentence of discussion of the key conclusions you draw from the current step, and a discussion of any limitations you can describe that apply to the results.</span>
<span id="cb91-18"><a href="#cb91-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-19"><a href="#cb91-19" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>If you want to download the Quarto code I used to create this document, click on the Code button near the title of this Sample Study.</span>
<span id="cb91-20"><a href="#cb91-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-21"><a href="#cb91-21" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>For heaven's sake, DO NOT use my words included in this example report in your project. Rewrite everything to make it relevant to your situation. Do not repeat my instructions back to me. </span>
<span id="cb91-22"><a href="#cb91-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-23"><a href="#cb91-23" aria-hidden="true" tabindex="-1"></a><span class="fu"># Setup and Data Ingest </span></span>
<span id="cb91-24"><a href="#cb91-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-25"><a href="#cb91-25" aria-hidden="true" tabindex="-1"></a>This document demonstrates analyses we are asking you to complete in Study 2 for Project B. The simulated data used in this example report are found in the <span class="in">`hbp_study.csv`</span> data file available in the projectB section of <span class="co">[</span><span class="ot">our 431-data website</span><span class="co">](https://github.com/THOMASELOVE/431-data)</span>.</span>
<span id="cb91-26"><a href="#cb91-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-27"><a href="#cb91-27" aria-hidden="true" tabindex="-1"></a>These are simulated data from a study of high blood pressure in 999 African-American adult subjects who are not of Hispanic or Latino ethnicity. To be included, the subject had to be between 33 and 83 years of age at baseline, have a series of items available in their health record at baseline, including a baseline systolic blood pressure, and then return for a blood pressure check 18 months later. Our goal will be to build a prediction model for the subject's systolic blood pressure at the end of the 18-month period, with the key predictor being that same subject's systolic blood pressure at the start of the period, and adjusting (in our larger model) for several other characteristics of the subjects at baseline.</span>
<span id="cb91-28"><a href="#cb91-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-29"><a href="#cb91-29" aria-hidden="true" tabindex="-1"></a><span class="fu">## Initial Setup and Package Loads in R </span></span>
<span id="cb91-30"><a href="#cb91-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-33"><a href="#cb91-33" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-34"><a href="#cb91-34" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb91-35"><a href="#cb91-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-36"><a href="#cb91-36" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb91-37"><a href="#cb91-37" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb91-38"><a href="#cb91-38" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(GGally)</span>
<span id="cb91-39"><a href="#cb91-39" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Hmisc)</span>
<span id="cb91-40"><a href="#cb91-40" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor)</span>
<span id="cb91-41"><a href="#cb91-41" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb91-42"><a href="#cb91-42" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mosaic)</span>
<span id="cb91-43"><a href="#cb91-43" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(naniar)</span>
<span id="cb91-44"><a href="#cb91-44" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb91-45"><a href="#cb91-45" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sessioninfo)</span>
<span id="cb91-46"><a href="#cb91-46" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(simputation)</span>
<span id="cb91-47"><a href="#cb91-47" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse) </span>
<span id="cb91-48"><a href="#cb91-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-49"><a href="#cb91-49" aria-hidden="true" tabindex="-1"></a><span class="do">## Global options</span></span>
<span id="cb91-50"><a href="#cb91-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-51"><a href="#cb91-51" aria-hidden="true" tabindex="-1"></a>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">comment=</span><span class="cn">NA</span>)</span>
<span id="cb91-52"><a href="#cb91-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-53"><a href="#cb91-53" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_bw</span>())</span>
<span id="cb91-54"><a href="#cb91-54" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">dplyr.summarise.inform =</span> <span class="cn">FALSE</span>)</span>
<span id="cb91-55"><a href="#cb91-55" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-56"><a href="#cb91-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-57"><a href="#cb91-57" aria-hidden="true" tabindex="-1"></a><span class="fu">## Loading the Raw Data into R </span></span>
<span id="cb91-58"><a href="#cb91-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-59"><a href="#cb91-59" aria-hidden="true" tabindex="-1"></a>Here, we load the data using <span class="in">`read_csv`</span> and then convert all <span class="in">`character`</span> variables to <span class="in">`factors`</span> in R, and then change our identifying code: <span class="in">`subj_id`</span> back to a character variable.</span>
<span id="cb91-60"><a href="#cb91-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-61"><a href="#cb91-61" aria-hidden="true" tabindex="-1"></a><span class="in">```{r data_load}</span></span>
<span id="cb91-62"><a href="#cb91-62" aria-hidden="true" tabindex="-1"></a><span class="in">hbp_study &lt;- read_csv("data/hbp_study.csv", show_col_types = FALSE) |&gt;</span></span>
<span id="cb91-63"><a href="#cb91-63" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(across(where(is.character), as.factor)) |&gt;</span></span>
<span id="cb91-64"><a href="#cb91-64" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(subj_id = as.character(subj_id))</span></span>
<span id="cb91-65"><a href="#cb91-65" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-66"><a href="#cb91-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-67"><a href="#cb91-67" aria-hidden="true" tabindex="-1"></a><span class="fu"># Cleaning the Data</span></span>
<span id="cb91-68"><a href="#cb91-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-69"><a href="#cb91-69" aria-hidden="true" tabindex="-1"></a><span class="fu">## Merging the Data</span></span>
<span id="cb91-70"><a href="#cb91-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-71"><a href="#cb91-71" aria-hidden="true" tabindex="-1"></a>In my little demonstration here, I don't have to do any merging.</span>
<span id="cb91-72"><a href="#cb91-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-73"><a href="#cb91-73" aria-hidden="true" tabindex="-1"></a><span class="fu">## The Raw Data</span></span>
<span id="cb91-74"><a href="#cb91-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-75"><a href="#cb91-75" aria-hidden="true" tabindex="-1"></a>The <span class="in">`hbp_study`</span> data set includes 12 variables and 999 adult subjects. For each subject, we have gathered</span>
<span id="cb91-76"><a href="#cb91-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-77"><a href="#cb91-77" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>baseline information on their <span class="in">`age`</span>, and their <span class="in">`sex`</span>, </span>
<span id="cb91-78"><a href="#cb91-78" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>whether or not they have a <span class="in">`diabetes`</span> diagnosis, </span>
<span id="cb91-79"><a href="#cb91-79" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>the socio-economic status of their neighborhood of residence (<span class="in">`nses`</span>), </span>
<span id="cb91-80"><a href="#cb91-80" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>their body-mass index (<span class="in">`bmi1`</span>) and systolic blood pressure (<span class="in">`sbp1`</span>), </span>
<span id="cb91-81"><a href="#cb91-81" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>their <span class="in">`insurance`</span> type, <span class="in">`tobacco`</span> use history, and </span>
<span id="cb91-82"><a href="#cb91-82" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>whether or not they have a prescription for a <span class="in">`statin`</span>, or for a <span class="in">`diuretic`</span>. </span>
<span id="cb91-83"><a href="#cb91-83" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Eighteen months later, we gathered a new systolic blood pressure (<span class="in">`sbp2`</span>) for each subject.</span>
<span id="cb91-84"><a href="#cb91-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-85"><a href="#cb91-85" aria-hidden="true" tabindex="-1"></a><span class="in">```{r hbp_study_data_in_the_raw}</span></span>
<span id="cb91-86"><a href="#cb91-86" aria-hidden="true" tabindex="-1"></a><span class="in">glimpse(hbp_study)</span></span>
<span id="cb91-87"><a href="#cb91-87" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-88"><a href="#cb91-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-89"><a href="#cb91-89" aria-hidden="true" tabindex="-1"></a>**Note**: If you have more than 20 variables in your initial (raw) data set, prune it down to 20 as the first step before showing us the results of <span class="in">`glimpse`</span> for your data.</span>
<span id="cb91-90"><a href="#cb91-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-91"><a href="#cb91-91" aria-hidden="true" tabindex="-1"></a>This tibble describes twelve variables, including:</span>
<span id="cb91-92"><a href="#cb91-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-93"><a href="#cb91-93" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>a character variable called <span class="in">`subj_id`</span> not to be used in our model except for identification of subjects,</span>
<span id="cb91-94"><a href="#cb91-94" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>our outcome (<span class="in">`sbp2`</span>) and our key predictor (<span class="in">`sbp1`</span>) that describe systolic blood pressure at two different times.</span>
<span id="cb91-95"><a href="#cb91-95" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>seven categorical candidate predictors, specifically <span class="in">`sex`</span>, <span class="in">`diabetes`</span>, <span class="in">`nses`</span>, <span class="in">`insurance`</span>, <span class="in">`tobacco`</span>, <span class="in">`statin`</span>, and <span class="in">`diuretic`</span>, each specified here in R as either a factor or a 1/0 numeric variable (<span class="in">`statin`</span> and <span class="in">`diuretic`</span>),</span>
<span id="cb91-96"><a href="#cb91-96" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>three quantitative candidate predictors, specifically <span class="in">`age`</span>, <span class="in">`bmi1`</span> and <span class="in">`sbp1`</span>. </span>
<span id="cb91-97"><a href="#cb91-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-98"><a href="#cb91-98" aria-hidden="true" tabindex="-1"></a><span class="fu">## Which variables should be included in the tidy data set?</span></span>
<span id="cb91-99"><a href="#cb91-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-100"><a href="#cb91-100" aria-hidden="true" tabindex="-1"></a>In fitting my models, I actually plan only to use five predictors: <span class="in">`sbp1`</span>, <span class="in">`age`</span>, <span class="in">`bmi1`</span>, <span class="in">`diabetes`</span> and <span class="in">`tobacco`</span> to model my outcome: <span class="in">`sbp2`</span>. Even though I'm not planning to use all of these predictors in my models, I'm going to build a tidy data set including all of them anyway, so I can demonstrate solutions to some problems you might have. </span>
<span id="cb91-101"><a href="#cb91-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-102"><a href="#cb91-102" aria-hidden="true" tabindex="-1"></a>When you build your tidy data set in the next section, restrict it to the variables (outcomes, predictors and <span class="in">`subj_id`</span>) that you will actually use in your modeling. </span>
<span id="cb91-103"><a href="#cb91-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-104"><a href="#cb91-104" aria-hidden="true" tabindex="-1"></a>In building our tidy version of these data, we must:</span>
<span id="cb91-105"><a href="#cb91-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-106"><a href="#cb91-106" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>deal with the ordering of levels in the multi-categorical variables <span class="in">`nses`</span>, <span class="in">`insurance`</span> and <span class="in">`tobacco`</span>,</span>
<span id="cb91-107"><a href="#cb91-107" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>change the name of <span class="in">`nses`</span> to something more helpful - I'll use <span class="in">`nbhd_ses`</span> as the new name^<span class="co">[</span><span class="ot">Admittedly, that's not much better.</span><span class="co">]</span>.</span>
<span id="cb91-108"><a href="#cb91-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-109"><a href="#cb91-109" aria-hidden="true" tabindex="-1"></a><span class="fu">## Checking our Outcome and Key Predictor</span></span>
<span id="cb91-110"><a href="#cb91-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-113"><a href="#cb91-113" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-114"><a href="#cb91-114" aria-hidden="true" tabindex="-1"></a><span class="fu">df_stats</span>(<span class="sc">~</span> sbp2 <span class="sc">+</span> sbp1, <span class="at">data =</span> hbp_study)</span>
<span id="cb91-115"><a href="#cb91-115" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-116"><a href="#cb91-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-117"><a href="#cb91-117" aria-hidden="true" tabindex="-1"></a>We have no missing values in our outcome or our key predictor, and each of the values look plausible, so we'll move on.</span>
<span id="cb91-118"><a href="#cb91-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-119"><a href="#cb91-119" aria-hidden="true" tabindex="-1"></a><span class="fu">## Checking the Quantitative Predictors</span></span>
<span id="cb91-120"><a href="#cb91-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-121"><a href="#cb91-121" aria-hidden="true" tabindex="-1"></a>Besides <span class="in">`sbp1`</span> we have two other quantitative predictor candidates, <span class="in">`age`</span> and <span class="in">`bmi1`</span>.</span>
<span id="cb91-122"><a href="#cb91-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-125"><a href="#cb91-125" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-126"><a href="#cb91-126" aria-hidden="true" tabindex="-1"></a><span class="fu">df_stats</span>(<span class="sc">~</span> age <span class="sc">+</span> bmi1, <span class="at">data =</span> hbp_study)</span>
<span id="cb91-127"><a href="#cb91-127" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-128"><a href="#cb91-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-129"><a href="#cb91-129" aria-hidden="true" tabindex="-1"></a>We know that all subjects in these data had to be between 33 and 83 years of age in order to be included, so we're happy to see that they are. We have five missing values (appropriately specified with NA) and no implausible values in our BMI values (I would use 16-80 as a plausible range of BMI values for adults.) Things look OK for now, as we'll deal with the missing values last.</span>
<span id="cb91-130"><a href="#cb91-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-131"><a href="#cb91-131" aria-hidden="true" tabindex="-1"></a><span class="fu">## Checking the Categorical Variables</span></span>
<span id="cb91-132"><a href="#cb91-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-133"><a href="#cb91-133" aria-hidden="true" tabindex="-1"></a>For categorical variables, it's always worth it to check to see whether the existing orders of the factor levels match the inherent order of the information, as well as whether there are any levels which we might want to collapse due to insufficient data, and whether there are any missing values.</span>
<span id="cb91-134"><a href="#cb91-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-135"><a href="#cb91-135" aria-hidden="true" tabindex="-1"></a><span class="fu">### `nses`: home neighborhood's socio-economic status</span></span>
<span id="cb91-136"><a href="#cb91-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-137"><a href="#cb91-137" aria-hidden="true" tabindex="-1"></a><span class="in">```{r levels_of_nses}</span></span>
<span id="cb91-138"><a href="#cb91-138" aria-hidden="true" tabindex="-1"></a><span class="in">hbp_study |&gt; tabyl(nses)</span></span>
<span id="cb91-139"><a href="#cb91-139" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-140"><a href="#cb91-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-141"><a href="#cb91-141" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The order of <span class="in">`nses`</span>, instead of the alphabetical ("High", "Low", "Middle", "Very Low"), should go from "Very Low" to "Low" to "Middle" to "High", or perhaps its reverse.</span>
<span id="cb91-142"><a href="#cb91-142" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Let's fix that using the <span class="in">`fct_relevel`</span> function from the <span class="in">`forcats`</span> package, which is part of the <span class="in">`tidyverse`</span>. While we're at it, we'll rename the variable <span class="in">`nbhd_ses`</span> which is more helpful to me.</span>
<span id="cb91-143"><a href="#cb91-143" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Then we'll see how many subjects fall in each category.</span>
<span id="cb91-144"><a href="#cb91-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-145"><a href="#cb91-145" aria-hidden="true" tabindex="-1"></a><span class="in">```{r relevel_nses}</span></span>
<span id="cb91-146"><a href="#cb91-146" aria-hidden="true" tabindex="-1"></a><span class="in">hbp_study &lt;- hbp_study |&gt;</span></span>
<span id="cb91-147"><a href="#cb91-147" aria-hidden="true" tabindex="-1"></a><span class="in">  rename(nbhd_ses = nses) |&gt;</span></span>
<span id="cb91-148"><a href="#cb91-148" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(nbhd_ses = fct_relevel(nbhd_ses, "Very Low", "Low", </span></span>
<span id="cb91-149"><a href="#cb91-149" aria-hidden="true" tabindex="-1"></a><span class="in">                            "Middle", "High"))</span></span>
<span id="cb91-150"><a href="#cb91-150" aria-hidden="true" tabindex="-1"></a><span class="in">hbp_study |&gt; tabyl(nbhd_ses)</span></span>
<span id="cb91-151"><a href="#cb91-151" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-152"><a href="#cb91-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-153"><a href="#cb91-153" aria-hidden="true" tabindex="-1"></a>We have 8 missing values of <span class="in">`nbhd_ses`</span>. We'll deal with that later.</span>
<span id="cb91-154"><a href="#cb91-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-155"><a href="#cb91-155" aria-hidden="true" tabindex="-1"></a><span class="fu">### `tobacco`: tobacco use history</span></span>
<span id="cb91-156"><a href="#cb91-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-157"><a href="#cb91-157" aria-hidden="true" tabindex="-1"></a><span class="in">```{r levels_of_tobacco}</span></span>
<span id="cb91-158"><a href="#cb91-158" aria-hidden="true" tabindex="-1"></a><span class="in">hbp_study |&gt; tabyl(tobacco)</span></span>
<span id="cb91-159"><a href="#cb91-159" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-160"><a href="#cb91-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-161"><a href="#cb91-161" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>For <span class="in">`tobacco`</span>, instead of ("current", "never", "quit"), we want a new order: ("never", "quit", "current").</span>
<span id="cb91-162"><a href="#cb91-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-163"><a href="#cb91-163" aria-hidden="true" tabindex="-1"></a><span class="in">```{r relevel_tobacco}</span></span>
<span id="cb91-164"><a href="#cb91-164" aria-hidden="true" tabindex="-1"></a><span class="in">hbp_study &lt;- hbp_study |&gt;</span></span>
<span id="cb91-165"><a href="#cb91-165" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(tobacco = fct_relevel(tobacco, "never", "quit", </span></span>
<span id="cb91-166"><a href="#cb91-166" aria-hidden="true" tabindex="-1"></a><span class="in">                            "current"))</span></span>
<span id="cb91-167"><a href="#cb91-167" aria-hidden="true" tabindex="-1"></a><span class="in">hbp_study |&gt; count(tobacco)</span></span>
<span id="cb91-168"><a href="#cb91-168" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-169"><a href="#cb91-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-170"><a href="#cb91-170" aria-hidden="true" tabindex="-1"></a>We have 23 missing values of <span class="in">`tobacco`</span>. Again, we'll deal with that later.</span>
<span id="cb91-171"><a href="#cb91-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-172"><a href="#cb91-172" aria-hidden="true" tabindex="-1"></a><span class="fu">### `insurance`: primary insurance type</span></span>
<span id="cb91-173"><a href="#cb91-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-174"><a href="#cb91-174" aria-hidden="true" tabindex="-1"></a><span class="in">```{r levels_insurance}</span></span>
<span id="cb91-175"><a href="#cb91-175" aria-hidden="true" tabindex="-1"></a><span class="in">hbp_study |&gt; tabyl(insurance)</span></span>
<span id="cb91-176"><a href="#cb91-176" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-177"><a href="#cb91-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-178"><a href="#cb91-178" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>For <span class="in">`insurance`</span>, we'll change the order to ("Medicare", "Private", "Medicaid", "Uninsured")</span>
<span id="cb91-179"><a href="#cb91-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-180"><a href="#cb91-180" aria-hidden="true" tabindex="-1"></a><span class="in">```{r relevel_insurance}</span></span>
<span id="cb91-181"><a href="#cb91-181" aria-hidden="true" tabindex="-1"></a><span class="in">hbp_study &lt;- hbp_study |&gt;</span></span>
<span id="cb91-182"><a href="#cb91-182" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(insurance = fct_relevel(insurance, "Medicare", </span></span>
<span id="cb91-183"><a href="#cb91-183" aria-hidden="true" tabindex="-1"></a><span class="in">                                 "Private", "Medicaid", </span></span>
<span id="cb91-184"><a href="#cb91-184" aria-hidden="true" tabindex="-1"></a><span class="in">                                 "Uninsured"))</span></span>
<span id="cb91-185"><a href="#cb91-185" aria-hidden="true" tabindex="-1"></a><span class="in">hbp_study |&gt; tabyl(insurance)</span></span>
<span id="cb91-186"><a href="#cb91-186" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-187"><a href="#cb91-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-188"><a href="#cb91-188" aria-hidden="true" tabindex="-1"></a>Note that any levels left out of a <span class="in">`fct_relevel`</span> statement get included in their current order, after whatever levels have been specified.</span>
<span id="cb91-189"><a href="#cb91-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-190"><a href="#cb91-190" aria-hidden="true" tabindex="-1"></a><span class="fu">### What about the subjects?</span></span>
<span id="cb91-191"><a href="#cb91-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-192"><a href="#cb91-192" aria-hidden="true" tabindex="-1"></a>It is important to make sure that we have a unique (distinct) code (here, <span class="in">`subj_id`</span>) for each row in the raw data set.</span>
<span id="cb91-193"><a href="#cb91-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-196"><a href="#cb91-196" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-197"><a href="#cb91-197" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(hbp_study)</span>
<span id="cb91-198"><a href="#cb91-198" aria-hidden="true" tabindex="-1"></a><span class="fu">n_distinct</span>(hbp_study <span class="sc">|&gt;</span> <span class="fu">select</span>(subj_id))</span>
<span id="cb91-199"><a href="#cb91-199" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-200"><a href="#cb91-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-201"><a href="#cb91-201" aria-hidden="true" tabindex="-1"></a>OK, that's fine.</span>
<span id="cb91-202"><a href="#cb91-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-203"><a href="#cb91-203" aria-hidden="true" tabindex="-1"></a><span class="fu">## Dealing with Missingness</span></span>
<span id="cb91-204"><a href="#cb91-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-205"><a href="#cb91-205" aria-hidden="true" tabindex="-1"></a>Note that you will need to ensure that any *missing* values are appropriately specified using <span class="in">`NA`</span>. </span>
<span id="cb91-206"><a href="#cb91-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-207"><a href="#cb91-207" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>In this data set, we're all set on that issue. </span>
<span id="cb91-208"><a href="#cb91-208" aria-hidden="true" tabindex="-1"></a><span class="ss">    + </span>There are missing data in <span class="in">`nses`</span> (8 NA), <span class="in">`bmi1`</span> (5 NA) and <span class="in">`tobacco`</span> (23 NA).</span>
<span id="cb91-209"><a href="#cb91-209" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Missing Outcomes**. In building your tidy data set, delete any subjects with missing values of your outcome variable. I'd also probably drop any subjects missing the key predictor, too.</span>
<span id="cb91-210"><a href="#cb91-210" aria-hidden="true" tabindex="-1"></a><span class="ss">    + </span>If we needed to delete the rows with missing values of an outcome, I would use code of the form <span class="in">`data_fixed &lt;- data_original |&gt; filter(complete.cases(outcomevariablename))`</span> to accomplish that.</span>
<span id="cb91-211"><a href="#cb91-211" aria-hidden="true" tabindex="-1"></a><span class="ss">    + </span>The elements (<span class="in">`sbp1`</span> and <span class="in">`sbp2`</span>) that form our outcome and key predictor have no missing values, though, so we'll be OK in that regard.</span>
<span id="cb91-212"><a href="#cb91-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-213"><a href="#cb91-213" aria-hidden="true" tabindex="-1"></a>In building the tidy data set, leave all missing values for candidate predictors as <span class="in">`NA`</span>. </span>
<span id="cb91-214"><a href="#cb91-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-215"><a href="#cb91-215" aria-hidden="true" tabindex="-1"></a><span class="fu">### Assume MCAR and Build Tibble of Complete Cases</span></span>
<span id="cb91-216"><a href="#cb91-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-217"><a href="#cb91-217" aria-hidden="true" tabindex="-1"></a>For your project, I expect a complete case analysis, where you drop all observations with missing data from your data set before creating your codebook. Let's do that here.</span>
<span id="cb91-218"><a href="#cb91-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-219"><a href="#cb91-219" aria-hidden="true" tabindex="-1"></a><span class="fu">### Identifying Missing Data</span></span>
<span id="cb91-220"><a href="#cb91-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-221"><a href="#cb91-221" aria-hidden="true" tabindex="-1"></a>There are 23 subjects missing <span class="in">`tobacco`</span>, 8 missing <span class="in">`nbhd_ses`</span> and 5 missing <span class="in">`bmi1`</span>.</span>
<span id="cb91-222"><a href="#cb91-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-225"><a href="#cb91-225" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-226"><a href="#cb91-226" aria-hidden="true" tabindex="-1"></a><span class="fu">miss_var_summary</span>(hbp_study)</span>
<span id="cb91-227"><a href="#cb91-227" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-228"><a href="#cb91-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-229"><a href="#cb91-229" aria-hidden="true" tabindex="-1"></a>No subject is missing more than one variable, as we can tell from the table below, sorted by <span class="in">`n_miss`</span>.</span>
<span id="cb91-230"><a href="#cb91-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-233"><a href="#cb91-233" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-234"><a href="#cb91-234" aria-hidden="true" tabindex="-1"></a><span class="fu">miss_case_summary</span>(hbp_study)</span>
<span id="cb91-235"><a href="#cb91-235" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-236"><a href="#cb91-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-237"><a href="#cb91-237" aria-hidden="true" tabindex="-1"></a>So we'll lose 23 + 8 + 5 = 36 observations from our sample of 999 in dropping all cases with missing values, leaving us with a complete cases tibble of 963 rows.</span>
<span id="cb91-238"><a href="#cb91-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-239"><a href="#cb91-239" aria-hidden="true" tabindex="-1"></a><span class="fu">### The Complete Cases Tibble</span></span>
<span id="cb91-240"><a href="#cb91-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-241"><a href="#cb91-241" aria-hidden="true" tabindex="-1"></a>My complete case data set would then be something like this:</span>
<span id="cb91-242"><a href="#cb91-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-243"><a href="#cb91-243" aria-hidden="true" tabindex="-1"></a><span class="in">```{r hbp_cc}</span></span>
<span id="cb91-244"><a href="#cb91-244" aria-hidden="true" tabindex="-1"></a><span class="in">hbp_cc &lt;- hbp_study |&gt;</span></span>
<span id="cb91-245"><a href="#cb91-245" aria-hidden="true" tabindex="-1"></a><span class="in">  select(subj_id, sbp2, sbp1, age, sex, </span></span>
<span id="cb91-246"><a href="#cb91-246" aria-hidden="true" tabindex="-1"></a><span class="in">         diabetes, nbhd_ses, bmi1, insurance, </span></span>
<span id="cb91-247"><a href="#cb91-247" aria-hidden="true" tabindex="-1"></a><span class="in">         tobacco, statin, diuretic) |&gt;</span></span>
<span id="cb91-248"><a href="#cb91-248" aria-hidden="true" tabindex="-1"></a><span class="in">  drop_na()</span></span>
<span id="cb91-249"><a href="#cb91-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-250"><a href="#cb91-250" aria-hidden="true" tabindex="-1"></a><span class="in">hbp_cc</span></span>
<span id="cb91-251"><a href="#cb91-251" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-252"><a href="#cb91-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-253"><a href="#cb91-253" aria-hidden="true" tabindex="-1"></a>That's fine for Project B.</span>
<span id="cb91-254"><a href="#cb91-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-255"><a href="#cb91-255" aria-hidden="true" tabindex="-1"></a><span class="fu">### What if we instead did imputation?</span></span>
<span id="cb91-256"><a href="#cb91-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-257"><a href="#cb91-257" aria-hidden="true" tabindex="-1"></a>As an alternative (NOT expected in any way for Project B), we could use the <span class="in">`simputation`</span> package to impute missing values of <span class="in">`tobacco`</span>, <span class="in">`bmi1`</span> and <span class="in">`nbhd_ses`</span>. For each of these, we need to specify the approach we will use to do the imputation, and the variables we plan to use as predictors in our imputation model (the variables we plan to use to help predict the missing values). Some of these choices will be a little arbitrary, but I'm mostly demonstrating options here.</span>
<span id="cb91-258"><a href="#cb91-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-259"><a href="#cb91-259" aria-hidden="true" tabindex="-1"></a>Variable | NAs | Class | Imputation Approach | Imputation Model Predictors</span>
<span id="cb91-260"><a href="#cb91-260" aria-hidden="true" tabindex="-1"></a>-------: | ---: | -----------: | -------------------------- | -------------------</span>
<span id="cb91-261"><a href="#cb91-261" aria-hidden="true" tabindex="-1"></a><span class="in">`nbhd_ses`</span> | <span class="in">`r sum(is.na(hbp_study$nbhd_ses))`</span> | <span class="in">`r class(hbp_study$nbhd_ses)`</span> | CART (decision tree) | <span class="in">`age`</span>, <span class="in">`sex`</span>, <span class="in">`insurance`</span></span>
<span id="cb91-262"><a href="#cb91-262" aria-hidden="true" tabindex="-1"></a><span class="in">`tobacco`</span> | <span class="in">`r sum(is.na(hbp_study$tobacco))`</span> | <span class="in">`r class(hbp_study$tobacco)`</span> | CART (decision tree) | <span class="in">`age`</span>, <span class="in">`sex`</span>, <span class="in">`insurance`</span>, <span class="in">`nbhd_ses`</span></span>
<span id="cb91-263"><a href="#cb91-263" aria-hidden="true" tabindex="-1"></a><span class="in">`bmi1`</span> | <span class="in">`r sum(is.na(hbp_study$bmi1))`</span> | <span class="in">`r class(hbp_study$bmi1)`</span> | Robust Linear Model | <span class="in">`age`</span>, <span class="in">`sex`</span>, <span class="in">`diabetes`</span>, <span class="in">`sbp1`</span></span>
<span id="cb91-264"><a href="#cb91-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-265"><a href="#cb91-265" aria-hidden="true" tabindex="-1"></a>Here's the actual set of imputation commands, to create an imputed data set named <span class="in">`hbp_imputed`</span>.</span>
<span id="cb91-266"><a href="#cb91-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-269"><a href="#cb91-269" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-270"><a href="#cb91-270" aria-hidden="true" tabindex="-1"></a>hbp_imputed <span class="ot">&lt;-</span> hbp_study <span class="sc">|&gt;</span></span>
<span id="cb91-271"><a href="#cb91-271" aria-hidden="true" tabindex="-1"></a>  <span class="fu">impute_cart</span>(nbhd_ses <span class="sc">~</span> age <span class="sc">+</span> sex <span class="sc">+</span> insurance) <span class="sc">|&gt;</span></span>
<span id="cb91-272"><a href="#cb91-272" aria-hidden="true" tabindex="-1"></a>  <span class="fu">impute_cart</span>(tobacco <span class="sc">~</span> age <span class="sc">+</span> sex <span class="sc">+</span> insurance <span class="sc">+</span> nbhd_ses) <span class="sc">|&gt;</span></span>
<span id="cb91-273"><a href="#cb91-273" aria-hidden="true" tabindex="-1"></a>  <span class="fu">impute_rlm</span>(bmi1 <span class="sc">~</span> age <span class="sc">+</span> sex <span class="sc">+</span> diabetes <span class="sc">+</span> sbp1)</span>
<span id="cb91-274"><a href="#cb91-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-275"><a href="#cb91-275" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(hbp_imputed)</span>
<span id="cb91-276"><a href="#cb91-276" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-277"><a href="#cb91-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-278"><a href="#cb91-278" aria-hidden="true" tabindex="-1"></a>Note that I imputed <span class="in">`tobacco`</span> after <span class="in">`nbhd_ses`</span> largely because I wanted to use the <span class="in">`nbhd_ses`</span> results to aid in my imputation of <span class="in">`tobacco`</span>.</span>
<span id="cb91-279"><a href="#cb91-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-280"><a href="#cb91-280" aria-hidden="true" tabindex="-1"></a><span class="fu"># Codebook and Data Description</span></span>
<span id="cb91-281"><a href="#cb91-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-282"><a href="#cb91-282" aria-hidden="true" tabindex="-1"></a><span class="fu">## The Codebook</span></span>
<span id="cb91-283"><a href="#cb91-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-284"><a href="#cb91-284" aria-hidden="true" tabindex="-1"></a>The 12 variables in the <span class="in">`hbp_cc`</span> tidy data set for this demonstration are as follows. </span>
<span id="cb91-285"><a href="#cb91-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-286"><a href="#cb91-286" aria-hidden="true" tabindex="-1"></a>Variable      | Type  | Description / Levels</span>
<span id="cb91-287"><a href="#cb91-287" aria-hidden="true" tabindex="-1"></a>---------: | :-------------: | --------------------------------------------</span>
<span id="cb91-288"><a href="#cb91-288" aria-hidden="true" tabindex="-1"></a><span class="in">`subj_id`</span>   | Character  | subject code (A001-A999)</span>
<span id="cb91-289"><a href="#cb91-289" aria-hidden="true" tabindex="-1"></a><span class="in">`sbp2`</span>      | Quantitative | **outcome** variable, SBP after 18 months, in mm Hg</span>
<span id="cb91-290"><a href="#cb91-290" aria-hidden="true" tabindex="-1"></a><span class="in">`sbp1`</span>      | Quantitative | **key predictor** baseline SBP (systolic blood pressure), in mm Hg</span>
<span id="cb91-291"><a href="#cb91-291" aria-hidden="true" tabindex="-1"></a><span class="in">`age`</span>       | Quantitative | age of subject at baseline, in years</span>
<span id="cb91-292"><a href="#cb91-292" aria-hidden="true" tabindex="-1"></a><span class="in">`sex`</span>       | Binary | Male or Female</span>
<span id="cb91-293"><a href="#cb91-293" aria-hidden="true" tabindex="-1"></a><span class="in">`diabetes`</span>  | Binary | Does subject have a diabetes diagnosis: No or Yes</span>
<span id="cb91-294"><a href="#cb91-294" aria-hidden="true" tabindex="-1"></a><span class="in">`nbhd_ses`</span>  | 4 level Cat. | Socio-economic status of subject's home neighborhood: Very Low, Low, Middle and High</span>
<span id="cb91-295"><a href="#cb91-295" aria-hidden="true" tabindex="-1"></a><span class="in">`bmi1`</span>      | Quantitative | subject's body-mass index at baseline</span>
<span id="cb91-296"><a href="#cb91-296" aria-hidden="true" tabindex="-1"></a><span class="in">`insurance`</span> | 4 level Cat. | subject's insurance status at baseline: Medicare, Private, Medicaid, Uninsured</span>
<span id="cb91-297"><a href="#cb91-297" aria-hidden="true" tabindex="-1"></a><span class="in">`tobacco`</span>   | 3 level Cat. | subject's tobacco use at baseline: never, quit (former), current</span>
<span id="cb91-298"><a href="#cb91-298" aria-hidden="true" tabindex="-1"></a><span class="in">`statin`</span>    | Binary | 1 = statin prescription at baseline, else 0</span>
<span id="cb91-299"><a href="#cb91-299" aria-hidden="true" tabindex="-1"></a><span class="in">`diuretic`</span>  | Binary | 1 = diuretic prescription at baseline, else 0</span>
<span id="cb91-300"><a href="#cb91-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-301"><a href="#cb91-301" aria-hidden="true" tabindex="-1"></a>**Note**: I've demonstrated this task for a larger set of predictors than I actually intend to use. In fitting my models, I actually plan only to use five predictors: <span class="in">`sbp1`</span>, <span class="in">`age`</span>, <span class="in">`bmi1`</span>, <span class="in">`diabetes`</span> and <span class="in">`tobacco`</span> to model my outcome: <span class="in">`sbp2`</span>.</span>
<span id="cb91-302"><a href="#cb91-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-303"><a href="#cb91-303" aria-hidden="true" tabindex="-1"></a>For what follows, I'll focus only on the variables I actually will use in the analyses.</span>
<span id="cb91-304"><a href="#cb91-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-307"><a href="#cb91-307" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-308"><a href="#cb91-308" aria-hidden="true" tabindex="-1"></a>hbp_analytic <span class="ot">&lt;-</span> hbp_cc <span class="sc">|&gt;</span></span>
<span id="cb91-309"><a href="#cb91-309" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(subj_id, sbp2, sbp1, age, bmi1, diabetes, tobacco) </span>
<span id="cb91-310"><a href="#cb91-310" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-311"><a href="#cb91-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-312"><a href="#cb91-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-313"><a href="#cb91-313" aria-hidden="true" tabindex="-1"></a><span class="fu">## Analytic Tibble</span></span>
<span id="cb91-314"><a href="#cb91-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-315"><a href="#cb91-315" aria-hidden="true" tabindex="-1"></a>First, we'll provide a printout of the tibble, which will confirm that we have one.</span>
<span id="cb91-316"><a href="#cb91-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-319"><a href="#cb91-319" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-320"><a href="#cb91-320" aria-hidden="true" tabindex="-1"></a>hbp_analytic</span>
<span id="cb91-321"><a href="#cb91-321" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-322"><a href="#cb91-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-323"><a href="#cb91-323" aria-hidden="true" tabindex="-1"></a>Since we're using <span class="in">`df_print: paged`</span> in our YAML, we need also to demonstrate that we have a tibble.</span>
<span id="cb91-324"><a href="#cb91-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-327"><a href="#cb91-327" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-328"><a href="#cb91-328" aria-hidden="true" tabindex="-1"></a><span class="fu">is_tibble</span>(hbp_analytic)</span>
<span id="cb91-329"><a href="#cb91-329" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-330"><a href="#cb91-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-331"><a href="#cb91-331" aria-hidden="true" tabindex="-1"></a>OK. All set.</span>
<span id="cb91-332"><a href="#cb91-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-333"><a href="#cb91-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-334"><a href="#cb91-334" aria-hidden="true" tabindex="-1"></a><span class="fu">## Numerical Data Description</span></span>
<span id="cb91-335"><a href="#cb91-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-338"><a href="#cb91-338" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-339"><a href="#cb91-339" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb91-340"><a href="#cb91-340" aria-hidden="true" tabindex="-1"></a><span class="fu">describe</span>(hbp_analytic <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="sc">-</span>subj_id)) <span class="sc">|&gt;</span> <span class="fu">html</span>()</span>
<span id="cb91-341"><a href="#cb91-341" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-342"><a href="#cb91-342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-343"><a href="#cb91-343" aria-hidden="true" tabindex="-1"></a>We should (and do) see no missing or implausible values here, and our categorical variables are treated as factors with a rational ordering for the levels.</span>
<span id="cb91-344"><a href="#cb91-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-345"><a href="#cb91-345" aria-hidden="true" tabindex="-1"></a><span class="fu"># My Research Question</span></span>
<span id="cb91-346"><a href="#cb91-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-347"><a href="#cb91-347" aria-hidden="true" tabindex="-1"></a>Here you should provide background information on the study, and the subjects, so that we understand what you're talking about in your research question. I'll skip that in the demo, because I've done it already in introducing the data set, but you'll need that here.</span>
<span id="cb91-348"><a href="#cb91-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-349"><a href="#cb91-349" aria-hidden="true" tabindex="-1"></a>A natural research question here would be something like:</span>
<span id="cb91-350"><a href="#cb91-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-351"><a href="#cb91-351" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; How effectively can we predict systolic BP 18 months after baseline using baseline systolic BP, and is the quality of prediction meaningfully improved when I adjust for four other predictors (baseline age, body-mass index, diabetes diagnosis and tobacco use) in the </span><span class="in">`hbp_study`</span><span class="at"> data? </span></span>
<span id="cb91-352"><a href="#cb91-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-353"><a href="#cb91-353" aria-hidden="true" tabindex="-1"></a>Please don't feel obliged to follow this format precisely in stating your question.</span>
<span id="cb91-354"><a href="#cb91-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-355"><a href="#cb91-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-356"><a href="#cb91-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-357"><a href="#cb91-357" aria-hidden="true" tabindex="-1"></a><span class="fu"># Partitioning the Data</span></span>
<span id="cb91-358"><a href="#cb91-358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-359"><a href="#cb91-359" aria-hidden="true" tabindex="-1"></a>Here, we will obtain a training sample with a randomly selected 70% of the data (after imputing), and have the remaining 30% in a test sample, properly labeled, and using <span class="in">`set.seed`</span> so that the results can be replicated later. </span>
<span id="cb91-360"><a href="#cb91-360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-361"><a href="#cb91-361" aria-hidden="true" tabindex="-1"></a>I will call the training sample <span class="in">`hbp_training`</span> and the test sample <span class="in">`hbp_test`</span>. </span>
<span id="cb91-362"><a href="#cb91-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-363"><a href="#cb91-363" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>The <span class="in">`slice_sample`</span> function will sample the specified proportion of the data.</span>
<span id="cb91-364"><a href="#cb91-364" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Your training sample should contain a randomly selected 60-80% of your data. </span>
<span id="cb91-365"><a href="#cb91-365" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>The <span class="in">`anti_join`</span> function returns all rows in the first data frame (here specified as <span class="in">`hbp_analytic`</span>) that are not in the second data frame (here specified as <span class="in">`hbp_training`</span>) as assessed by the row-specific identification code (here <span class="in">`subj_id`</span>)).</span>
<span id="cb91-366"><a href="#cb91-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-367"><a href="#cb91-367" aria-hidden="true" tabindex="-1"></a><span class="in">```{r splitting_samples}</span></span>
<span id="cb91-368"><a href="#cb91-368" aria-hidden="true" tabindex="-1"></a><span class="in">set.seed(431) # set your own seed, don't use this one</span></span>
<span id="cb91-369"><a href="#cb91-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-370"><a href="#cb91-370" aria-hidden="true" tabindex="-1"></a><span class="in">hbp_training &lt;- hbp_analytic |&gt; slice_sample(prop = .70)</span></span>
<span id="cb91-371"><a href="#cb91-371" aria-hidden="true" tabindex="-1"></a><span class="in">hbp_test &lt;- anti_join(hbp_analytic, hbp_training, by = "subj_id")</span></span>
<span id="cb91-372"><a href="#cb91-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-373"><a href="#cb91-373" aria-hidden="true" tabindex="-1"></a><span class="in">dim(hbp_analytic) # number of rows and columns in hbp_analytic</span></span>
<span id="cb91-374"><a href="#cb91-374" aria-hidden="true" tabindex="-1"></a><span class="in">dim(hbp_training) # check to be sure we have 70% of hbp_analytic here</span></span>
<span id="cb91-375"><a href="#cb91-375" aria-hidden="true" tabindex="-1"></a><span class="in">dim(hbp_test) # check to be sure we have the rest of hbp_analytic here</span></span>
<span id="cb91-376"><a href="#cb91-376" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-377"><a href="#cb91-377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-378"><a href="#cb91-378" aria-hidden="true" tabindex="-1"></a>Since 674 + 289 = 963, we should be OK. </span>
<span id="cb91-379"><a href="#cb91-379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-380"><a href="#cb91-380" aria-hidden="true" tabindex="-1"></a><span class="fu"># Transforming the Outcome</span></span>
<span id="cb91-381"><a href="#cb91-381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-382"><a href="#cb91-382" aria-hidden="true" tabindex="-1"></a><span class="fu">## Visualizing the Outcome Distribution</span></span>
<span id="cb91-383"><a href="#cb91-383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-384"><a href="#cb91-384" aria-hidden="true" tabindex="-1"></a>I see at least three potential graphs to use to describe the distribution of our outcome variable, <span class="in">`sbp2`</span>. Again, remember we're using only the **training** sample here.</span>
<span id="cb91-385"><a href="#cb91-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-386"><a href="#cb91-386" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>A boxplot, probably accompanied by a violin plot to show the shape of the distribution more honestly.</span>
<span id="cb91-387"><a href="#cb91-387" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>A histogram, which could perhaps be presented as a density plot with a Normal distribution superimposed.</span>
<span id="cb91-388"><a href="#cb91-388" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>A Normal Q-Q plot to directly assess Normality.</span>
<span id="cb91-389"><a href="#cb91-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-390"><a href="#cb91-390" aria-hidden="true" tabindex="-1"></a>I expect you to show at least two of these three, but I will display all three here. Should we see substantial skew in the outcome data, we will want to consider an appropriate transformation, and then display the results of that transformation, as well.</span>
<span id="cb91-391"><a href="#cb91-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-392"><a href="#cb91-392" aria-hidden="true" tabindex="-1"></a>**WARNING**: Please note that I am deliberately showing you plots that are less finished than I hope you will provide. </span>
<span id="cb91-393"><a href="#cb91-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-394"><a href="#cb91-394" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>The coloring is dull or non-existent.</span>
<span id="cb91-395"><a href="#cb91-395" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>The theme is the default gray and white grid that lots of people dislike.</span>
<span id="cb91-396"><a href="#cb91-396" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>There are no meaningful titles or subtitles.</span>
<span id="cb91-397"><a href="#cb91-397" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>The axis labels select the default settings, and use incomprehensible variable names.</span>
<span id="cb91-398"><a href="#cb91-398" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>The coordinates aren't flipped when that might be appropriate.</span>
<span id="cb91-399"><a href="#cb91-399" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>I expect a much nicer presentation in your final work. Use the class slides and Lab answer sketches as a model for better plotting.</span>
<span id="cb91-400"><a href="#cb91-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-403"><a href="#cb91-403" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-404"><a href="#cb91-404" aria-hidden="true" tabindex="-1"></a>viz1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(hbp_training, <span class="fu">aes</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> sbp2)) <span class="sc">+</span></span>
<span id="cb91-405"><a href="#cb91-405" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_violin</span>() <span class="sc">+</span></span>
<span id="cb91-406"><a href="#cb91-406" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">width =</span> <span class="fl">0.25</span>)</span>
<span id="cb91-407"><a href="#cb91-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-408"><a href="#cb91-408" aria-hidden="true" tabindex="-1"></a>viz2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(hbp_training, <span class="fu">aes</span>(<span class="at">x =</span> sbp2)) <span class="sc">+</span></span>
<span id="cb91-409"><a href="#cb91-409" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">30</span>, <span class="at">col =</span> <span class="st">"white"</span>)</span>
<span id="cb91-410"><a href="#cb91-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-411"><a href="#cb91-411" aria-hidden="true" tabindex="-1"></a>viz3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(hbp_training, <span class="fu">aes</span>(<span class="at">sample =</span> sbp2)) <span class="sc">+</span></span>
<span id="cb91-412"><a href="#cb91-412" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_qq</span>() <span class="sc">+</span> <span class="fu">geom_qq_line</span>()</span>
<span id="cb91-413"><a href="#cb91-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-414"><a href="#cb91-414" aria-hidden="true" tabindex="-1"></a>viz1 <span class="sc">+</span> viz2 <span class="sc">+</span> viz3 <span class="sc">+</span></span>
<span id="cb91-415"><a href="#cb91-415" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(<span class="at">title =</span> <span class="st">"Less-Than-Great Plots of My Outcome's Distribution"</span>,</span>
<span id="cb91-416"><a href="#cb91-416" aria-hidden="true" tabindex="-1"></a>                  <span class="at">subtitle =</span> <span class="st">"complete with a rotten title, default axis labels and bad captions"</span>)</span>
<span id="cb91-417"><a href="#cb91-417" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-418"><a href="#cb91-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-419"><a href="#cb91-419" aria-hidden="true" tabindex="-1"></a>Later, we'll augment this initial look at the outcome data with a Box-Cox plot to suggest a potential transformation. Should you decide to make such a transformation, remember to return here to plot the results for your new and transformed outcome.</span>
<span id="cb91-420"><a href="#cb91-420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-421"><a href="#cb91-421" aria-hidden="true" tabindex="-1"></a><span class="fu">## Numerical Summary of the Outcome</span></span>
<span id="cb91-422"><a href="#cb91-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-423"><a href="#cb91-423" aria-hidden="true" tabindex="-1"></a>Assuming you plan no transformation of the outcome (and in our case, I am happy that the outcome data appear reasonably well-modeled by the Normal distribution) then you should just summarize the training data, with your favorite tool for that task. That might be:</span>
<span id="cb91-424"><a href="#cb91-424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-425"><a href="#cb91-425" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`favstats`</span> from the <span class="in">`mosaic`</span> package, as shown below, or</span>
<span id="cb91-426"><a href="#cb91-426" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`describe`</span> from the <span class="in">`Hmisc`</span> package, or </span>
<span id="cb91-427"><a href="#cb91-427" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>something else, I guess. </span>
<span id="cb91-428"><a href="#cb91-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-429"><a href="#cb91-429" aria-hidden="true" tabindex="-1"></a>But show **ONE** of these choices, and not all of them. Make a decision and go with it!</span>
<span id="cb91-430"><a href="#cb91-430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-433"><a href="#cb91-433" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-434"><a href="#cb91-434" aria-hidden="true" tabindex="-1"></a><span class="fu">favstats</span>(<span class="sc">~</span> sbp2, <span class="at">data =</span> hbp_training)</span>
<span id="cb91-435"><a href="#cb91-435" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-436"><a href="#cb91-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-437"><a href="#cb91-437" aria-hidden="true" tabindex="-1"></a><span class="fu">## Numerical Summaries of the Predictors</span></span>
<span id="cb91-438"><a href="#cb91-438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-439"><a href="#cb91-439" aria-hidden="true" tabindex="-1"></a>We also need an appropriate set of numerical summaries of each predictor variable, in the training data. I see at least two potential options here:</span>
<span id="cb91-440"><a href="#cb91-440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-441"><a href="#cb91-441" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Use <span class="in">`inspect`</span> from the <span class="in">`mosaic`</span> package to describe the predictors of interest briefly.</span>
<span id="cb91-442"><a href="#cb91-442" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Use <span class="in">`describe`</span> from the <span class="in">`Hmisc`</span> package for a more detailed description of the entire data set.</span>
<span id="cb91-443"><a href="#cb91-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-444"><a href="#cb91-444" aria-hidden="true" tabindex="-1"></a>Again, **DO NOT** do all of these. Pick one that works for you. I'm just demonstrating possible choices here.</span>
<span id="cb91-445"><a href="#cb91-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-446"><a href="#cb91-446" aria-hidden="true" tabindex="-1"></a><span class="fu">### Using the `inspect` function from `mosaic`</span></span>
<span id="cb91-447"><a href="#cb91-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-448"><a href="#cb91-448" aria-hidden="true" tabindex="-1"></a>The <span class="in">`inspect`</span> function provides a way to get results like <span class="in">`favstats`</span>, but for an entire data frame.</span>
<span id="cb91-449"><a href="#cb91-449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-452"><a href="#cb91-452" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-453"><a href="#cb91-453" aria-hidden="true" tabindex="-1"></a>hbp_training <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="sc">-</span>subj_id, <span class="sc">-</span>sbp2) <span class="sc">|&gt;</span> </span>
<span id="cb91-454"><a href="#cb91-454" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inspect</span>()</span>
<span id="cb91-455"><a href="#cb91-455" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-456"><a href="#cb91-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-457"><a href="#cb91-457" aria-hidden="true" tabindex="-1"></a>Next, we will build and interpret a scatterplot matrix to describe the associations (both numerically and graphically) between the outcome and all predictors. </span>
<span id="cb91-458"><a href="#cb91-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-459"><a href="#cb91-459" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We'll also use a Box-Cox plot to investigate whether a transformation of our outcome is suggested, and</span>
<span id="cb91-460"><a href="#cb91-460" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>describe what a correlation matrix suggests about collinearity between candidate predictors.</span>
<span id="cb91-461"><a href="#cb91-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-462"><a href="#cb91-462" aria-hidden="true" tabindex="-1"></a><span class="fu">## Scatterplot Matrix</span></span>
<span id="cb91-463"><a href="#cb91-463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-464"><a href="#cb91-464" aria-hidden="true" tabindex="-1"></a>Here, we will build a scatterplot matrix (or two) to show the relationship between our outcome and the predictors. I'll demonstrate the use of <span class="in">`ggpairs`</span> from the <span class="in">`GGally`</span> package.</span>
<span id="cb91-465"><a href="#cb91-465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-466"><a href="#cb91-466" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>If you have more than five predictors (as we do in our case) you should build two scatterplot matrices, each ending with the outcome. Anything more than one outcome and five predictors becomes unreadable in Professor Love's view.</span>
<span id="cb91-467"><a href="#cb91-467" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>If you have a multi-categorical predictor with more than four categories, that predictor will be very difficult to see and explore in the scatterplot matrix produced.</span>
<span id="cb91-468"><a href="#cb91-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-471"><a href="#cb91-471" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-472"><a href="#cb91-472" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb91-473"><a href="#cb91-473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-474"><a href="#cb91-474" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> hbp_training <span class="sc">|&gt;</span> </span>
<span id="cb91-475"><a href="#cb91-475" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(sbp1, age, bmi1, diabetes, tobacco, sbp2) </span>
<span id="cb91-476"><a href="#cb91-476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-477"><a href="#cb91-477" aria-hidden="true" tabindex="-1"></a><span class="fu">ggpairs</span>(temp, <span class="at">title =</span> <span class="st">"Scatterplot Matrix"</span>,</span>
<span id="cb91-478"><a href="#cb91-478" aria-hidden="true" tabindex="-1"></a>        <span class="at">lower =</span> <span class="fu">list</span>(<span class="at">combo =</span> <span class="fu">wrap</span>(<span class="st">"facethist"</span>, <span class="at">bins =</span> <span class="dv">20</span>)))</span>
<span id="cb91-479"><a href="#cb91-479" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-480"><a href="#cb91-480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-481"><a href="#cb91-481" aria-hidden="true" tabindex="-1"></a>At the end of this section, you should provide some discussion of the distribution of any key predictors, and their relationship to the outcome (all of that is provided in the bottom row if you place the outcome last, as you should, in selecting variables for the plot.)</span>
<span id="cb91-482"><a href="#cb91-482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-483"><a href="#cb91-483" aria-hidden="true" tabindex="-1"></a>**HINT**: For categorical variables, your efforts in this regard to summarize the relationships you see may be challenging. Your comments would be aided by the judicious use of numerical summaries. For example, suppose you want to study the relationship between tobacco use and <span class="in">`sbp2`</span>, then you probably want to run and discuss the following results, in addition to the scatterplot matrix above.</span>
<span id="cb91-484"><a href="#cb91-484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-487"><a href="#cb91-487" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-488"><a href="#cb91-488" aria-hidden="true" tabindex="-1"></a><span class="fu">favstats</span>(sbp2 <span class="sc">~</span> tobacco, <span class="at">data =</span> hbp_training)</span>
<span id="cb91-489"><a href="#cb91-489" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-490"><a href="#cb91-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-491"><a href="#cb91-491" aria-hidden="true" tabindex="-1"></a><span class="fu">## Collinearity Checking</span></span>
<span id="cb91-492"><a href="#cb91-492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-493"><a href="#cb91-493" aria-hidden="true" tabindex="-1"></a>Next, we'll take a brief look at potential collinearity. Remember that we want to see strong correlations between our **outcome** and the predictors, but relatively modest correlations between the predictors.</span>
<span id="cb91-494"><a href="#cb91-494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-495"><a href="#cb91-495" aria-hidden="true" tabindex="-1"></a>None of the numeric candidate predictors show any substantial correlation with each other. The largest Pearson correlation (in absolute value) between predictors is (-0.239) for <span class="in">`age`</span> and <span class="in">`bmi1`</span>, and that's not strong. If we did see signs of meaningful collinearity, we might rethink our selected set of predictors.</span>
<span id="cb91-496"><a href="#cb91-496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-497"><a href="#cb91-497" aria-hidden="true" tabindex="-1"></a>I'll recommend later that you run a generalized VIF (variance inflation factor) calculation^<span class="co">[</span><span class="ot">As we'll see in that setting, none of the generalized variance inflation factors will exceed 1.1, let alone the 5 or so that would cause us to be seriously concerned about collinearity.</span><span class="co">]</span> after fitting your kitchen sink model just to see if anything pops up (in my case, it won't.) </span>
<span id="cb91-498"><a href="#cb91-498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-499"><a href="#cb91-499" aria-hidden="true" tabindex="-1"></a><span class="fu">## `boxCox` function to assess need for transformation of our outcome</span></span>
<span id="cb91-500"><a href="#cb91-500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-501"><a href="#cb91-501" aria-hidden="true" tabindex="-1"></a>To use the <span class="in">`boxCox`</span> approach here, we need to ensure that the distribution of our outcome, <span class="in">`sbp2`</span>, includes strictly positive values. We can see from our numerical summary earlier that the minimum <span class="in">`sbp2`</span> in our <span class="in">`hbp_training`</span> sample is 90, so we're OK.</span>
<span id="cb91-502"><a href="#cb91-502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-503"><a href="#cb91-503" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Note that I am restricting myself here to the five predictors I actually intend to use in building models.</span>
<span id="cb91-504"><a href="#cb91-504" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Although we're generally using a 90% confidence interval in this project, we won't worry about that issue in the <span class="in">`boxCox`</span> plot, and instead just look at the point estimate from <span class="in">`powerTransform`</span>. </span>
<span id="cb91-505"><a href="#cb91-505" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>These commands (<span class="in">`boxCox`</span> and <span class="in">`powerTransform`</span>) come from the <span class="in">`car`</span> package.</span>
<span id="cb91-506"><a href="#cb91-506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-507"><a href="#cb91-507" aria-hidden="true" tabindex="-1"></a><span class="in">```{r boxCox_plot}</span></span>
<span id="cb91-508"><a href="#cb91-508" aria-hidden="true" tabindex="-1"></a><span class="in">model_temp &lt;- lm(sbp2 ~ sbp1 + age + bmi1 + diabetes + tobacco,</span></span>
<span id="cb91-509"><a href="#cb91-509" aria-hidden="true" tabindex="-1"></a><span class="in">                 data = hbp_training)</span></span>
<span id="cb91-510"><a href="#cb91-510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-511"><a href="#cb91-511" aria-hidden="true" tabindex="-1"></a><span class="in">boxCox(model_temp)</span></span>
<span id="cb91-512"><a href="#cb91-512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-513"><a href="#cb91-513" aria-hidden="true" tabindex="-1"></a><span class="in">powerTransform(model_temp)</span></span>
<span id="cb91-514"><a href="#cb91-514" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-515"><a href="#cb91-515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-516"><a href="#cb91-516" aria-hidden="true" tabindex="-1"></a>The estimated power transformation is about 0.5, which looks like a square root transformation of <span class="in">`sbp2`</span> is useful. Given that I'm using another measure of <span class="in">`sbp`</span>, specifically, <span class="in">`sbp1`</span> to predict <span class="in">`sbp2`</span>, perhaps I want to transform that, too?</span>
<span id="cb91-517"><a href="#cb91-517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-520"><a href="#cb91-520" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-521"><a href="#cb91-521" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(hbp_training, <span class="fu">aes</span>(<span class="at">x =</span> sbp1, <span class="at">y =</span> <span class="fu">sqrt</span>(sbp2))) <span class="sc">+</span></span>
<span id="cb91-522"><a href="#cb91-522" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb91-523"><a href="#cb91-523" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"loess"</span>, <span class="at">formula =</span> y <span class="sc">~</span> x, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> </span>
<span id="cb91-524"><a href="#cb91-524" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">formula =</span> y <span class="sc">~</span> x, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb91-525"><a href="#cb91-525" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"SQRT(sbp2) vs. SBP1"</span>)</span>
<span id="cb91-526"><a href="#cb91-526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-527"><a href="#cb91-527" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(hbp_training, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">sqrt</span>(sbp1), <span class="at">y =</span> <span class="fu">sqrt</span>(sbp2))) <span class="sc">+</span></span>
<span id="cb91-528"><a href="#cb91-528" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb91-529"><a href="#cb91-529" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"loess"</span>, <span class="at">formula =</span> y <span class="sc">~</span> x, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> </span>
<span id="cb91-530"><a href="#cb91-530" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">formula =</span> y <span class="sc">~</span> x, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> </span>
<span id="cb91-531"><a href="#cb91-531" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"SQRT(sbp2) vs. SQRT(sbp1)"</span>)</span>
<span id="cb91-532"><a href="#cb91-532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-533"><a href="#cb91-533" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2</span>
<span id="cb91-534"><a href="#cb91-534" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-535"><a href="#cb91-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-536"><a href="#cb91-536" aria-hidden="true" tabindex="-1"></a>I don't see an especially large difference between these two plots. It is up to you to decide whether a transformation suggested by <span class="in">`boxCox`</span> should be applied to your data.</span>
<span id="cb91-537"><a href="#cb91-537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-538"><a href="#cb91-538" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>For the purposes of this project, you should stick to transformations of strictly positive outcomes, and to the square root (power = 0.5), square (power = 2), logarithm (power = 0) and inverse (power = -1) transformations. Don't make the transformation without being able to interpret the result well.</span>
<span id="cb91-539"><a href="#cb91-539" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>If you do decide to include a transformation of your outcome in fitting models, be sure to back-transform any predictions you make at the end of the study so that we can understand the prediction error results.</span>
<span id="cb91-540"><a href="#cb91-540" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>If your outcome data are substantially multimodal, I wouldn't treat the <span class="in">`boxCox`</span> results as meaningful. </span>
<span id="cb91-541"><a href="#cb91-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-542"><a href="#cb91-542" aria-hidden="true" tabindex="-1"></a>I'm going to use the square root transformation for both my outcome and for the key predictor, but I don't think it makes a big difference. I'm doing it mostly so that I can show you how to back-transform later.</span>
<span id="cb91-543"><a href="#cb91-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-544"><a href="#cb91-544" aria-hidden="true" tabindex="-1"></a><span class="fu"># The Big Model</span></span>
<span id="cb91-545"><a href="#cb91-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-546"><a href="#cb91-546" aria-hidden="true" tabindex="-1"></a>We will specify a "kitchen sink" linear regression model to describe the relationship between our outcome (potentially after transformation) and the main effects of each of our predictors. We'll need to:</span>
<span id="cb91-547"><a href="#cb91-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-548"><a href="#cb91-548" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We'll assess the overall effectiveness, within your training sample, of your model, by specifying and interpreting the R^2^, adjusted R^2^ (especially in light of our collinearity conclusions, below), the residual standard error, and the ANOVA F test. </span>
<span id="cb91-549"><a href="#cb91-549" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We'll need to specify the size, magnitude and meaning of all coefficients, and identify appropriate conclusions regarding effect sizes with 90% confidence intervals.</span>
<span id="cb91-550"><a href="#cb91-550" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Finally, we'll assess whether collinearity in the kitchen sink model has a meaningful impact, and describe how we know that.</span>
<span id="cb91-551"><a href="#cb91-551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-552"><a href="#cb91-552" aria-hidden="true" tabindex="-1"></a><span class="fu">## Fitting/Summarizing the Kitchen Sink model</span></span>
<span id="cb91-553"><a href="#cb91-553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-554"><a href="#cb91-554" aria-hidden="true" tabindex="-1"></a>Our "kitchen sink" or "big" model predicts the square root of <span class="in">`sbp2`</span> using the predictors (square root of <span class="in">`sbp1`</span>), <span class="in">`age`</span>, <span class="in">`bmi1`</span>, <span class="in">`diabetes`</span> and <span class="in">`tobacco`</span>.</span>
<span id="cb91-555"><a href="#cb91-555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-556"><a href="#cb91-556" aria-hidden="true" tabindex="-1"></a><span class="in">```{r kitchen_sink}</span></span>
<span id="cb91-557"><a href="#cb91-557" aria-hidden="true" tabindex="-1"></a><span class="in">model_big &lt;- lm(sqrt(sbp2) ~ sqrt(sbp1) + age + bmi1 + diabetes + tobacco, </span></span>
<span id="cb91-558"><a href="#cb91-558" aria-hidden="true" tabindex="-1"></a><span class="in">                data = hbp_training)</span></span>
<span id="cb91-559"><a href="#cb91-559" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-560"><a href="#cb91-560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-563"><a href="#cb91-563" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-564"><a href="#cb91-564" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_big)</span>
<span id="cb91-565"><a href="#cb91-565" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-566"><a href="#cb91-566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-567"><a href="#cb91-567" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-568"><a href="#cb91-568" aria-hidden="true" tabindex="-1"></a><span class="fu">## Effect Sizes: Coefficient Estimates</span></span>
<span id="cb91-569"><a href="#cb91-569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-570"><a href="#cb91-570" aria-hidden="true" tabindex="-1"></a>Specify the size and magnitude of all coefficients, providing estimated effect sizes with 90% confidence intervals.</span>
<span id="cb91-571"><a href="#cb91-571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-574"><a href="#cb91-574" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-575"><a href="#cb91-575" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(model_big, <span class="at">conf.int =</span> <span class="cn">TRUE</span>, <span class="at">conf.level =</span> <span class="fl">0.90</span>) <span class="sc">|&gt;</span> </span>
<span id="cb91-576"><a href="#cb91-576" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(term, estimate, std.error, conf.low, conf.high, p.value) <span class="sc">|&gt;</span> </span>
<span id="cb91-577"><a href="#cb91-577" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">dig =</span> <span class="dv">4</span>)</span>
<span id="cb91-578"><a href="#cb91-578" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-579"><a href="#cb91-579" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-580"><a href="#cb91-580" aria-hidden="true" tabindex="-1"></a>I wanted to get at least two significant figures in my coefficient and standard error estimates for all of the predictors in this model, so that's why I had to go out to 4 decimal places.</span>
<span id="cb91-581"><a href="#cb91-581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-582"><a href="#cb91-582" aria-hidden="true" tabindex="-1"></a><span class="fu">## Describing the Equation</span></span>
<span id="cb91-583"><a href="#cb91-583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-584"><a href="#cb91-584" aria-hidden="true" tabindex="-1"></a>This model implies for the key predictor that:</span>
<span id="cb91-585"><a href="#cb91-585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-586"><a href="#cb91-586" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>for every increase of one point in the square root of <span class="in">`sbp1`</span>, we anticipate an increase in the outcome (square root of sbp2) of 0.37 mm Hg (90% confidence interval: 0.31, 0.43). If we had two subjects with the same values of all other variables, but A had a baseline square root of SBP of 12 (so an SBP at baseline of 144) and B had a baseline square root of SBP of 11 (so an SBP at baseline of 121) then if all other variables are kept at the same value, our model predicts that the square root of subject A's SBP at 18 months will be 0.37 points higher (90% CI: 0.31, 0.43) than that of subject B.</span>
<span id="cb91-587"><a href="#cb91-587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-588"><a href="#cb91-588" aria-hidden="true" tabindex="-1"></a>You should provide a (briefer) description of the meaning (especially the direction) of the other coefficients in your model being sure only to interpret the coefficients as having meaning *holding all other predictors constant*, but I'll skip that in the demo.</span>
<span id="cb91-589"><a href="#cb91-589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-590"><a href="#cb91-590" aria-hidden="true" tabindex="-1"></a><span class="fu"># The Smaller Model</span></span>
<span id="cb91-591"><a href="#cb91-591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-592"><a href="#cb91-592" aria-hidden="true" tabindex="-1"></a>Here, we will build a second linear regression model using a subset of our "kitchen sink" model predictors, chosen to maximize predictive value within our training sample. </span>
<span id="cb91-593"><a href="#cb91-593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-594"><a href="#cb91-594" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We'll specify the method you used to obtain this new model. (Backwards stepwise elimination is appealing but not great. It's perfectly fine to just include the key predictor as the subset for this new model.) </span>
<span id="cb91-595"><a href="#cb91-595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-596"><a href="#cb91-596" aria-hidden="true" tabindex="-1"></a><span class="fu">## Backwards Stepwise Elimination</span></span>
<span id="cb91-597"><a href="#cb91-597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-598"><a href="#cb91-598" aria-hidden="true" tabindex="-1"></a><span class="in">```{r stepwise_bw_model}</span></span>
<span id="cb91-599"><a href="#cb91-599" aria-hidden="true" tabindex="-1"></a><span class="in">step(model_big)</span></span>
<span id="cb91-600"><a href="#cb91-600" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-601"><a href="#cb91-601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-602"><a href="#cb91-602" aria-hidden="true" tabindex="-1"></a>The backwards selection stepwise approach suggests a model with <span class="in">`sqrt(sbp1)`</span> and age and tobacco, but not <span class="in">`bmi1`</span> or <span class="in">`diabetes`</span>.</span>
<span id="cb91-603"><a href="#cb91-603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-604"><a href="#cb91-604" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>If stepwise regression retains the kitchen sink model or if you don't want to use stepwise regression, develop an alternate model by selecting a subset of the Big model predictors (including the key predictor) on your own. A simple regression on the key predictor is a perfectly reasonable choice.</span>
<span id="cb91-605"><a href="#cb91-605" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>If stepwise regression throws out the key predictor in your kitchen sink model, then I suggest not using stepwise regression.</span>
<span id="cb91-606"><a href="#cb91-606" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>We will learn several other methods for variable selection in 432. If you want to use one of them (for instance, a C_p_ plot) here, that's OK, but I will hold you to high expectations for getting that done correctly, and it's worth remembering that none of them work very well at identifying the "best" model.</span>
<span id="cb91-607"><a href="#cb91-607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-608"><a href="#cb91-608" aria-hidden="true" tabindex="-1"></a><span class="fu">## Fitting the "small" model</span></span>
<span id="cb91-609"><a href="#cb91-609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-610"><a href="#cb91-610" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fit_mod_small}</span></span>
<span id="cb91-611"><a href="#cb91-611" aria-hidden="true" tabindex="-1"></a><span class="in">model_small &lt;- lm(sqrt(sbp2) ~ sqrt(sbp1) + age + tobacco, data = hbp_training)</span></span>
<span id="cb91-612"><a href="#cb91-612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-613"><a href="#cb91-613" aria-hidden="true" tabindex="-1"></a><span class="in">summary(model_small)</span></span>
<span id="cb91-614"><a href="#cb91-614" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-615"><a href="#cb91-615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-616"><a href="#cb91-616" aria-hidden="true" tabindex="-1"></a><span class="fu">## Effect Sizes: Coefficient Estimates</span></span>
<span id="cb91-617"><a href="#cb91-617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-618"><a href="#cb91-618" aria-hidden="true" tabindex="-1"></a>Here, we specify the size and magnitude of all coefficients, providing estimated effect sizes with 90% confidence intervals.</span>
<span id="cb91-619"><a href="#cb91-619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-622"><a href="#cb91-622" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-623"><a href="#cb91-623" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(model_small, <span class="at">conf.int =</span> <span class="cn">TRUE</span>, <span class="at">conf.level =</span> <span class="fl">0.90</span>) <span class="sc">|&gt;</span> </span>
<span id="cb91-624"><a href="#cb91-624" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(term, estimate, std.error, conf.low, conf.high, p.value) <span class="sc">|&gt;</span> </span>
<span id="cb91-625"><a href="#cb91-625" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">dig =</span> <span class="dv">4</span>)</span>
<span id="cb91-626"><a href="#cb91-626" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-627"><a href="#cb91-627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-628"><a href="#cb91-628" aria-hidden="true" tabindex="-1"></a><span class="fu">## Interpreting the Small Model Regression Equation</span></span>
<span id="cb91-629"><a href="#cb91-629" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-630"><a href="#cb91-630" aria-hidden="true" tabindex="-1"></a>I'll skip the necessary English sentences here in the demo that explain the meaning of the estimates in our model. </span>
<span id="cb91-631"><a href="#cb91-631" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-632"><a href="#cb91-632" aria-hidden="true" tabindex="-1"></a><span class="fu"># In-Sample Comparison</span></span>
<span id="cb91-633"><a href="#cb91-633" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-634"><a href="#cb91-634" aria-hidden="true" tabindex="-1"></a><span class="fu">## Quality of Fit</span></span>
<span id="cb91-635"><a href="#cb91-635" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-636"><a href="#cb91-636" aria-hidden="true" tabindex="-1"></a>We will compare the small model to the big model in our training sample using adjusted R^2^, the residual standard error, AIC and BIC. We'll be a little bit slick here. </span>
<span id="cb91-637"><a href="#cb91-637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-638"><a href="#cb91-638" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>First, we'll use <span class="in">`glance`</span> to build a tibble of key results for the kitchen sink model, and append to that a description of the model. We'll toss that in a temporary tibble called <span class="in">`temp_a`</span>.</span>
<span id="cb91-639"><a href="#cb91-639" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Next we do the same for the smaller model, and put that in <span class="in">`temp_b`</span>.</span>
<span id="cb91-640"><a href="#cb91-640" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Finally, we put the temp files together into a new tibble, called <span class="in">`training_comp`</span>, and examine that.</span>
<span id="cb91-641"><a href="#cb91-641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-644"><a href="#cb91-644" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-645"><a href="#cb91-645" aria-hidden="true" tabindex="-1"></a>temp_a <span class="ot">&lt;-</span> <span class="fu">glance</span>(model_big) <span class="sc">|&gt;</span> </span>
<span id="cb91-646"><a href="#cb91-646" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>logLik, <span class="sc">-</span>deviance) <span class="sc">|&gt;</span></span>
<span id="cb91-647"><a href="#cb91-647" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">3</span>) <span class="sc">|&gt;</span></span>
<span id="cb91-648"><a href="#cb91-648" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">modelname =</span> <span class="st">"big"</span>)</span>
<span id="cb91-649"><a href="#cb91-649" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-650"><a href="#cb91-650" aria-hidden="true" tabindex="-1"></a>temp_b <span class="ot">&lt;-</span> <span class="fu">glance</span>(model_small) <span class="sc">|&gt;</span></span>
<span id="cb91-651"><a href="#cb91-651" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>logLik, <span class="sc">-</span>deviance) <span class="sc">|&gt;</span></span>
<span id="cb91-652"><a href="#cb91-652" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">3</span>) <span class="sc">|&gt;</span></span>
<span id="cb91-653"><a href="#cb91-653" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">modelname =</span> <span class="st">"small"</span>)</span>
<span id="cb91-654"><a href="#cb91-654" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-655"><a href="#cb91-655" aria-hidden="true" tabindex="-1"></a>training_comp <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(temp_a, temp_b) <span class="sc">|&gt;</span></span>
<span id="cb91-656"><a href="#cb91-656" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(modelname, nobs, df, AIC, BIC, <span class="fu">everything</span>())</span>
<span id="cb91-657"><a href="#cb91-657" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-658"><a href="#cb91-658" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-661"><a href="#cb91-661" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-662"><a href="#cb91-662" aria-hidden="true" tabindex="-1"></a>training_comp</span>
<span id="cb91-663"><a href="#cb91-663" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-664"><a href="#cb91-664" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-665"><a href="#cb91-665" aria-hidden="true" tabindex="-1"></a>It looks like the smaller model with 3 predictors: <span class="in">`sqrt(sbp1)`</span>, <span class="in">`age`</span> and <span class="in">`tobacco`</span>, performs slightly better in the training sample.</span>
<span id="cb91-666"><a href="#cb91-666" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-667"><a href="#cb91-667" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The AIC and BIC for the smaller model are each a little smaller than for the big model.</span>
<span id="cb91-668"><a href="#cb91-668" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The adjusted R^2^ and residual standard deviation (<span class="in">`sigma`</span>) is essentially identical in the two models.</span>
<span id="cb91-669"><a href="#cb91-669" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-670"><a href="#cb91-670" aria-hidden="true" tabindex="-1"></a><span class="fu">## Assessing Assumptions</span></span>
<span id="cb91-671"><a href="#cb91-671" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-672"><a href="#cb91-672" aria-hidden="true" tabindex="-1"></a>Here, we should run a set of residual plots for each model. If you want to impress me a little, you'll use the <span class="in">`ggplot`</span> versions I introduced in the slides for Classes 22-24. Otherwise, it's perfectly fine just to show the plots available in base R.</span>
<span id="cb91-673"><a href="#cb91-673" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-674"><a href="#cb91-674" aria-hidden="true" tabindex="-1"></a><span class="fu">### Residual Plots for the Big Model</span></span>
<span id="cb91-675"><a href="#cb91-675" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-678"><a href="#cb91-678" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-679"><a href="#cb91-679" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>)); <span class="fu">plot</span>(model_big); <span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb91-680"><a href="#cb91-680" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-681"><a href="#cb91-681" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-682"><a href="#cb91-682" aria-hidden="true" tabindex="-1"></a>I see no serious problems with the assumptions of linearity, Normality and constant variance, nor do I see any highly influential points in our big model.</span>
<span id="cb91-683"><a href="#cb91-683" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-684"><a href="#cb91-684" aria-hidden="true" tabindex="-1"></a><span class="fu">### Residual Plots for the Small Model</span></span>
<span id="cb91-685"><a href="#cb91-685" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-688"><a href="#cb91-688" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-689"><a href="#cb91-689" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>)); <span class="fu">plot</span>(model_small); <span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb91-690"><a href="#cb91-690" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-691"><a href="#cb91-691" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-692"><a href="#cb91-692" aria-hidden="true" tabindex="-1"></a>I see no serious problems with the assumptions of linearity, Normality and constant variance, nor do I see any highly influential points in our small model.</span>
<span id="cb91-693"><a href="#cb91-693" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-694"><a href="#cb91-694" aria-hidden="true" tabindex="-1"></a><span class="fu">### Does collinearity have a meaningful impact?</span></span>
<span id="cb91-695"><a href="#cb91-695" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-696"><a href="#cb91-696" aria-hidden="true" tabindex="-1"></a>If we fit models with multiple predictors, then we might want to assess the potential impact of collinearity.</span>
<span id="cb91-697"><a href="#cb91-697" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-700"><a href="#cb91-700" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-701"><a href="#cb91-701" aria-hidden="true" tabindex="-1"></a>car<span class="sc">::</span><span class="fu">vif</span>(model_big)</span>
<span id="cb91-702"><a href="#cb91-702" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-703"><a href="#cb91-703" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-704"><a href="#cb91-704" aria-hidden="true" tabindex="-1"></a>We'd need to see a generalized variance inflation factor above 5 for collinearity to be a meaningful concern, so we should be fine in our big model. Our small model also has multiple predictors, but it cannot be an issue, since it's just a subset of our big model, which didn't have a collinearity problem.</span>
<span id="cb91-705"><a href="#cb91-705" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-706"><a href="#cb91-706" aria-hidden="true" tabindex="-1"></a><span class="fu">## Comparing the Models</span></span>
<span id="cb91-707"><a href="#cb91-707" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-708"><a href="#cb91-708" aria-hidden="true" tabindex="-1"></a>Based on the training sample, my conclusions so far is to support the smaller model. It has (slightly) better performance on the fit quality measures, and each model shows no serious problems with regression assumptions.</span>
<span id="cb91-709"><a href="#cb91-709" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-710"><a href="#cb91-710" aria-hidden="true" tabindex="-1"></a><span class="fu"># Model Validation</span></span>
<span id="cb91-711"><a href="#cb91-711" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-712"><a href="#cb91-712" aria-hidden="true" tabindex="-1"></a>Now, we will use our two regression models to predict the value of our outcome using the predictor values  in the test sample. </span>
<span id="cb91-713"><a href="#cb91-713" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-714"><a href="#cb91-714" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We may need to back-transform the predictions to the original units if we wind up fitting a model to a transformed outcome. </span>
<span id="cb91-715"><a href="#cb91-715" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We'll definitely need to compare the two models in terms of mean squared prediction error and mean absolute prediction error in a Table, which I will definitely want to see in your portfolio. </span>
<span id="cb91-716"><a href="#cb91-716" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We'll have to specify which model appears better at out-of-sample prediction according to these comparisons, and how we know that.</span>
<span id="cb91-717"><a href="#cb91-717" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-718"><a href="#cb91-718" aria-hidden="true" tabindex="-1"></a><span class="fu">## Calculating Prediction Errors</span></span>
<span id="cb91-719"><a href="#cb91-719" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-720"><a href="#cb91-720" aria-hidden="true" tabindex="-1"></a><span class="fu">### Big Model: Back-Transformation and Calculating Fits/Residuals</span></span>
<span id="cb91-721"><a href="#cb91-721" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-722"><a href="#cb91-722" aria-hidden="true" tabindex="-1"></a>We'll use the <span class="in">`augment`</span> function from the <span class="in">`broom`</span> package to help us here, and create <span class="in">`sbp2_fit`</span> to hold the fitted values on the original <span class="in">`sbp2`</span> scale after back-transformation (by squaring the predictions on the square root scale) and then <span class="in">`sbp2_res`</span> to hold the residuals (prediction errors) we observe using the big model on the <span class="in">`hbp_test`</span> data.</span>
<span id="cb91-723"><a href="#cb91-723" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-726"><a href="#cb91-726" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-727"><a href="#cb91-727" aria-hidden="true" tabindex="-1"></a>aug_big <span class="ot">&lt;-</span> <span class="fu">augment</span>(model_big, <span class="at">newdata =</span> hbp_test) <span class="sc">|&gt;</span> </span>
<span id="cb91-728"><a href="#cb91-728" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mod_name =</span> <span class="st">"big"</span>,</span>
<span id="cb91-729"><a href="#cb91-729" aria-hidden="true" tabindex="-1"></a>         <span class="at">sbp2_fit =</span> .fitted<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb91-730"><a href="#cb91-730" aria-hidden="true" tabindex="-1"></a>         <span class="at">sbp2_res =</span> sbp2 <span class="sc">-</span> sbp2_fit) <span class="sc">|&gt;</span></span>
<span id="cb91-731"><a href="#cb91-731" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(subj_id, mod_name, sbp2, sbp2_fit, sbp2_res, <span class="fu">everything</span>())</span>
<span id="cb91-732"><a href="#cb91-732" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-733"><a href="#cb91-733" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(aug_big,<span class="dv">3</span>)</span>
<span id="cb91-734"><a href="#cb91-734" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-735"><a href="#cb91-735" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-736"><a href="#cb91-736" aria-hidden="true" tabindex="-1"></a><span class="fu">### Small Model: Back-Transformation and Calculating Fits/Residuals</span></span>
<span id="cb91-737"><a href="#cb91-737" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-738"><a href="#cb91-738" aria-hidden="true" tabindex="-1"></a>We'll do the same thing, but using the small model in the <span class="in">`hbp_test`</span> data.</span>
<span id="cb91-739"><a href="#cb91-739" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-742"><a href="#cb91-742" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-743"><a href="#cb91-743" aria-hidden="true" tabindex="-1"></a>aug_small <span class="ot">&lt;-</span> <span class="fu">augment</span>(model_small, <span class="at">newdata =</span> hbp_test) <span class="sc">|&gt;</span> </span>
<span id="cb91-744"><a href="#cb91-744" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mod_name =</span> <span class="st">"small"</span>,</span>
<span id="cb91-745"><a href="#cb91-745" aria-hidden="true" tabindex="-1"></a>         <span class="at">sbp2_fit =</span> .fitted<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb91-746"><a href="#cb91-746" aria-hidden="true" tabindex="-1"></a>         <span class="at">sbp2_res =</span> sbp2 <span class="sc">-</span> sbp2_fit) <span class="sc">|&gt;</span></span>
<span id="cb91-747"><a href="#cb91-747" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(subj_id, mod_name, sbp2, sbp2_fit, sbp2_res, <span class="fu">everything</span>())</span>
<span id="cb91-748"><a href="#cb91-748" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-749"><a href="#cb91-749" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(aug_small,<span class="dv">3</span>)</span>
<span id="cb91-750"><a href="#cb91-750" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-751"><a href="#cb91-751" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-752"><a href="#cb91-752" aria-hidden="true" tabindex="-1"></a><span class="fu">### Combining the Results</span></span>
<span id="cb91-753"><a href="#cb91-753" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-756"><a href="#cb91-756" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-757"><a href="#cb91-757" aria-hidden="true" tabindex="-1"></a>test_comp <span class="ot">&lt;-</span> <span class="fu">union</span>(aug_big, aug_small) <span class="sc">|&gt;</span></span>
<span id="cb91-758"><a href="#cb91-758" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(subj_id, mod_name)</span>
<span id="cb91-759"><a href="#cb91-759" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-760"><a href="#cb91-760" aria-hidden="true" tabindex="-1"></a>test_comp <span class="sc">|&gt;</span> <span class="fu">head</span>()</span>
<span id="cb91-761"><a href="#cb91-761" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-762"><a href="#cb91-762" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-763"><a href="#cb91-763" aria-hidden="true" tabindex="-1"></a>Given this <span class="in">`test_comp`</span> tibble, including predictions and residuals from the kitchen sink model on our test data, we can now:</span>
<span id="cb91-764"><a href="#cb91-764" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-765"><a href="#cb91-765" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Visualize the prediction errors from each model.</span>
<span id="cb91-766"><a href="#cb91-766" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Summarize those errors across each model.</span>
<span id="cb91-767"><a href="#cb91-767" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Identify the "worst fitting" subject for each model in the test sample.</span>
<span id="cb91-768"><a href="#cb91-768" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-769"><a href="#cb91-769" aria-hidden="true" tabindex="-1"></a>The next few subsections actually do these things.</span>
<span id="cb91-770"><a href="#cb91-770" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-771"><a href="#cb91-771" aria-hidden="true" tabindex="-1"></a><span class="fu">## Visualizing the Predictions</span></span>
<span id="cb91-772"><a href="#cb91-772" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-775"><a href="#cb91-775" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-776"><a href="#cb91-776" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(test_comp, <span class="fu">aes</span>(<span class="at">x =</span> sbp2_fit, <span class="at">y =</span> sbp2)) <span class="sc">+</span></span>
<span id="cb91-777"><a href="#cb91-777" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb91-778"><a href="#cb91-778" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">1</span>, <span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">lty =</span> <span class="st">"dashed"</span>) <span class="sc">+</span> </span>
<span id="cb91-779"><a href="#cb91-779" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"loess"</span>, <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">formula =</span> y <span class="sc">~</span> x) <span class="sc">+</span></span>
<span id="cb91-780"><a href="#cb91-780" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>( <span class="sc">~</span> mod_name, <span class="at">labeller =</span> <span class="st">"label_both"</span>) <span class="sc">+</span></span>
<span id="cb91-781"><a href="#cb91-781" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Predicted sbp2"</span>,</span>
<span id="cb91-782"><a href="#cb91-782" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Observed sbp2"</span>,</span>
<span id="cb91-783"><a href="#cb91-783" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Observed vs. Predicted sbp2"</span>,</span>
<span id="cb91-784"><a href="#cb91-784" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Comparing Big to Small Model in Test Sample"</span>,</span>
<span id="cb91-785"><a href="#cb91-785" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">"Dashed line is where Observed = Predicted"</span>)</span>
<span id="cb91-786"><a href="#cb91-786" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-787"><a href="#cb91-787" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-788"><a href="#cb91-788" aria-hidden="true" tabindex="-1"></a>I'm not seeing a lot of difference between the models in terms of the adherence of the points to the dashed line. The models seem to be making fairly similar errors.</span>
<span id="cb91-789"><a href="#cb91-789" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-790"><a href="#cb91-790" aria-hidden="true" tabindex="-1"></a><span class="fu">## Summarizing the Errors</span></span>
<span id="cb91-791"><a href="#cb91-791" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-792"><a href="#cb91-792" aria-hidden="true" tabindex="-1"></a>Calculate the mean absolute prediction error (MAPE), the root mean squared prediction error (RMSPE) and the maximum absolute error across the predictions made by each model. </span>
<span id="cb91-793"><a href="#cb91-793" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-796"><a href="#cb91-796" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-797"><a href="#cb91-797" aria-hidden="true" tabindex="-1"></a>test_comp <span class="sc">|&gt;</span></span>
<span id="cb91-798"><a href="#cb91-798" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(mod_name) <span class="sc">|&gt;</span></span>
<span id="cb91-799"><a href="#cb91-799" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb91-800"><a href="#cb91-800" aria-hidden="true" tabindex="-1"></a>            <span class="at">MAPE =</span> <span class="fu">mean</span>(<span class="fu">abs</span>(sbp2_res)), </span>
<span id="cb91-801"><a href="#cb91-801" aria-hidden="true" tabindex="-1"></a>            <span class="at">RMSPE =</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>(sbp2_res<span class="sc">^</span><span class="dv">2</span>)),</span>
<span id="cb91-802"><a href="#cb91-802" aria-hidden="true" tabindex="-1"></a>            <span class="at">max_error =</span> <span class="fu">max</span>(<span class="fu">abs</span>(sbp2_res)))</span>
<span id="cb91-803"><a href="#cb91-803" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-804"><a href="#cb91-804" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-805"><a href="#cb91-805" aria-hidden="true" tabindex="-1"></a>This is a table Dr. Love will **definitely** need to see during your presentation.</span>
<span id="cb91-806"><a href="#cb91-806" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-807"><a href="#cb91-807" aria-hidden="true" tabindex="-1"></a>In this case, two of these summaries are better (smaller) for the small model (RMSPE and max_error), suggesting (gently) that it is the better choice. The MAPE is the exception. </span>
<span id="cb91-808"><a href="#cb91-808" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-809"><a href="#cb91-809" aria-hidden="true" tabindex="-1"></a>These models suggest an average error in predicting systolic blood pressure (using MAPE) of more than 13 mm Hg. That's not great on the scale of systolic blood pressure, I think.</span>
<span id="cb91-810"><a href="#cb91-810" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-811"><a href="#cb91-811" aria-hidden="true" tabindex="-1"></a><span class="fu">### Identify the largest errors</span></span>
<span id="cb91-812"><a href="#cb91-812" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-813"><a href="#cb91-813" aria-hidden="true" tabindex="-1"></a>Identify the subject(s) where that maximum prediction error was made by each model, and the observed and model-fitted values of <span class="in">`sbp_diff`</span> for that subject in each case.</span>
<span id="cb91-814"><a href="#cb91-814" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-817"><a href="#cb91-817" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-818"><a href="#cb91-818" aria-hidden="true" tabindex="-1"></a>temp1 <span class="ot">&lt;-</span> aug_big <span class="sc">|&gt;</span></span>
<span id="cb91-819"><a href="#cb91-819" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">abs</span>(sbp2_res) <span class="sc">==</span> <span class="fu">max</span>(<span class="fu">abs</span>(sbp2_res)))</span>
<span id="cb91-820"><a href="#cb91-820" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-821"><a href="#cb91-821" aria-hidden="true" tabindex="-1"></a>temp2 <span class="ot">&lt;-</span> aug_small <span class="sc">|&gt;</span></span>
<span id="cb91-822"><a href="#cb91-822" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">abs</span>(sbp2_res) <span class="sc">==</span> <span class="fu">max</span>(<span class="fu">abs</span>(sbp2_res)))</span>
<span id="cb91-823"><a href="#cb91-823" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-824"><a href="#cb91-824" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(temp1, temp2)</span>
<span id="cb91-825"><a href="#cb91-825" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-826"><a href="#cb91-826" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-827"><a href="#cb91-827" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>In our case, the same subject (<span class="in">`A0513`</span>) was most poorly fit by each model.</span>
<span id="cb91-828"><a href="#cb91-828" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-829"><a href="#cb91-829" aria-hidden="true" tabindex="-1"></a><span class="fu">### Validated R-square values</span></span>
<span id="cb91-830"><a href="#cb91-830" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-831"><a href="#cb91-831" aria-hidden="true" tabindex="-1"></a>Here's the squared correlation between our predicted <span class="in">`sbp2`</span> and our actual <span class="in">`sbp2`</span> in the test sample, using the big model.</span>
<span id="cb91-832"><a href="#cb91-832" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-835"><a href="#cb91-835" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-836"><a href="#cb91-836" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(aug_big<span class="sc">$</span>sbp2, aug_big<span class="sc">$</span>sbp2_fit)<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb91-837"><a href="#cb91-837" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-838"><a href="#cb91-838" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-839"><a href="#cb91-839" aria-hidden="true" tabindex="-1"></a>and here's the R-square we obtained within the test sample for the small model.</span>
<span id="cb91-840"><a href="#cb91-840" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-843"><a href="#cb91-843" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-844"><a href="#cb91-844" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(aug_small<span class="sc">$</span>sbp2, aug_small<span class="sc">$</span>sbp2_fit)<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb91-845"><a href="#cb91-845" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-846"><a href="#cb91-846" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-847"><a href="#cb91-847" aria-hidden="true" tabindex="-1"></a>Not really much of a difference. Note that either of these results suggest our training sample $R^2$ (and even adjusted $R^2$ values) were a bit optimistic.</span>
<span id="cb91-848"><a href="#cb91-848" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-849"><a href="#cb91-849" aria-hidden="true" tabindex="-1"></a><span class="fu">## Comparing the Models</span></span>
<span id="cb91-850"><a href="#cb91-850" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-851"><a href="#cb91-851" aria-hidden="true" tabindex="-1"></a>I would select the smaller model here, on the basis of the similar performance in terms of the visualization of errors, and the small improvements in RMSPE and maximum prediction error, as well as validated $R^2$.</span>
<span id="cb91-852"><a href="#cb91-852" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-853"><a href="#cb91-853" aria-hidden="true" tabindex="-1"></a><span class="fu"># Discussion</span></span>
<span id="cb91-854"><a href="#cb91-854" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-855"><a href="#cb91-855" aria-hidden="true" tabindex="-1"></a><span class="fu">## Chosen Model</span></span>
<span id="cb91-856"><a href="#cb91-856" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-857"><a href="#cb91-857" aria-hidden="true" tabindex="-1"></a>I chose the Small model. You'll want to reiterate the reasons why in this subsection.</span>
<span id="cb91-858"><a href="#cb91-858" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-859"><a href="#cb91-859" aria-hidden="true" tabindex="-1"></a><span class="fu">## Answering My Question</span></span>
<span id="cb91-860"><a href="#cb91-860" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-861"><a href="#cb91-861" aria-hidden="true" tabindex="-1"></a>Now use the Small model to answer the research question, in a complete sentence of two.</span>
<span id="cb91-862"><a href="#cb91-862" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-863"><a href="#cb91-863" aria-hidden="true" tabindex="-1"></a><span class="fu">## Next Steps</span></span>
<span id="cb91-864"><a href="#cb91-864" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-865"><a href="#cb91-865" aria-hidden="true" tabindex="-1"></a>Describe an interesting next step, which might involve fitting a new model not available with your current cleaned data, or dealing with missing values differently, or obtaining new or better data, or something else. You should be able to describe why this might help.</span>
<span id="cb91-866"><a href="#cb91-866" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-867"><a href="#cb91-867" aria-hidden="true" tabindex="-1"></a><span class="fu">## Reflection</span></span>
<span id="cb91-868"><a href="#cb91-868" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-869"><a href="#cb91-869" aria-hidden="true" tabindex="-1"></a>Tell us what you know now that would have changed your approach to Study 2 had you known it at the start.</span>
<span id="cb91-870"><a href="#cb91-870" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-871"><a href="#cb91-871" aria-hidden="true" tabindex="-1"></a><span class="fu"># Session Information</span></span>
<span id="cb91-872"><a href="#cb91-872" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-873"><a href="#cb91-873" aria-hidden="true" tabindex="-1"></a>should be included at the end of your report.</span>
<span id="cb91-874"><a href="#cb91-874" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-877"><a href="#cb91-877" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-878"><a href="#cb91-878" aria-hidden="true" tabindex="-1"></a><span class="fu">session_info</span>()</span>
<span id="cb91-879"><a href="#cb91-879" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>